    <!DOCTYPE html>
    <!--
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Ù…Ù†Ø¸ÙˆÙ…Ø© ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª - Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ğŸ”’ Ù†Ø¸Ø§Ù… Ø¢Ù…Ù† ÙˆÙ…Ø­Ù…ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    
    Ù…/ Ù…Ù‡Ù†Ø¯ Ø§Ù„ØªÙ‡Ø§Ù…ÙŠ - 01021102607
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    -->
    <html lang="ar" dir="rtl">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª - ÙƒÙØ± ØµÙ‚Ø±</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://i.postimg.cc/brFBgHg7/Flag-of-Sharkiya-Governorate.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.postimg.cc/brFBgHg7/Flag-of-Sharkiya-Governorate.png">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">

    <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    CSS Variables
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
    --primary: #1a5276;
    --secondary: #27ae60;
    --accent: #d35400;
    --danger: #e74c3c;
    --warning: #f39c12;
    --info: #3498db;
    --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --glass-white: rgba(255, 255, 255, 0.85);
    --glass-border: rgba(255, 255, 255, 0.5);
    --text-dark: #2c3e50;
    --shadow-lg: 0 20px 60px rgba(0,0,0,0.3);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Base Styles
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    }

    body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-gradient);
    background-attachment: fixed;
    direction: rtl;
    color: var(--text-dark);
    padding-bottom: 100px;
    min-height: 100vh;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Header
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header {
    background: linear-gradient(135deg, rgba(26, 82, 118, 0.98) 0%, rgba(21, 67, 96, 0.98) 100%);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    color: white;
    padding: 8px 3%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow-lg);
    border-bottom: 3px solid rgba(255, 255, 255, 0.3);
    position: sticky;
    top: 0;
    z-index: 1000;
    animation: slideDown 0.5s ease;
    }

    .header-title h1 {
    font-size: 1.1rem;
    margin: 0;
    line-height: 1.3;
    }

    .header-title small {
    font-size: 0.75rem;
    opacity: 0.9;
    }

    @keyframes slideDown {
    from { transform: translateY(-100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
    }

    @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
    }

    .header-title h1 {
    margin: 0;
    font-size: 1.4rem;
    text-shadow: 0 3px 6px rgba(0,0,0,0.3);
    }

    .header-title small {
    color: #f1c40f;
    font-size: 0.85rem;
    display: block;
    margin-top: 5px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Container & Cards
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .container {
    max-width: 1400px;
    margin: 30px auto;
    padding: 0 20px;
    }

    .card {
    background: var(--glass-white);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 40px;
    border-radius: 30px;
    border: 2px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    animation: fadeIn 0.6s ease;
    margin-bottom: 30px;
    margin-top: 20px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Portal Boxes
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .portal-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 30px;
    margin-top: 50px;
    padding: 0 10px;
    }

    .portal-box {
    background: var(--glass-white);
    backdrop-filter: blur(20px);
    padding: 50px 30px;
    border-radius: 30px;
    text-align: center;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    position: relative;
    overflow: hidden;
    min-height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    }

    .portal-box::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
    transform: scale(0);
    transition: transform 0.6s ease;
    }

    .portal-box:hover::before {
    transform: scale(1);
    }

    .portal-box:hover {
    transform: translateY(-15px) scale(1.05);
    box-shadow: 0 30px 70px rgba(0,0,0,0.25);
    }

    .portal-box i {
    font-size: 90px;
    display: block;
    margin-bottom: 25px;
    animation: pulse 2s infinite;
    filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
    }

    .portal-box h2 {
    margin: 15px 0;
    font-size: 1.6rem;
    font-weight: 900;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .portal-box p {
    color: #666;
    font-size: 1rem;
    line-height: 1.8;
    margin: 15px 0 0 0;
    font-weight: 500;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Forms
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    }

    .input-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
    position: relative;
    }

    .input-group label {
    margin-bottom: 12px;
    font-weight: 700;
    color: var(--primary);
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
    }

    .input-group label::before {
    content: 'â—';
    color: var(--accent);
    font-size: 0.8rem;
    }

    .input-group input,
    .input-group select,
    .input-group textarea {
    padding: 16px;
    border: 2px solid var(--glass-border);
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.95);
    font-size: 1.05rem;
    transition: all 0.3s;
    font-family: inherit;
    font-weight: 500;
    }

    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 5px rgba(26, 82, 118, 0.15);
    transform: translateY(-2px);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Buttons
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn {
    cursor: pointer;
    border: none;
    padding: 14px 24px;
    border-radius: 16px;
    font-weight: 700;
    transition: all 0.4s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    font-size: 1rem;
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    }

    .btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    transition: width 0.6s, height 0.6s;
    transform: translate(-50%, -50%);
    }

    .btn:hover::before {
    width: 300px;
    height: 300px;
    }

    .btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .btn-primary {
    background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%);
    color: white;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Loading Spinner
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .loading {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 20000;
    }

    .spinner {
    border: 8px solid rgba(255,255,255,0.3);
    border-top: 8px solid var(--primary);
    border-radius: 50%;
    width: 80px;
    height: 80px;
    animation: spin 1s linear infinite;
    }

    @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Footer
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .engineer-footer {
    background: linear-gradient(135deg, rgba(28, 40, 51, 0.98) 0%, rgba(44, 62, 80, 0.98) 100%);
    backdrop-filter: blur(15px);
    color: #ecf0f1;
    text-align: center;
    padding: 18px;
    position: fixed;
    bottom: 0;
    width: 100%;
    font-size: 0.95rem;
    border-top: 4px solid var(--accent);
    z-index: 999;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
    font-weight: 600;
    letter-spacing: 0.5px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Responsive
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 768px) {
    /* Header Mobile Optimization */
    header {
    padding: 4px 8px !important;
    min-height: auto !important;
    }

    header > div {
    gap: 4px !important;
    }

    header img {
    width: 22px !important;
    height: 22px !important;
    padding: 2px !important;
    }

    .header-title {
    min-width: 0 !important;
    flex: 1 !important;
    }

    .header-title h1 {
    font-size: 0.65rem !important;
    margin: 0 !important;
    line-height: 1.1 !important;
    }

    .header-title small {
    font-size: 0.5rem !important;
    display: block;
    }

    header button {
    padding: 4px 6px !important;
    font-size: 0.6rem !important;
    white-space: nowrap;
    min-width: auto !important;
    }

    /* Portal Section Mobile */
    .portal-container {
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 0 8px;
    }

    .portal-box {
    padding: 15px 12px;
    min-height: 140px;
    }

    .portal-box i {
    font-size: 40px !important;
    }

    .portal-box h2 {
    font-size: 0.9rem !important;
    margin: 8px 0 !important;
    }

    .portal-box p {
    font-size: 0.75rem !important;
    line-height: 1.3 !important;
    }

    /* Form Grid Mobile */
    .form-grid {
    grid-template-columns: 1fr;
    gap: 10px;
    }

    /* Cards Mobile */
    .card {
    padding: 12px 8px;
    margin-bottom: 12px;
    }

    /* Buttons Mobile */
    .btn {
    padding: 8px 12px !important;
    font-size: 0.75rem !important;
    white-space: nowrap;
    }

    /* Control Buttons - Stack vertically on mobile */
    #adminPanel > div:nth-of-type(2) {
    flex-direction: column !important;
    gap: 10px !important;
    }

    #adminPanel > div:nth-of-type(2) > button {
    width: 100% !important;
    justify-content: center !important;
    }

    /* Search container - Stack vertically */
    #adminPanel > div:nth-of-type(2) > div {
    width: 100% !important;
    flex-direction: column !important;
    }

    #searchType, #searchInput {
    width: 100% !important;
    }

    /* Container Mobile */
    .container {
    padding: 8px !important;
    }

    /* Headings Mobile */
    h2 {
    font-size: 1rem !important;
    margin: 10px 0 !important;
    }

    /* Input Fields Mobile */
    .input-group input,
    .input-group select,
    .input-group textarea {
    padding: 8px !important;
    font-size: 0.8rem !important;
    }

    .input-group label {
    font-size: 0.75rem !important;
    }

    /* Stats Cards Mobile - Smaller */
    .stat-card {
    padding: 6px !important;
    border-radius: 10px !important;
    }

    .stat-card h3 {
    font-size: 1rem !important;
    margin: 3px 0 !important;
    }

    .stat-card p {
    font-size: 0.6rem !important;
    margin: 0 !important;
    }

    .stat-card small {
    font-size: 0.6rem !important;
    display: none !important; /* Hide "Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶" on mobile */
    }

    /* Make stats grid 2 columns on mobile (compact) */
    #adminPanel > div:first-of-type {
    grid-template-columns: 1fr 1fr !important;
    gap: 6px !important;
    margin-bottom: 12px !important;
    }

    /* Search Mobile */
    #searchInput {
    padding: 8px !important;
    font-size: 0.8rem !important;
    }

    #searchType {
    padding: 6px !important;
    font-size: 0.75rem !important;
    min-width: 80px !important;
    }

    /* Table Mobile - Hide non-essential columns */
    .table-container {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
    width: 100% !important;
    }

    table {
    font-size: 0.65rem !important;
    width: 100% !important;
    }

    table th {
    padding: 6px 4px !important;
    font-size: 0.65rem !important;
    background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%) !important;
    color: white !important;
    font-weight: 600 !important;
    }

    table td {
    padding: 6px 4px !important;
    font-size: 0.65rem !important;
    }

    /* Hide non-essential columns on mobile by default */
    table th:nth-child(4),  /* Type */
    table td:nth-child(4),
    table th:nth-child(5),  /* Year */
    table td:nth-child(5),
    table th:nth-child(6),  /* Chassis */
    table td:nth-child(6),
    table th:nth-child(7),  /* Motor */
    table td:nth-child(7),
    table th:nth-child(9),  /* Date */
    table td:nth-child(9),
    table th:nth-child(11), /* Images */
    table td:nth-child(11),
    table th:nth-child(12), /* Actions */
    table td:nth-child(12) {
    display: none !important;
    }

    /* Show hidden columns when toggle is active */
    table.show-all-columns th,
    table.show-all-columns td {
    display: table-cell !important;
    }
    }

    table td {
    padding: 3px 2px !important;
    font-size: 0.6rem !important;
    white-space: nowrap;
    }

    table td button {
    padding: 4px 6px !important;
    font-size: 0.65rem !important;
    }

    /* Action Buttons in Table */
    table td:last-child {
    display: flex !important;
    gap: 2px !important;
    flex-wrap: nowrap !important;
    }

    /* Make buttons stack on mobile for control panel */
    .card > div:first-child {
    flex-direction: column !important;
    gap: 6px !important;
    }

    .card > div:first-child > div {
    width: 100% !important;
    flex-direction: column !important;
    gap: 6px !important;
    }

    .card > div:first-child button {
    width: 100% !important;
    }

    /* Pagination Mobile */
    #paginationControls {
    flex-direction: column !important;
    gap: 8px !important;
    align-items: stretch !important;
    }

    #paginationControls > div {
    width: 100% !important;
    justify-content: center !important;
    }

    #paginationControls button {
    padding: 6px 10px !important;
    font-size: 0.7rem !important;
    }

    #paginationControls select {
    padding: 6px !important;
    font-size: 0.7rem !important;
    }

    /* Modal Mobile */
    .modal-content {
    width: 95% !important;
    max-width: 95% !important;
    margin: 5% auto !important;
    padding: 15px !important;
    }

    .modal-content h3 {
    font-size: 1rem !important;
    }

    .modal-content button {
    padding: 8px 12px !important;
    font-size: 0.75rem !important;
    }

    /* Welcome Text Mobile */
    #portalSection h2 {
    font-size: 1.3rem !important;
    margin-top: 20px !important;
    margin-bottom: 10px !important;
    }

    #portalSection p {
    font-size: 0.85rem !important;
    margin-bottom: 20px !important;
    }

    /* Table Responsive Styles */
    table {
    font-size: 0.85rem;
    }

    table th, table td {
    white-space: nowrap;
    }

    @media (max-width: 1024px) {
    table {
    font-size: 0.7rem;
    }
    table th {
    padding: 5px 3px !important;
    font-size: 0.7rem !important;
    }
    table td {
    padding: 4px 2px !important;
    font-size: 0.65rem !important;
    }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Vehicle Cards
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .vehicle-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
    backdrop-filter: blur(10px);
    padding: 30px 20px;
    border-radius: 20px;
    text-align: center;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
    }

    .vehicle-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(26, 82, 118, 0.1) 0%, transparent 70%);
    transform: scale(0);
    transition: transform 0.5s ease;
    }

    .vehicle-card:hover::before {
    transform: scale(1);
    }

    .vehicle-card:hover {
    transform: translateY(-10px) scale(1.05);
    border-color: var(--primary);
    box-shadow: 0 20px 50px rgba(26, 82, 118, 0.3);
    }

    .vehicle-card.selected {
    border-color: var(--secondary);
    background: linear-gradient(135deg, rgba(39, 174, 96, 0.15) 0%, rgba(46, 204, 113, 0.15) 100%);
    box-shadow: 0 15px 40px rgba(39, 174, 96, 0.4);
    transform: scale(1.05);
    }

    .vehicle-card.selected::after {
    content: 'âœ“';
    position: absolute;
    top: 10px;
    right: 10px;
    width: 35px;
    height: 35px;
    background: var(--secondary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.5);
    }
    </style>
    </head>
    <body>

    <!-- Loading Spinner -->
    <div class="loading" id="loadingSpinner">
    <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header>
    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; width: 100%;">
    <div style="display: flex; align-items: center; gap: 6px;">
    <img src="https://i.postimg.cc/Hs92TtbL/41jjsn4SHDL-AC-UF894-1000-QL80.jpg" 
    style="width: 35px; height: 35px; object-fit: contain; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); background: white; padding: 3px; border: 1px solid rgba(255,255,255,0.5);" 
    alt="Ø¹Ù„Ù… Ù…ØµØ±">
    <img src="https://i.postimg.cc/brFBgHg7/Flag-of-Sharkiya-Governorate.png" 
    style="width: 35px; height: 35px; object-fit: contain; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); background: white; padding: 3px; border: 1px solid rgba(255,255,255,0.5);" 
    alt="Ø¹Ù„Ù… Ø§Ù„Ø´Ø±Ù‚ÙŠØ©">
    </div>
    <div class="header-title" style="flex: 1; min-width: 150px;">
    <h1 style="font-size: 0.9rem; margin: 0; line-height: 1.2;">ï¿½ Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±</h1>>
    <small style="font-size: 0.65rem; opacity: 0.85;">Ø¯/ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ù‚Ø¯Ù…</small>
    </div>
    <div style="display:flex; gap:6px; flex-wrap: wrap;">
    <button id="goPortalBtn" class="btn" style="background: rgba(255,255,255,0.15); color: white; display:none; padding: 6px 10px; font-size: 0.75rem;" onclick="goToPortal()">ğŸ  Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©</button>
    <button id="logoutBtn" class="btn" style="background: rgba(255,0,0,0.3); color: white; border: 2px solid rgba(255,255,255,0.4); display:none; cursor:pointer; padding: 6px 10px; font-size: 0.75rem;" onclick="logoutAdmin()">ğŸšª Ø®Ø±ÙˆØ¬</button>
    <button id="loginBtn" class="btn" style="background: rgba(255,255,255,0.25); color: white; border: 2px solid rgba(255,255,255,0.4); padding: 6px 10px; font-size: 0.75rem;">ğŸ” Ø§Ù„ØªØ­ÙƒÙ…</button>
    </div>
    </div>
    </header>

    <!-- Egyptian Flag Stripe -->
    <div style="height: 8px; background: linear-gradient(90deg, #ce1126 0%, #ce1126 33.33%, #ffffff 33.33%, #ffffff 66.66%, #000000 66.66%, #000000 100%); box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>

    <!-- Main Container -->
    <div class="container">

    <!-- Portal Section -->
    <div id="portalSection">
    <h2 style="text-align: center; color: white; margin-top: 50px; margin-bottom: 15px; font-size: 2.5rem; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">
    Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©
    </h2>
    <p style="text-align: center; color: rgba(255,255,255,0.9); margin-bottom: 50px; font-size: 1.2rem; text-shadow: 0 2px 5px rgba(0,0,0,0.2);">
    ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø°ÙŠ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„ÙŠÙ‡
    </p>

    <div class="portal-container">
    <!-- Tuk Tuk Coding Portal -->
    <div class="portal-box" onclick="openService('citizenPage')" style="border-bottom: 6px solid var(--primary);">
    <img src="https://i.postimg.cc/QtgDfPKv/images-(1).jpg" style="width: 120px; height: 100px; object-fit: contain; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);" alt="ØªÙˆÙƒØªÙˆÙƒ">
    <h2 style="color: var(--primary);">ØªÙƒÙˆÙŠØ¯ Ø§Ù„ØªÙˆÙƒØªÙˆÙƒ</h2>
    <p>ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙƒØªÙˆÙƒ Ø¨Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø°ÙƒÙŠØ©</p>
    </div>

    <!-- Inquiry Portal -->
    <div class="portal-box" onclick="openService('inquiryPage')" style="border-bottom: 6px solid var(--secondary);">
    <i style="font-style: normal; font-size: 85px;">ğŸ”</i>
    <h2 style="color: var(--secondary);">Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
    <p>ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ ÙˆÙ…Ø¹Ø±ÙØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ù…Ø±ÙƒØ¨ØªÙƒ</p>
    </div>

    <!-- Complaints Portal -->
    <div class="portal-box" onclick="openService('complaintsPage')" style="border-bottom: 6px solid var(--accent);">
    <i style="font-style: normal; font-size: 85px;">âš–ï¸</i>
    <h2 style="color: var(--accent);">ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰</h2>
    <p>ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ø¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„</p>
    </div>

    <!-- Complaint Inquiry Portal -->
    <div class="portal-box" onclick="openService('complaintInquiryPage')" style="border-bottom: 6px solid var(--warning);">
    <i style="font-style: normal; font-size: 85px;">ğŸ“‹</i>
    <h2 style="color: var(--warning);">Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø´ÙƒÙˆÙ‰</h2>
    <p>ØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø´ÙƒÙˆØ§Ùƒ ÙˆØ§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯</p>
    </div>
    </div>

    <!-- Contact Buttons -->
    <div style="display: flex; justify-content: center; gap: 25px; margin-top: 50px; margin-bottom: 30px;">
    <a href="https://wa.me/201021102607?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø­ØªØ§Ø¬ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©" target="_blank" style="text-decoration: none;" title="ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨">
    <button style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); border: none; cursor: pointer; box-shadow: 0 10px 30px rgba(37, 211, 102, 0.4); transition: all 0.3s; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">
    ğŸ’¬
    </button>
    </a>
    <a href="tel:+201021102607" style="text-decoration: none;" title="Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±">
    <button style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #3498db 0%, #2874a6 100%); border: none; cursor: pointer; box-shadow: 0 10px 30px rgba(52, 152, 219, 0.4); transition: all 0.3s; display: flex; align-items: center; justify-content: center; font-size: 2.5rem;">
    ğŸ“
    </button>
    </a>
    </div>

    <p style="text-align: center; color: rgba(255,255,255,0.9); margin-top: 10px; margin-bottom: 30px; font-size: 1rem;">
    </p>
    </div>

    <!-- Citizen Page (Tuk Tuk Registration) -->
    <div id="citizenPage" style="display:none;">
    <div class="card">
    <h2 style="text-align: center; color: var(--primary); margin-bottom: 30px; font-size: 2rem;">ï¿½ ØªØ³Ø¬ÙŠÙ„ ØªÙˆÙƒØªÙˆÙƒ Ø¬Ø¯ÙŠØ¯</h2>

    <!-- Registration Form -->
    <div id="registrationForm">
    <div style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.1) 0%, rgba(52, 152, 219, 0.1) 100%); padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: center; border: 2px solid var(--primary);">
    <img src="https://i.postimg.cc/QtgDfPKv/images-(1).jpg" style="width: 100px; height: 80px; object-fit: contain; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);" alt="ØªÙˆÙƒØªÙˆÙƒ">
    <p style="margin: 0; color: var(--primary); font-size: 1.3rem; font-weight: 700;">
    ØªØ³Ø¬ÙŠÙ„ ØªÙˆÙƒØªÙˆÙƒ
    </p>
    </div>

    <div class="form-grid">
    <div class="input-group" style="grid-column: 1 / -1;">
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ</label>
    <input type="text" id="ownerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
    </div>

    <div class="input-group">
    <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
    <input type="text" id="nationalId" maxlength="14" placeholder="Ù…Ø«Ø§Ù„: 29501011234567" oninput="validateNationalId(this)">
    <div id="nidValidation" style="font-size: 0.85rem; margin-top: 8px; padding: 8px 12px; border-radius: 8px; display: none; font-weight: 600;"></div>
    </div>

    <div class="input-group">
    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ)</label>
    <small style="color: #666; font-size: 0.85rem; display: block; margin-bottom: 8px; line-height: 1.5;">
    âš ï¸ Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙˆÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
    </small>
    <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 10px;">
    <select id="birthDay" onchange="verifyBirthDate()" style="padding: 12px; border: 2px solid var(--glass-border); border-radius: 12px; font-size: 1rem; font-weight: 600;">
    <option value="">Ø§Ù„ÙŠÙˆÙ…</option>
    </select>
    <select id="birthMonth" onchange="verifyBirthDate()" style="padding: 12px; border: 2px solid var(--glass-border); border-radius: 12px; font-size: 1rem; font-weight: 600;">
    <option value="">Ø§Ù„Ø´Ù‡Ø±</option>
    <option value="01">ÙŠÙ†Ø§ÙŠØ±</option>
    <option value="02">ÙØ¨Ø±Ø§ÙŠØ±</option>
    <option value="03">Ù…Ø§Ø±Ø³</option>
    <option value="04">Ø£Ø¨Ø±ÙŠÙ„</option>
    <option value="05">Ù…Ø§ÙŠÙˆ</option>
    <option value="06">ÙŠÙˆÙ†ÙŠÙˆ</option>
    <option value="07">ÙŠÙˆÙ„ÙŠÙˆ</option>
    <option value="08">Ø£ØºØ³Ø·Ø³</option>
    <option value="09">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
    <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
    <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
    <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
    </select>
    <select id="birthYear" onchange="verifyBirthDate()" style="padding: 12px; border: 2px solid var(--glass-border); border-radius: 12px; font-size: 1rem; font-weight: 600;">
    <option value="">Ø§Ù„Ø³Ù†Ø©</option>
    </select>
    </div>
    <input type="hidden" id="birthDate">
    <div id="birthValidation" style="font-size: 0.85rem; margin-top: 8px; padding: 8px 12px; border-radius: 8px; display: none; font-weight: 600;"></div>
    </div>

    <div class="input-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
    <input type="tel" id="phone" maxlength="11" placeholder="01XXXXXXXXX">
    </div>

    <div class="input-group">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>
    <input type="text" id="vType" readonly style="background: rgba(39, 174, 96, 0.1); border: 2px solid var(--secondary); font-weight: 700; color: var(--secondary); font-size: 1.1rem; cursor: not-allowed;">
    </div>

    <div class="input-group">
    <label>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø§Ù„Ø³Ù†Ø©)</label>
    <select id="vYear"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©...</option></select>
    </div>

    <div class="input-group" style="grid-column: 1 / -1;">
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <input type="text" id="address" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„">
    </div>

    <div class="input-group" style="grid-column: 1 / -1;">
    <label>Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</label>
    <input type="file" id="multiFiles" multiple accept="image/*" style="padding: 30px; border: 3px dashed var(--primary);">
    <small style="color: #666; margin-top: 10px; display: block;">âœ“ ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø¹Ø¯Ø© ØµÙˆØ± (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10MB Ù„ÙƒÙ„ ØµÙˆØ±Ø©)</small>
    <small style="color: var(--secondary); margin-top: 5px; display: block; font-weight: 600;">ğŸ“¸ Ø³ÙŠØªÙ… Ø¶ØºØ· Ø§Ù„ØµÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø±ÙØ¹</small>
    </div>
    </div>

    <button id="submitBtn" class="btn btn-primary" style="width: 100%; font-size: 1.4rem; margin-top: 35px; padding: 20px;">
    Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ…
    </button>
    </div>
    </div>
    </div>

    <!-- Inquiry Page -->
    <div id="inquiryPage" style="display:none;">
    <div class="card" style="border: 3px solid var(--secondary);">
    <h2 style="text-align: center; color: var(--secondary); margin-bottom: 40px; font-size: 2rem;">ğŸ” Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
    <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1rem;">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ</p>

    <div class="form-grid">
    <div class="input-group" style="grid-column: 1 / -1;">
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</label>
    <input type="text" id="inqOwnerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
    </div>

    <div class="input-group">
    <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
    <input type="text" id="inqNationalId" maxlength="14" placeholder="29501011234567">
    </div>

    <div class="input-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
    <input type="tel" id="inqPhone" maxlength="11" placeholder="01XXXXXXXXX">
    </div>
    </div>

    <button id="inquiryBtn" class="btn btn-primary" style="width: 100%; font-size: 1.4rem; margin-top: 35px; padding: 20px;">
    ğŸ” Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù†
    </button>

    <div id="inquiryResult" style="display:none; margin-top: 40px; padding: 40px; border-radius: 25px; text-align: center;"></div>
    </div>
    </div>

    <!-- Complaints Page -->
    <div id="complaintsPage" style="display:none;">
    <div class="card" style="border: 3px solid var(--accent);">
    <h2 style="text-align: center; color: var(--accent); margin-bottom: 30px; font-size: 2rem;">âš–ï¸ ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰</h2>
    <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 1.05rem;">Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰</p>

    <div class="form-grid">
    <div class="input-group" style="grid-column: 1 / -1;">
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</label>
    <input type="text" id="compOwnerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    </div>

    <div class="input-group">
    <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
    <input type="text" id="compNationalId" maxlength="14" placeholder="29501011234567">
    </div>

    <div class="input-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
    <input type="tel" id="compPhone" maxlength="11" placeholder="01XXXXXXXXX">
    </div>

    <div class="input-group">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰</label>
    <select id="compType">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
    <option value="Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø¬Ø±Ø©">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø¬Ø±Ø©</option>
    <option value="Ø³ÙˆØ¡ Ù…Ø¹Ø§Ù…Ù„Ø©">Ø³ÙˆØ¡ Ù…Ø¹Ø§Ù…Ù„Ø©</option>
    <option value="Ù‚ÙŠØ§Ø¯Ø© Ù…ØªÙ‡ÙˆØ±Ø©">Ù‚ÙŠØ§Ø¯Ø© Ù…ØªÙ‡ÙˆØ±Ø©</option>
    <option value="Ù…Ø±ÙƒØ¨Ø© Ù…Ø®Ø§Ù„ÙØ©">Ù…Ø±ÙƒØ¨Ø© Ù…Ø®Ø§Ù„ÙØ©</option>
    <option value="Ø¹Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ÙƒÙˆØ¯">Ø¹Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ÙƒÙˆØ¯</option>
    <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
    </select>
    </div>

    <div class="input-group" style="grid-column: 1 / -1;">
    <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰</label>
    <textarea id="compDetails" rows="5" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„..."></textarea>
    </div>

    <!-- ØµÙˆØ±Ø© Ø³ÙŠÙ„ÙÙŠ -->
    <div class="input-group" style="grid-column: 1 / -1;">
    <label style="color: var(--accent); font-size: 1.1rem;">ğŸ“¸ ØµÙˆØ±Ø© Ø³ÙŠÙ„ÙÙŠ (Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©)</label>
    <input type="file" id="compSelfie" accept="image/*" capture="user" style="padding: 20px; border: 3px dashed var(--accent); background: rgba(211, 84, 0, 0.05);">
    <small style="color: #666; margin-top: 10px; display: block;">âœ“ Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© Ø³ÙŠÙ„ÙÙŠ ÙˆØ§Ø¶Ø­Ø© Ù„ÙˆØ¬Ù‡Ùƒ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10MB)</small>
    </div>

    <!-- ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
    <div class="input-group" style="grid-column: 1 / -1;">
    <label style="color: var(--accent); font-size: 1.1rem;">ğŸªª ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
    <input type="file" id="compIdCard" accept="image/*" style="padding: 20px; border: 3px dashed var(--accent); background: rgba(211, 84, 0, 0.05);">
    <small style="color: #666; margin-top: 10px; display: block;">âœ“ ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© (Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ)</small>
    </div>

    <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© -->
    <div class="input-group" style="grid-column: 1 / -1;">
    <label style="color: var(--accent); font-size: 1.1rem;">ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
    <input type="file" id="compProblemImage" accept="image/*" multiple style="padding: 20px; border: 3px dashed var(--accent); background: rgba(211, 84, 0, 0.05);">
    <small style="color: #666; margin-top: 10px; display: block;">âœ“ ØµÙˆØ± ØªÙˆØ¶Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø£Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ù (ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø©)</small>
    </div>

    <!-- ØµÙˆØ±Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯ -->
    <div class="input-group" style="grid-column: 1 / -1;">
    <label style="color: var(--accent); font-size: 1.1rem;">ğŸšœ ØµÙˆØ±Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯</label>
    <input type="file" id="compVehicleImage" accept="image/*" style="padding: 20px; border: 3px dashed var(--accent); background: rgba(211, 84, 0, 0.05);">
    <small style="color: #666; margin-top: 10px; display: block;">âœ“ ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„ØªÙƒÙˆÙŠØ¯</small>
    </div>
    </div>

    <!-- Ù…Ù„Ø®Øµ Ø§Ù„ØµÙˆØ± -->
    <div id="compImagesSummary" style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.1) 0%, rgba(186, 74, 0, 0.1) 100%); padding: 20px; border-radius: 15px; margin: 25px 0; border: 2px solid rgba(211, 84, 0, 0.3); display: none;">
    <h4 style="color: var(--accent); margin-top: 0;">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©:</h4>
    <div id="compImagesList" style="display: flex; flex-direction: column; gap: 10px;"></div>
    </div>

    <button id="submitCompBtn" class="btn" style="width: 100%; background: linear-gradient(135deg, var(--accent) 0%, #ba4a00 100%); color: white; padding: 20px; font-size: 1.3rem; margin-top: 30px;">
    Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´ÙƒÙˆÙ‰ âœ‰ï¸
    </button>
    </div>
    </div>

    <!-- Complaint Inquiry Page -->
    <div id="complaintInquiryPage" style="display:none;">
    <div class="card" style="border: 3px solid var(--warning);">
    <h2 style="text-align: center; color: var(--warning); margin-bottom: 40px; font-size: 2rem;">ğŸ“‹ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø´ÙƒÙˆÙ‰</h2>
    <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1rem;">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø´ÙƒÙˆØ§Ùƒ</p>

    <div class="form-grid">
    <div class="input-group" style="grid-column: 1 / -1;">
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</label>
    <input type="text" id="compInqOwnerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
    </div>

    <div class="input-group">
    <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
    <input type="text" id="compInqNationalId" maxlength="14" placeholder="29501011234567">
    </div>

    <div class="input-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
    <input type="tel" id="compInqPhone" maxlength="11" placeholder="01XXXXXXXXX">
    </div>
    </div>

    <button id="complaintInquiryBtn" class="btn" style="width: 100%; font-size: 1.4rem; margin-top: 35px; padding: 20px; background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%); color: white;">
    ğŸ“‹ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø´ÙƒÙˆÙ‰
    </button>

    <div id="complaintInquiryResult" style="display:none; margin-top: 40px;"></div>
    </div>
    </div>

    <!-- Admin Page -->
    <div id="adminPage" style="display:none;">
    <!-- Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; margin-bottom: 35px;">
    <div class="stat-card" onclick="showAllOrders()" style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.15) 0%, rgba(52, 152, 219, 0.15) 100%); backdrop-filter: blur(10px); padding: 30px; border-radius: 25px; text-align: center; border: 3px solid var(--primary); box-shadow: 0 8px 25px rgba(26, 82, 118, 0.2); cursor: pointer; transition: all 0.3s ease;">
    <p style="margin: 0; color: var(--primary); font-size: 1rem; font-weight: 600;">ğŸ“‹ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
    <h3 id="statTotal" style="margin: 15px 0; font-size: 2.5rem; color: var(--primary); font-weight: bold;">0</h3>
    <small style="color: #666; font-size: 0.85rem;">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶</small>
    </div>
    <div class="stat-card" onclick="showCodedOrders()" style="background: linear-gradient(135deg, rgba(39, 174, 96, 0.15) 0%, rgba(46, 204, 113, 0.15) 100%); backdrop-filter: blur(10px); padding: 30px; border-radius: 25px; text-align: center; border: 3px solid var(--secondary); box-shadow: 0 8px 25px rgba(39, 174, 96, 0.2); cursor: pointer; transition: all 0.3s ease;">
    <p style="margin: 0; color: var(--secondary); font-size: 1rem; font-weight: 600;">âœ… ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯</p>
    <h3 id="statCoded" style="margin: 15px 0; font-size: 2.5rem; color: var(--secondary); font-weight: bold;">0</h3>
    <small style="color: #666; font-size: 0.85rem;">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶</small>
    </div>
    <div class="stat-card" onclick="showPendingOrders()" style="background: linear-gradient(135deg, rgba(243, 156, 18, 0.15) 0%, rgba(214, 137, 16, 0.15) 100%); backdrop-filter: blur(10px); padding: 30px; border-radius: 25px; text-align: center; border: 3px solid var(--warning); box-shadow: 0 8px 25px rgba(243, 156, 18, 0.2); cursor: pointer; transition: all 0.3s ease;">
    <p style="margin: 0; color: var(--warning); font-size: 1rem; font-weight: 600;">â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
    <h3 id="statPending" style="margin: 15px 0; font-size: 2.5rem; color: var(--warning); font-weight: bold;">0</h3>
    <small style="color: #666; font-size: 0.85rem;">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶</small>
    </div>
    <div class="stat-card" onclick="showComplaintsTable()" style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.15) 0%, rgba(186, 74, 0, 0.15) 100%); backdrop-filter: blur(10px); padding: 30px; border-radius: 25px; text-align: center; border: 3px solid var(--accent); box-shadow: 0 8px 25px rgba(211, 84, 0, 0.2); cursor: pointer; transition: all 0.3s ease;">
    <p style="margin: 0; color: var(--accent); font-size: 1rem; font-weight: 600;">âš–ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</p>
    <h3 id="statCompTotal" style="margin: 15px 0; font-size: 2.5rem; color: var(--accent); font-weight: bold;">0</h3>
    <small style="color: #666; font-size: 0.85rem;">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶</small>
    </div>
    </div>

    <style>
    .stat-card:hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 0 15px 40px rgba(0,0,0,0.3) !important;
    }

    .stat-card:active {
    transform: translateY(-4px) scale(1.02);
    }

    .stat-card {
    position: relative;
    overflow: hidden;
    }

    .stat-card::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
    }

    .stat-card:hover::before {
    width: 300px;
    height: 300px;
    }
    </style>

    <div class="card">
    <!-- Control Buttons -->
    <div style="display:flex; gap:15px; margin-bottom:35px; flex-wrap: wrap; align-items: center;">
    <button id="showOrdersBtn" class="btn" style="background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%); color: white;">ğŸšœ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</button>
    <button id="showComplaintsBtn" class="btn" style="background: linear-gradient(135deg, var(--accent) 0%, #ba4a00 100%); color: white;">âš–ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</button>
    <button id="showAdminLogsBtn" class="btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</button>
    <button id="bulkImportBtn" class="btn" style="background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%); color: white;">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel</button>
    <button id="dateFilterBtn" class="btn" style="background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%); color: white;">ğŸ“… ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®</button>
    <button id="toggleColumnsBtn" class="btn" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; display: none;">ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©</button>
    <div style="flex: 1; display: flex; gap: 10px;">
    <select id="searchType" style="padding: 12px; border-radius: 12px; border: 2px solid var(--glass-border); background: rgba(255,255,255,0.95); font-weight: 600; min-width: 150px;">
    <option value="all">ğŸ” Ø§Ù„ÙƒÙ„</option>
    <option value="name">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…</option>
    <option value="code">ğŸ”¢ Ø§Ù„ÙƒÙˆØ¯</option>
    <option value="nationalId">ğŸ†” Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</option>
    <option value="phone">ğŸ“± Ø§Ù„Ù‡Ø§ØªÙ</option>
    <option value="chassis">ï¿½ Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡</option>
    <option value="motor">âš™ï¸ Ø§Ù„Ù…ÙˆØªÙˆØ±</option>
    </select>
    <input type="text" id="searchInput" oninput="window.searchOrders()" style="flex: 1; padding:16px; border-radius:16px; border:2px solid var(--glass-border); background:rgba(255,255,255,0.95); font-weight:600;" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª..." title="Ø§Ù„Ø¨Ø­Ø« ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©">
    </div>
    <button id="exportExcelBtn" class="btn" style="background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color:white;">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
    <button id="cleanDuplicatesMainBtn" class="btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;">ğŸ§¹ Ø­Ø°Ù Ø§Ù„Ù…ÙƒØ±Ø±</button>
    <button onclick="location.reload()" class="btn" style="background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white;">ğŸšª Ø®Ø±ÙˆØ¬</button>
    </div>

    <!-- Filter Status Message -->
    <div id="filterStatus" style="display:none; background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(26, 82, 118, 0.1) 100%); padding: 15px 25px; border-radius: 15px; margin-bottom: 20px; border: 2px solid var(--info); text-align: center;">
    <p style="margin: 0; color: var(--info); font-weight: bold; font-size: 1.1rem;">
    <span id="filterStatusText">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
    <button onclick="showAllOrders()" style="background: rgba(52, 152, 219, 0.2); border: none; padding: 5px 15px; border-radius: 8px; margin-right: 15px; cursor: pointer; color: var(--info); font-weight: bold;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    </p>
    </div>

    <!-- Pagination Controls -->
    <div id="paginationControls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, rgba(142, 68, 173, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%); border-radius: 15px; border: 2px solid #8e44ad;">
    <div style="display: flex; gap: 10px; align-items: center;">
    <button onclick="window.changePage(-1)" class="btn" style="padding: 10px 20px; background: linear-gradient(135deg, #3498db 0%, #2874a6 100%); color: white;">â®ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
    <span id="pageInfo" style="font-weight: bold; color: #8e44ad; font-size: 1.1rem;">ØµÙØ­Ø© 1 Ù…Ù† 1</span>
    <button onclick="window.changePage(1)" class="btn" style="padding: 10px 20px; background: linear-gradient(135deg, #3498db 0%, #2874a6 100%); color: white;">Ø§Ù„ØªØ§Ù„ÙŠ â­ï¸</button>
    </div>
    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
    <button id="loadAllDataBtn" onclick="window.loadAllData()" class="btn" style="padding: 10px 20px; background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); color: white; display: none;">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <label style="font-weight: 600; color: #555;">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø©:</label>
    <select id="recordsPerPage" onchange="window.changeRecordsPerPage()" style="padding: 8px 15px; border-radius: 10px; border: 2px solid #8e44ad; font-weight: 600; background: white;">
    <option value="50">50</option>
    <option value="100" selected>100</option>
    <option value="200">200</option>
    <option value="500">500</option>
    </select>
    <span id="totalRecordsInfo" style="font-weight: bold; color: #27ae60; font-size: 1.1rem;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø³Ø¬Ù„</span>
    <span id="loadingMoreInfo" style="font-weight: 600; color: #e67e22; font-size: 0.9rem; display: none;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>
    </div>

    <!-- Orders Table -->
    <div id="ordersTableContainer" style="overflow-x:auto; -webkit-overflow-scrolling: touch;">
    <table id="excelTable" style="width: 100%; border-collapse: separate; border-spacing: 0 10px;">
    <thead>
    <tr>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ù‡Ø§ØªÙ</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ù†ÙˆØ¹</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ù…ÙˆØªÙˆØ±</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„ÙƒÙˆØ¯</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">ğŸ“· Ø§Ù„ØµÙˆØ±</th>
    <th style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); color: white; padding: 8px 6px; font-size: 0.85rem; position: sticky; top: 0; z-index: 10;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>
    </thead>
    <tbody id="dataTable"></tbody>
    </table>
    </div>

    <!-- Complaints Table -->
    <div id="complaintsTableContainer" style="overflow-x:auto; display: none;">
    <table id="complaintsTable" style="width: 100%; border-collapse: separate; border-spacing: 0 10px;">
    <thead>
    <tr>
    <th style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.95) 0%, rgba(186, 74, 0, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„Ø§Ø³Ù…</th>
    <th style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.95) 0%, rgba(186, 74, 0, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„Ù‡Ø§ØªÙ</th>
    <th style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.95) 0%, rgba(186, 74, 0, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰</th>
    <th style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.95) 0%, rgba(186, 74, 0, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
    <th style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.95) 0%, rgba(186, 74, 0, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</th>
    <th style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.95) 0%, rgba(186, 74, 0, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
    <th style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.95) 0%, rgba(186, 74, 0, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>
    </thead>
    <tbody id="compTableBody"></tbody>
    </table>
    </div>

    <!-- Admin Logs Table -->
    <div id="adminLogsTableContainer" style="overflow-x:auto; display: none;">
    <h3 style="color: #e74c3c; margin-bottom: 25px; text-align: center; font-size: 1.8rem;">ğŸ“œ Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</h3>
    <table id="adminLogsTable" style="width: 100%; border-collapse: separate; border-spacing: 0 10px;">
    <thead>
    <tr>
    <th style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.95) 0%, rgba(192, 57, 43, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„Ù…Ø´Ø±Ù</th>
    <th style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.95) 0%, rgba(192, 57, 43, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
    <th style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.95) 0%, rgba(192, 57, 43, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
    <th style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.95) 0%, rgba(192, 57, 43, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
    <th style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.95) 0%, rgba(192, 57, 43, 0.95) 100%); color: white; padding: 20px; font-size: 1rem;">IP Address</th>
    </tr>
    </thead>
    <tbody id="adminLogsTableBody"></tbody>
    </table>
    </div>
    </div>
    </div>

    <!-- Modal for Images -->
    <div id="imgModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <span onclick="document.getElementById('imgModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: white; font-size: 45px; cursor: pointer; z-index: 10001;">&times;</span>
    <img id="mainViewImg" style="max-width:90%; max-height:80vh; display:block; margin:80px auto 30px; border:8px solid white; border-radius:25px;">
    <div id="modalThumbnails" style="display: flex; justify-content: center; gap: 15px; padding: 25px; flex-wrap: wrap;"></div>
    </div>

    <!-- Modal for Coding -->
    <div id="codeModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <div style="background: white; margin: 5% auto; padding: 45px; width: 92%; max-width: 500px; border-radius: 35px; text-align: center; position: relative;">
    <span onclick="document.getElementById('codeModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer;">&times;</span>
    <h3 style="color: var(--primary); font-size: 1.8rem; margin-bottom: 30px;">ğŸ”¢ ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</h3>
    <p id="codeHint" style="font-size:1.1rem; color:#555; background: rgba(0,0,0,0.06); padding:18px; border-radius:15px; margin: 25px 0; font-weight: 600;"></p>
    <div class="input-group">
    <label style="justify-content: center;">Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ù…Ø±ÙƒØ¨Ø©:</label>
    <input type="text" id="manualCodeInput" style="text-align:center; font-size:2.5rem; font-weight:bold; color:var(--secondary); border: 3px solid var(--secondary); height: 80px;">
    </div>

    <!-- WhatsApp Notification Checkbox -->
    <div style="background: linear-gradient(135deg, rgba(37, 211, 102, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%); padding: 20px; border-radius: 15px; margin: 25px 0; border: 2px solid rgba(37, 211, 102, 0.3);">
    <label style="display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; font-size: 1.1rem; color: #16a34a; font-weight: 700;">
    <input type="checkbox" id="sendWhatsAppCode" checked style="width: 24px; height: 24px; cursor: pointer; accent-color: #16a34a;">
    <span>ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…ÙˆØ§Ø·Ù†</span>
    </label>
    <small style="display: block; text-align: center; color: #666; margin-top: 10px; font-size: 0.9rem;">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</small>
    </div>

    <div style="display:flex; gap:15px; margin-top:35px;">
    <button id="confirmCodeBtn" class="btn btn-primary" style="flex:1; padding:18px; font-size: 1.1rem;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ âœ…</button>
    <button onclick="document.getElementById('codeModal').style.display='none'" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white;">Ø¥Ù„ØºØ§Ø¡ âŒ</button>
    </div>
    </div>
    </div>

    <!-- Modal for Edit -->
    <div id="editModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <div style="background: white; margin: 3% auto; padding: 45px; width: 92%; max-width: 700px; border-radius: 35px; position: relative;">
    <span onclick="document.getElementById('editModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer;">&times;</span>
    <h3 style="color: var(--warning); font-size: 1.8rem; margin-bottom: 30px; text-align: center;">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</h3>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px;">
    <div class="input-group">
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ</label>
    <input type="text" id="editOwnerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    </div>

    <div class="input-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
    <input type="tel" id="editPhone" maxlength="11" placeholder="01XXXXXXXXX">
    </div>

    <div class="input-group">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>
    <input type="text" id="editVType" value="ØªÙˆÙƒØªÙˆÙƒ" readonly style="background: rgba(39, 174, 96, 0.1); border: 2px solid var(--secondary); font-weight: 700; color: var(--secondary); cursor: not-allowed;">
    </div>

    <div class="input-group">
    <label>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³Ù†Ø©</label>
    <select id="editVYear"></select>
    </div>

    <div class="input-group" style="grid-column: 1 / -1;">
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <textarea id="editAddress" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„"></textarea>
    </div>
    </div>

    <div style="display:flex; gap:15px; margin-top:35px;">
    <button id="confirmEditBtn" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…</button>
    <button onclick="document.getElementById('editModal').style.display='none'" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white;">Ø¥Ù„ØºØ§Ø¡ âŒ</button>
    </div>
    </div>
    </div>

    <!-- Modal for Bulk Import -->
    <div id="bulkImportModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <div style="background: white; margin: 3% auto; padding: 45px; width: 92%; max-width: 900px; border-radius: 35px; position: relative;">
    <span onclick="document.getElementById('bulkImportModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer;">&times;</span>
    <h3 style="color: #8e44ad; font-size: 1.8rem; margin-bottom: 30px;">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠ Ù…Ù† Excel</h3>

    <div style="background: linear-gradient(135deg, rgba(142, 68, 173, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%); padding: 25px; border-radius: 20px; margin: 25px 0; border: 2px solid rgba(142, 68, 173, 0.3);">
    <h4 style="color: #8e44ad; margin-top: 0;">ğŸ“‹ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</h4>
    <p style="color: #666; line-height: 1.8; margin: 15px 0;">ÙŠØ¯Ø¹Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø·Ø±ÙŠÙ‚ØªÙŠÙ† Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯:</p>

    <div style="background: white; padding: 15px; border-radius: 10px; margin: 10px 0;">
    <h5 style="color: #8e44ad; margin: 0 0 10px 0;">ğŸ§  Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§ÙƒØªØ´Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù…ÙˆØµÙ‰ Ø¨Ù‡)</h5>
    <p style="color: #555; margin: 0; line-height: 1.6;">Ø¶Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ØŒ ÙˆØ³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§ÙƒØªØ´Ø§ÙÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
    <p style="color: #666; font-size: 0.9rem; margin: 5px 0 0 0;">Ù…Ø«Ø§Ù„: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ" | "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ" | "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" | "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©"</p>
    </div>

    <div style="background: white; padding: 15px; border-radius: 10px; margin: 10px 0;">
    <h5 style="color: #8e44ad; margin: 0 0 10px 0;">ğŸ“ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø£Ø¹Ù…Ø¯Ø© Ø«Ø§Ø¨ØªØ©</h5>
    <p style="color: #555; margin: 0 0 10px 0; line-height: 1.6;">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„Ø£Ø¹Ù…Ø¯Ø©:</p>
    <ol style="color: #555; line-height: 1.8; font-weight: 600; margin: 0; padding-right: 20px;">
    <li><strong>Ø§Ù„Ø¹Ù…ÙˆØ¯ B:</strong> Ø§Ù„ÙƒÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</li>
    <li><strong>Ø§Ù„Ø¹Ù…ÙˆØ¯ C:</strong> Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ (Ø¥Ù„Ø²Ø§Ù…ÙŠ)</li>
    <li><strong>Ø§Ù„Ø¹Ù…ÙˆØ¯ D:</strong> Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù… - Ø¥Ù„Ø²Ø§Ù…ÙŠ)</li>
    <li><strong>Ø§Ù„Ø¹Ù…ÙˆØ¯ E:</strong> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</li>
    <li><strong>Ø§Ù„Ø¹Ù…ÙˆØ¯ F:</strong> Ø±Ù‚Ù… Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡</li>
    <li><strong>Ø§Ù„Ø¹Ù…ÙˆØ¯ G:</strong> Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØªÙˆØ±</li>
    <li><strong>Ø§Ù„Ø¹Ù…ÙˆØ¯ H:</strong> Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† (11 Ø±Ù‚Ù…)</li>
    </ol>
    <p style="color: #e74c3c; font-weight: 600; margin: 10px 0 0 0; font-size: 0.9rem;">
    âš ï¸ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ (Header) Ø³ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    </p>
    </div>

    <button id="downloadTemplateBtn" class="btn" style="background: linear-gradient(135deg, var(--info) 0%, #2874a6 100%); color: white; margin-top: 15px;">ğŸ“„ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ù†Ù…ÙˆØ°Ø¬ÙŠ</button>

    <button id="cleanDuplicatesBtn" class="btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; margin-top: 15px;">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©</button>
    </div>

    <div class="input-group">
    <label style="font-size: 1.1rem; color: #8e44ad;">Ø§Ø®ØªØ± Ù…Ù„Ù Excel Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯:</label>
    <input type="file" id="bulkImportFile" accept=".xlsx, .xls" style="padding: 20px; border: 3px dashed #8e44ad; background: rgba(142, 68, 173, 0.05); font-weight: 600; border-radius: 15px;">
    </div>

    <div id="importPreview" style="display:none; margin: 25px 0; max-height: 300px; overflow-y: auto; background: white; padding: 20px; border-radius: 15px; border: 2px solid #ddd;"></div>

    <!-- Progress Bar -->
    <div id="importProgress" style="display:none; margin: 25px 0;">
    <div style="background: #f0f0f0; border-radius: 10px; overflow: hidden; height: 30px; position: relative;">
    <div id="progressBar" style="background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); height: 100%; width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center;">
    <span id="progressText" style="color: white; font-weight: bold; font-size: 0.9rem; position: absolute; width: 100%; text-align: center; z-index: 1;">0%</span>
    </div>
    </div>
    <p id="progressStatus" style="text-align: center; margin-top: 10px; color: #666; font-weight: 600;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
    </div>

    <div style="display:flex; gap:15px; margin-top:35px;">
    <button id="confirmImportBtn" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white;">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
    <button onclick="document.getElementById('bulkImportModal').style.display='none'" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
    </div>
    </div>
    </div>

    <!-- Modal for Activity Log -->
    <div id="activityLogModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <div style="background: white; margin: 3% auto; padding: 45px; width: 92%; max-width: 800px; border-radius: 35px; position: relative;">
    <span onclick="document.getElementById('activityLogModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer;">&times;</span>
    <h3 style="color: #34495e; font-size: 1.8rem; margin-bottom: 30px; text-align: center;">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
    <div id="activityLogContent" style="max-height: 500px; overflow-y: auto;"></div>
    </div>
    </div>

    <!-- Modal for Login -->
    <div id="loginModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); backdrop-filter: blur(20px); overflow-y: auto;">
    <div style="background: white; margin: 5% auto; padding: 50px; width: 92%; max-width: 500px; border-radius: 35px; position: relative; box-shadow: 0 25px 80px rgba(0,0,0,0.4);">
    <span onclick="document.getElementById('loginModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer; transition: transform 0.3s;" onmouseover="this.style.transform='rotate(90deg)'" onmouseout="this.style.transform='rotate(0deg)'">&times;</span>

    <!-- Logos -->
    <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 30px;">
    <img src="https://i.postimg.cc/Hs92TtbL/41jjsn4SHDL-AC-UF894-1000-QL80.jpg" 
    style="width: 70px; height: 70px; object-fit: contain; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); background: white; padding: 8px; border: 3px solid rgba(26, 82, 118, 0.3); animation: pulse 2s infinite;" 
    alt="Ø¹Ù„Ù… Ù…ØµØ±">
    <img src="https://i.postimg.cc/brFBgHg7/Flag-of-Sharkiya-Governorate.png" 
    style="width: 70px; height: 70px; object-fit: contain; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); background: white; padding: 8px; border: 3px solid rgba(26, 82, 118, 0.3); animation: pulse 2s infinite;" 
    alt="Ø¹Ù„Ù… Ø§Ù„Ø´Ø±Ù‚ÙŠØ©">
    </div>

    <!-- Title -->
    <h3 style="color: var(--primary); font-size: 2rem; margin-bottom: 15px; text-align: center; font-weight: 900;">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
    <p style="text-align: center; color: #666; margin-bottom: 35px; font-size: 1rem;">Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±</p>

    <!-- Egyptian Flag Stripe -->
    <div style="height: 6px; background: linear-gradient(90deg, #ce1126 0%, #ce1126 33.33%, #ffffff 33.33%, #ffffff 66.66%, #000000 66.66%, #000000 100%); border-radius: 10px; margin-bottom: 35px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"></div>

    <!-- Login Form -->
    <div class="input-group">
    <label style="font-size: 1.1rem; color: var(--primary); font-weight: 700;">ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input type="email" id="loginUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="padding: 18px; border: 3px solid var(--glass-border); border-radius: 15px; font-size: 1.1rem; font-weight: 600; transition: all 0.3s;" onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 5px rgba(26, 82, 118, 0.1)'" onblur="this.style.borderColor='var(--glass-border)'; this.style.boxShadow='none'">
    </div>

    <div class="input-group">
    <label style="font-size: 1.1rem; color: var(--primary); font-weight: 700;">ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input type="password" id="loginPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="padding: 18px; border: 3px solid var(--glass-border); border-radius: 15px; font-size: 1.1rem; font-weight: 600; transition: all 0.3s;" onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 5px rgba(26, 82, 118, 0.1)'" onblur="this.style.borderColor='var(--glass-border)'; this.style.boxShadow='none'" onkeypress="if(event.key==='Enter')document.getElementById('confirmLoginBtn').click()">
    </div>

    <!-- Login Button -->
    <button id="confirmLoginBtn" class="btn" style="width: 100%; padding: 20px; font-size: 1.3rem; margin-top: 25px; background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%); color: white; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 10px 30px rgba(26, 82, 118, 0.4); position: relative; overflow: hidden; transition: all 0.3s;">
    <span style="position: relative; z-index: 1;">Ø¯Ø®ÙˆÙ„ ğŸš€</span>
    </button>

    <style>
    #confirmLoginBtn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(26, 82, 118, 0.5);
    }

    #confirmLoginBtn:active {
    transform: translateY(0);
    }

    #loginModal {
    animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
    }
    </style>
    </div>
    </div>

    <!-- Modal for Date Filter -->
    <div id="dateFilterModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <div style="background: white; margin: 10% auto; padding: 45px; width: 92%; max-width: 500px; border-radius: 35px; position: relative;">
    <span onclick="document.getElementById('dateFilterModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer;">&times;</span>
    <h3 style="color: var(--primary); font-size: 1.8rem; margin-bottom: 30px; text-align: center;">ğŸ“… ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</h3>

    <div class="input-group">
    <label>Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
    <input type="date" id="filterFromDate" style="padding: 16px; border-radius: 12px; border: 2px solid var(--glass-border); width: 100%;">
    </div>

    <div class="input-group">
    <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
    <input type="date" id="filterToDate" style="padding: 16px; border-radius: 12px; border: 2px solid var(--glass-border); width: 100%;">
    </div>

    <div style="display:flex; gap:15px; margin-top:35px;">
    <button id="applyDateFilterBtn" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%); color: white;">âœ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
    <button onclick="clearDateFilter()" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%); color: white;">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    </div>
    </div>
    </div>

    <!-- Modal for Status Change -->
    <div id="statusChangeModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <div style="background: white; margin: 5% auto; padding: 45px; width: 92%; max-width: 550px; border-radius: 35px; position: relative;">
    <span onclick="document.getElementById('statusChangeModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer;">&times;</span>
    <h3 style="color: #8e44ad; font-size: 1.8rem; margin-bottom: 30px; text-align: center;">ğŸ”„ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>

    <div class="input-group">
    <label style="font-size: 1.1rem; color: #8e44ad;">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
    <select id="newStatusSelect" style="padding: 18px; border-radius: 12px; border: 3px solid #8e44ad; width: 100%; font-size: 1.1rem; font-weight: 700; color: #8e44ad;">
    <option value="pending">â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
    <option value="approved">âœ“ ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„</option>
    <option value="coded">âœ… ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯</option>
    <option value="delivered">ğŸ‰ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
    </select>
    </div>

    <div class="input-group">
    <label style="font-size: 1.1rem; color: #8e44ad;">Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <textarea id="statusNote" rows="3" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø©..." style="padding: 16px; border-radius: 12px; border: 2px solid var(--glass-border); width: 100%; font-size: 1rem;"></textarea>
    </div>

    <!-- WhatsApp Notification Checkbox -->
    <div style="background: linear-gradient(135deg, rgba(37, 211, 102, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%); padding: 20px; border-radius: 15px; margin: 25px 0; border: 2px solid rgba(37, 211, 102, 0.3);">
    <label style="display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; font-size: 1.1rem; color: #16a34a; font-weight: 700;">
    <input type="checkbox" id="sendWhatsAppStatus" checked style="width: 24px; height: 24px; cursor: pointer; accent-color: #16a34a;">
    <span>ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…ÙˆØ§Ø·Ù†</span>
    </label>
    <small style="display: block; text-align: center; color: #666; margin-top: 10px; font-size: 0.9rem;">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©</small>
    </div>

    <div style="display:flex; gap:15px; margin-top:35px;">
    <button id="confirmStatusChangeBtn" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%); color: white;">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ±</button>
    <button onclick="document.getElementById('statusChangeModal').style.display='none'" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
    </div>
    </div>
    </div>

    <!-- Modal for Complaint Reply -->
    <div id="complaintReplyModal" style="display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto;">
    <div style="background: white; margin: 5% auto; padding: 45px; width: 92%; max-width: 600px; border-radius: 35px; position: relative;">
    <span onclick="document.getElementById('complaintReplyModal').style.display='none'" style="position: absolute; top: 20px; left: 25px; color: var(--danger); font-size: 45px; cursor: pointer;">&times;</span>
    <h3 style="color: var(--secondary); font-size: 1.8rem; margin-bottom: 30px; text-align: center;">ğŸ’¬ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰</h3>

    <div class="input-group">
    <label style="font-size: 1.1rem; color: var(--secondary);">Ù†Øµ Ø§Ù„Ø±Ø¯:</label>
    <textarea id="complaintReplyText" rows="6" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰..." style="padding: 16px; border-radius: 12px; border: 3px solid var(--secondary); width: 100%; font-size: 1.05rem; line-height: 1.8;"></textarea>
    </div>

    <!-- WhatsApp Notification Checkbox -->
    <div style="background: linear-gradient(135deg, rgba(37, 211, 102, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%); padding: 20px; border-radius: 15px; margin: 25px 0; border: 2px solid rgba(37, 211, 102, 0.3);">
    <label style="display: flex; align-items: center; justify-content: center; gap: 12px; cursor: pointer; font-size: 1.1rem; color: #16a34a; font-weight: 700;">
    <input type="checkbox" id="sendWhatsAppReply" checked style="width: 24px; height: 24px; cursor: pointer; accent-color: #16a34a;">
    <span>ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…ÙˆØ§Ø·Ù†</span>
    </label>
    <small style="display: block; text-align: center; color: #666; margin-top: 10px; font-size: 0.9rem;">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†Øµ Ø§Ù„Ø±Ø¯ ÙƒØ§Ù…Ù„Ø§Ù‹</small>
    </div>

    <div style="display:flex; gap:15px; margin-top:35px;">
    <button id="confirmComplaintReplyBtn" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white;">âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
    <button onclick="document.getElementById('complaintReplyModal').style.display='none'" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
    </div>
    </div>
    </div>

    </div>

    <!-- Egyptian Flag Stripe -->
    <div style="height: 8px; background: linear-gradient(90deg, #ce1126 0%, #ce1126 33.33%, #ffffff 33.33%, #ffffff 66.66%, #000000 66.66%, #000000 100%); box-shadow: 0 -2px 8px rgba(0,0,0,0.3);"></div>

    <!-- Footer -->
    <!-- Fixed Developer Credit - Bottom Right Corner -->
    <div style="position: fixed; bottom: 8px; right: 8px; background: rgba(0,0,0,0.4); padding: 5px 12px; border-radius: 15px; font-size: 0.65rem; color: rgba(255,255,255,0.7); z-index: 9999; backdrop-filter: blur(5px); box-shadow: 0 2px 10px rgba(0,0,0,0.2); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 300; letter-spacing: 0.5px; transition: all 0.3s ease;">
    ØªØ·ÙˆÙŠØ±: Ù…/ Ø¨Ø§Ù‡ÙŠ Ø§Ù„ØªÙ‡Ø§Ù…ÙŠ | Ù…/ Ù…Ù‡Ù†Ø¯ Ø§Ù„ØªÙ‡Ø§Ù…ÙŠ
    </div>

    <style>
    /* Hover effect for developer credit */
    div[style*="bottom: 8px; right: 8px"]:hover {
    background: rgba(0,0,0,0.7) !important;
    color: rgba(255,255,255,0.95) !important;
    transform: scale(1.05);
    }
    </style>

    <!-- JavaScript -->
    <script>
    console.log('â•'.repeat(60));
    console.log('âœ… Ù…Ù†Ø¸ÙˆÙ…Ø© ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª - ÙƒÙØ± ØµÙ‚Ø±');
    console.log('ğŸ”’ Ù†Ø¸Ø§Ù… Ø¢Ù…Ù† ÙˆÙ…Ø­Ù…ÙŠ');
    console.log('â•'.repeat(60));

    // Navigation Function
    function openService(serviceId) {
    console.log('ğŸ”„ ÙØªØ­ Ø§Ù„Ù‚Ø³Ù…:', serviceId);
    document.getElementById('portalSection').style.display = 'none';
    document.getElementById(serviceId).style.display = 'block';
    document.getElementById('goPortalBtn').style.display = 'inline-flex';

    // Auto-open registration form for Tuk Tuk (no vehicle selection needed)
    if (serviceId === 'citizenPage') {
    document.getElementById('vType').value = 'ØªÙˆÙƒØªÙˆÙƒ';
    }
    }

    // Fill Years
    function fillYears() {
    const select = document.getElementById('vYear');
    if (!select) return;
    for (let year = 2000; year <= 2030; year++) {
    let opt = document.createElement('option');
    opt.value = year;
    opt.innerText = year;
    select.appendChild(opt);
    }
    }
    fillYears();

    // Fill Birth Days (1-31)
    function fillBirthDays() {
    const select = document.getElementById('birthDay');
    if (!select) return;
    for (let day = 1; day <= 31; day++) {
    let opt = document.createElement('option');
    opt.value = day < 10 ? '0' + day : day.toString();
    opt.innerText = day;
    select.appendChild(opt);
    }
    }
    fillBirthDays();

    // Fill Birth Years (1950-2200)
    function fillBirthYears() {
    const select = document.getElementById('birthYear');
    if (!select) return;
    for (let year = 2200; year >= 1950; year--) {
    let opt = document.createElement('option');
    opt.value = year;
    opt.innerText = year;
    select.appendChild(opt);
    }
    }
    fillBirthYears();

    // Fill Years for Edit Modal
    function fillEditYears() {
    const select = document.getElementById('editVYear');
    if (!select) return;
    for (let year = 2000; year <= 2030; year++) {
    let opt = document.createElement('option');
    opt.value = year;
    opt.innerText = year;
    select.appendChild(opt);
    }
    }
    fillEditYears();

    // Validate National ID
    function validateNationalId(input) {
    const nid = input.value.replace(/[^0-9]/g, '');
    input.value = nid;
    const msgDiv = document.getElementById('nidValidation');

    if (nid.length === 0) {
    msgDiv.style.display = 'none';
    input.style.borderColor = 'var(--glass-border)';
    return false;
    }

    if (nid.length !== 14) {
    msgDiv.style.display = 'block';
    msgDiv.style.background = 'rgba(231, 76, 60, 0.1)';
    msgDiv.style.color = 'var(--danger)';
    msgDiv.innerText = 'âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù…';
    input.style.borderColor = 'var(--danger)';
    return false;
    }

    const century = nid[0];
    if (!['2', '3'].includes(century)) {
    msgDiv.style.display = 'block';
    msgDiv.style.background = 'rgba(231, 76, 60, 0.1)';
    msgDiv.style.color = 'var(--danger)';
    msgDiv.innerText = 'âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 2 Ø£Ùˆ 3)';
    input.style.borderColor = 'var(--danger)';
    return false;
    }

    const year = parseInt((century === '2' ? '19' : '20') + nid.substring(1, 3));
    const month = parseInt(nid.substring(3, 5));
    const day = parseInt(nid.substring(5, 7));

    if (month < 1 || month > 12 || day < 1 || day > 31) {
    msgDiv.style.display = 'block';
    msgDiv.style.background = 'rgba(231, 76, 60, 0.1)';
    msgDiv.style.color = 'var(--danger)';
    msgDiv.innerText = 'âŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
    input.style.borderColor = 'var(--danger)';
    return false;
    }

    // Don't show the extracted birth date - just confirm the ID is valid
    msgDiv.style.display = 'block';
    msgDiv.style.background = 'rgba(39, 174, 96, 0.1)';
    msgDiv.style.color = 'var(--secondary)';
    msgDiv.innerText = 'âœ… Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØµØ­ÙŠØ­ - Ø§Ù„Ø¢Ù† Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ù„Ù„ØªØ­Ù‚Ù‚';
    input.style.borderColor = 'var(--secondary)';

    // Don't auto-fill birth date - let user enter it manually
    // This is intentional for verification purposes

    return true;
    }

    // Verify Birth Date
    function verifyBirthDate() {
    const nid = document.getElementById('nationalId').value;
    const day = document.getElementById('birthDay').value;
    const month = document.getElementById('birthMonth').value;
    const year = document.getElementById('birthYear').value;
    const msgDiv = document.getElementById('birthValidation');

    // Update hidden field
    const birthDateHidden = document.getElementById('birthDate');
    if (day && month && year) {
    birthDateHidden.value = `${year}-${month}-${day}`;
    } else {
    birthDateHidden.value = '';
    }

    if (!nid || nid.length !== 14 || !day || !month || !year) {
    msgDiv.style.display = 'none';
    document.getElementById('birthDay').style.borderColor = 'var(--glass-border)';
    document.getElementById('birthMonth').style.borderColor = 'var(--glass-border)';
    document.getElementById('birthYear').style.borderColor = 'var(--glass-border)';
    return;
    }

    const century = nid[0];
    const nidYear = parseInt((century === '2' ? '19' : '20') + nid.substring(1, 3));
    const nidMonth = parseInt(nid.substring(3, 5));
    const nidDay = parseInt(nid.substring(5, 7));

    const selectedYear = parseInt(year);
    const selectedMonth = parseInt(month);
    const selectedDay = parseInt(day);

    if (selectedYear === nidYear && selectedMonth === nidMonth && selectedDay === nidDay) {
    msgDiv.style.display = 'block';
    msgDiv.style.background = 'rgba(39, 174, 96, 0.1)';
    msgDiv.style.color = 'var(--secondary)';
    msgDiv.innerText = 'âœ… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©';
    document.getElementById('birthDay').style.borderColor = 'var(--secondary)';
    document.getElementById('birthMonth').style.borderColor = 'var(--secondary)';
    document.getElementById('birthYear').style.borderColor = 'var(--secondary)';
    return true;
    } else {
    msgDiv.style.display = 'block';
    msgDiv.style.background = 'rgba(231, 76, 60, 0.1)';
    msgDiv.style.color = 'var(--danger)';
    msgDiv.innerText = 'âŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ - ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'; 
    document.getElementById('birthDay').style.borderColor = 'var(--danger)';
    document.getElementById('birthMonth').style.borderColor = 'var(--danger)';
    document.getElementById('birthYear').style.borderColor = 'var(--danger)';
    return false;
    }
    }

    // Make functions global
    window.validateNationalId = validateNationalId;
    window.verifyBirthDate = verifyBirthDate;
    window.getStatusDisplay = function(status) {
    const statusMap = {
    pending: { text: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', color: '#f39c12', icon: 'â³' },
    approved: { text: 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„', color: '#3498db', icon: 'âœ“' },
    coded: { text: 'ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯', color: '#27ae60', icon: 'âœ…' },
    delivered: { text: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', color: '#16a085', icon: 'ğŸ‰' }
    };
    return statusMap[status] || statusMap.pending;
    };

    // Update complaint images summary
    function updateComplaintImagesSummary() {
    const selfie = document.getElementById('compSelfie').files[0];
    const idCard = document.getElementById('compIdCard').files[0];
    const problemImages = document.getElementById('compProblemImage').files;
    const vehicleImage = document.getElementById('compVehicleImage').files[0];

    const summary = document.getElementById('compImagesSummary');
    const list = document.getElementById('compImagesList');

    let hasImages = selfie || idCard || problemImages.length > 0 || vehicleImage;

    if (hasImages) {
    summary.style.display = 'block';
    let html = '';
    if (selfie) html += `<div style="color: var(--secondary); font-weight: 600;">âœ… ØµÙˆØ±Ø© Ø³ÙŠÙ„ÙÙŠ: ${selfie.name}</div>`;
    if (idCard) html += `<div style="color: var(--secondary); font-weight: 600;">âœ… ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${idCard.name}</div>`;
    if (problemImages.length > 0) html += `<div style="color: var(--secondary); font-weight: 600;">âœ… ØµÙˆØ± Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: ${problemImages.length} ØµÙˆØ±Ø©</div>`;
    if (vehicleImage) html += `<div style="color: var(--secondary); font-weight: 600;">âœ… ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${vehicleImage.name}</div>`;
    list.innerHTML = html;
    } else {
    summary.style.display = 'none';
    }
    }; 
    document.getElementById('compSelfie').onchange = updateComplaintImagesSummary; 
    document.getElementById('compIdCard').onchange = updateComplaintImagesSummary; 
    document.getElementById('compProblemImage').onchange = updateComplaintImagesSummary; 
    document.getElementById('compVehicleImage').onchange = updateComplaintImagesSummary;

    // Test: Check all sections exist
    setTimeout(() => {
    const sections = ['portalSection', 'citizenPage', 'inquiryPage', 'complaintsPage', 'complaintInquiryPage'];
    sections.forEach(id => {
    const el = document.getElementById(id);
    console.log(el ? 'âœ… ' + id + ': Ù…ÙˆØ¬ÙˆØ¯' : 'âŒ ' + id + ': Ù…ÙÙ‚ÙˆØ¯');
    });
    }, 500);
    </script>

    <!-- Secure Configuration - EMBEDDED (Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ù…Ù„ÙØ§Øª Ø®Ø§Ø±Ø¬ÙŠØ©) -->
    <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Secure Configuration - Ù…Ø¯Ù…Ø¬ ÙÙŠ Ø§Ù„Ù…Ù„Ù
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    console.log('âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† Ø¬Ø§Ù‡Ø²');
    </script>

    <!-- System Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    // Initialize Database Client
    (function() {
        const SUPABASE_URL = 'https://xlieswavjjgqsnczesct.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsaWVzd2F2ampncXNuY3plc2N0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNDY3ODMsImV4cCI6MjA4NjkyMjc4M30.B5UvhsGQ80h86pOTFa9Yd9YOjK1DaY-8KPN1mtLBRbk';
        
        // Wait for DOM and system to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSupabase);
        } else {
            initSupabase();
        }
        
        function initSupabase() {
            // Check if system is loaded
            if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
                window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¬Ø§Ù‡Ø²');
                
                // Check for existing session on page load
                checkExistingSession();
            } else {
                // Retry after a short delay if not loaded yet
                setTimeout(initSupabase, 100);
            }
        }
        
        async function checkExistingSession() {
            const savedSession = sessionStorage.getItem('supabaseSession');
            const savedRole = sessionStorage.getItem('adminRole');
            const savedUsername = sessionStorage.getItem('adminUsername');
            
            if (savedSession && savedRole && savedUsername) {
                try {
                    // Verify session is still valid
                    const { data: { session }, error } = await window.supabaseClient.auth.getSession();
                    
                    if (session && !error) {
                        console.log('ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©...');
                        
                        // Set global variables
                        window.currentUsername = savedUsername;
                        window.currentRole = savedRole;
                        window.userRole = savedRole;
                        
                        // Hide all pages first
                        const portalSection = document.getElementById('portalSection');
                        const citizenPage = document.getElementById('citizenPage');
                        const inquiryPage = document.getElementById('inquiryPage');
                        const complaintsPage = document.getElementById('complaintsPage');
                        const complaintInquiryPage = document.getElementById('complaintInquiryPage');
                        const adminPage = document.getElementById('adminPage');
                        const loginModal = document.getElementById('loginModal');
                        const loginBtn = document.getElementById('loginBtn');
                        const logoutBtn = document.getElementById('logoutBtn');
                        const goPortalBtn = document.getElementById('goPortalBtn');
                        
                        if (portalSection) portalSection.style.display = 'none';
                        if (citizenPage) citizenPage.style.display = 'none';
                        if (inquiryPage) inquiryPage.style.display = 'none';
                        if (complaintsPage) complaintsPage.style.display = 'none';
                        if (complaintInquiryPage) complaintInquiryPage.style.display = 'none';
                        if (loginModal) loginModal.style.display = 'none';
                        
                        // Show admin panel
                        if (adminPage) adminPage.style.display = 'block';
                        if (loginBtn) loginBtn.style.display = 'none';
                        if (logoutBtn) logoutBtn.style.display = 'inline-flex';
                        if (goPortalBtn) goPortalBtn.style.display = 'inline-flex';
                        
                        // Add role badge
                        const header = document.querySelector('header');
                        const existingBadge = document.getElementById('roleBadge');
                        if (existingBadge) existingBadge.remove();
                        
                        const roleBadge = savedRole === 'SUPER' ? 'ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…' : savedRole === 'ADMIN' ? 'ğŸ”§ Ù…Ø´Ø±Ù' : 'ğŸ‘ï¸ Ø¹Ø±Ø¶ ÙÙ‚Ø·';
                        const roleColor = savedRole === 'SUPER' ? '#e74c3c' : savedRole === 'ADMIN' ? '#3498db' : '#95a5a6';
                        
                        if (header) {
                            const badge = document.createElement('div');
                            badge.id = 'roleBadge';
                            badge.style.cssText = `background: ${roleColor}; color: white; padding: 8px 20px; border-radius: 12px; font-weight: bold; font-size: 0.9rem;`;
                            badge.innerText = roleBadge;
                            header.appendChild(badge);
                        }
                        
                        // Load data
                        if (typeof loadAdminData === 'function') {
                            await loadAdminData();
                        }
                        console.log('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­');
                    } else {
                        // Session expired, clear storage
                        sessionStorage.clear();
                        console.log('âš ï¸ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©');
                    }
                } catch (err) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©:', err);
                    sessionStorage.clear();
                }
            }
        }
    })();
    </script>

    <!-- Storage Upload Function -->
    <script type="module">
    // Upload to Cloud Storage (Private)
    const uploadToSupabaseStorage = async (file) => {
    return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = async (e) => {
    const img = new Image();
    img.src = e.target.result;
    img.onload = async () => {
    const canvas = document.createElement('canvas');
    const maxWidth = 1200; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©
    const scale = img.width > maxWidth ? maxWidth / img.width : 1;
    canvas.width = img.width * scale;
    canvas.height = img.height * scale;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    canvas.toBlob(async (blob) => {
    try {
    const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}.jpg`;
    const filePath = `images/${fileName}`;

    const { data, error } = await window.supabaseClient.storage
    .from('vehicle-images')
    .upload(filePath, blob, {
    contentType: 'image/jpeg',
    cacheControl: '3600',
    upsert: false
    });

    if (error) {
    reject(new Error(`ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ${error.message}`));
    return;
    }

    // Return file path only (not public URL)
    resolve(filePath);
    } catch (error) {
    reject(new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹: ${error.message}`));
    }
    }, 'image/jpeg', 0.80); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† 0.70 Ø¥Ù„Ù‰ 0.80
    };
    };
    });
    };

    // Format DateTime
    function formatDateTime(ts) {
    if (!ts) return "-";
    const d = new Date(ts);
    return d.toLocaleDateString('ar-EG') + " " + d.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
    }

    // Make formatDateTime globally available
    window.formatDateTime = formatDateTime;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Database Helper Functions
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // Add Order to Database
    async function addOrderToSupabase(orderData) {
    const { data, error } = await window.supabaseClient
    .from('orders')
    .insert([orderData])
    .select();
    if (error) throw error;
    return data[0];
    }

    // Add Complaint to Database
    async function addComplaintToSupabase(complaintData) {
    const { data, error } = await window.supabaseClient
    .from('complaints')
    .insert([complaintData])
    .select();
    if (error) throw error;
    return data[0];
    }

    // Add Admin Log to Database
    async function logAdminActionToSupabase(username, role, action, details) {
    const { data, error } = await window.supabaseClient
    .from('admin_logs')
    .insert([{
    username,
    role,
    action,
    details,
    logged_at: Date.now(),
    ip_address: 'N/A'
    }]);
    if (error) console.error('Log error:', error);
    }

    // Submit Vehicle Registration (WITH ENCRYPTION)
    document.getElementById('submitBtn').onclick = async () => {
    const btn = document.getElementById('submitBtn');
    const files = document.getElementById('multiFiles').files;
    const owner = document.getElementById('ownerName').value.trim();
    const nid = document.getElementById('nationalId').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const year = document.getElementById('vYear').value;
    const address = document.getElementById('address').value.trim();
    const vType = document.getElementById('vType').value;
    const birthDate = document.getElementById('birthDate').value;

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ± ÙˆÙ†ÙˆØ¹Ù‡Ø§
    let totalSize = 0;
    for (let file of files) {
    if (file.size > 10485760) { // 10MB
        alert(`âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© "${file.name}" ÙŠØªØ¬Ø§ÙˆØ² 10MB\nÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ± Ø£ØµØºØ±`);
        return;
    }
    totalSize += file.size;
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
    if (!['image/jpeg', 'image/png', 'image/webp', 'image/jpg'].includes(file.type)) {
        alert(`âŒ Ø§Ù„Ù…Ù„Ù "${file.name}" ØºÙŠØ± ØµÙˆØ±Ø© ØµØ­ÙŠØ­Ø©\nÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… JPG Ø£Ùˆ PNG Ø£Ùˆ WebP ÙÙ‚Ø·`);
        return;
    }
    }

    // Validate National ID
    if (!validateNationalId(document.getElementById('nationalId'))) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ ØµØ­ÙŠØ­ (14 Ø±Ù‚Ù…)");
    return;
    }

    // Verify Birth Date
    if (!verifyBirthDate()) {
    alert("âŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ");
    return;
    }

    if (!owner || nid.length !== 14 || phone.length !== 11 || !year || !vType || files.length === 0 || !birthDate) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
    return;
    }

    // Check duplicate with birth date verification
    const checkSnap = { empty: true };
    if (!checkSnap.empty) {
    // Check if birth date matches
    const existingData = checkSnap.s[0].data();
    if (existingData.birthDate === birthDate) {
    alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©!");
    return;
    } else {
    alert("âš ï¸ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ Ù…Ø´Ø§Ø¨Ù‡ Ù„ÙƒÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù…Ø®ØªÙ„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
    return;
    }
    }; 
    document.getElementById('loadingSpinner').style.display = 'block';
    btn.disabled = true;

    try {
    const imgUrls = [];
    btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±...";
    for (let i = 0; i < files.length; i++) {
    const url = await uploadToSupabaseStorage(files[i]);
    imgUrls.push(url);
    btn.innerText = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ${i + 1} Ù…Ù† ${files.length}...`;
    }

    const refNumber = 'KS-' + Date.now().toString().slice(-8);

    // Prepare data with encryption for sensitive fields
    let dataToSave = {
    owner_name: owner,
    national_id: nid,
    phone,
    vehicle_type: vType,
    vehicle_year: year,
    address,
    images: imgUrls,
    submitted_at: Date.now(),
    ref_number: refNumber,
    status: "pending",
    code: ""
    };

    // Save to Database
    await addOrderToSupabase(dataToSave); 
    document.getElementById('loadingSpinner').style.display = 'none';
    btn.disabled = false;
    btn.innerText = 'ğŸ“‹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©';

    // Send confirmation WhatsApp to citizen
    const confirmMessage = `âœ… *ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${owner}\n` +
    `ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${vType}\n` +
    `ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: *${refNumber}*\n\n` +
    `âš ï¸ Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ\n\n` +
    `â³ Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹\n\n` +
    `ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 01021102607\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;

    // Auto-send WhatsApp
    if (phone && phone.length === 11) {
    const whatsappUrl = `https://wa.me/2${phone}?text=${encodeURIComponent(confirmMessage)}`;
    window.open(whatsappUrl, '_blank');
    }

    alert(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“‹ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${refNumber}\n\nâš ï¸ Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ\n\nğŸ“± Ø³ÙŠØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…`);
    location.reload();
    } catch (e) {
    document.getElementById('loadingSpinner').style.display = 'none';
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + e.message);
    btn.disabled = false;
    btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ…";
    }
    };

    // Inquiry Button
    document.getElementById('inquiryBtn').onclick = async () => {
    const owner = document.getElementById('inqOwnerName').value.trim();
    const nid = document.getElementById('inqNationalId').value.trim();
    const phone = document.getElementById('inqPhone').value.trim();

    if (!owner || nid.length !== 14 || phone.length !== 11) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
    return;
    }; 
    document.getElementById('loadingSpinner').style.display = 'block';

    try {
    // Search in Database
    const { data: orders, error } = await window.supabaseClient
    .from('orders')
    .select('*')
    .eq('national_id', nid)
    .eq('owner_name', owner)
    .eq('phone', phone);

    if (error) throw error;

    const rawData = orders && orders.length > 0 ? orders[0] : null;
    
    // Convert Supabase data to expected format
    const data = rawData ? {
    id: rawData.id,
    owner: rawData.owner_name,
    nationalId: rawData.national_id,
    phone: rawData.phone,
    vType: rawData.vehicle_type,
    vYear: rawData.vehicle_year,
    address: rawData.address,
    vCode: rawData.code,
    refNumber: rawData.ref_number,
    timestamp: rawData.submitted_at,
    codedAt: rawData.coded_at,
    status: rawData.status,
    statusHistory: rawData.status_history || [],
    images: rawData.images || []
    } : null;

    const resultDiv = document.getElementById('inquiryResult');

    if (!data) {
    resultDiv.style.display = 'block';
    resultDiv.style.background = 'linear-gradient(135deg, rgba(231, 76, 60, 0.1) 0%, rgba(192, 57, 43, 0.1) 100%)';
    resultDiv.style.border = '3px solid var(--danger)';
    resultDiv.innerHTML = `
    <i style="font-size: 80px; display: block; margin-bottom: 20px;">âŒ</i>
    <h3 style="color: var(--danger); margin-bottom: 15px; font-size: 1.8rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</h3>
    <p style="color: #666; font-size: 1.1rem;">ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</p>
    `;
    } else {
    const statusInfo = window.getStatusDisplay(data.status || 'pending');

    // Build status history HTML with admin info
    let historyHTML = '';
    if (data.statusHistory && data.statusHistory.length > 0) {
    historyHTML = '<div style="background: white; padding: 25px; border-radius: 20px; margin: 25px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">';
    historyHTML += '<h4 style="color: var(--primary); margin: 0 0 20px 0; font-size: 1.3rem; border-bottom: 2px solid var(--primary); padding-bottom: 10px;">ğŸ“‹ Ø³Ø¬Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h4>';
    historyHTML += '<div style="position: relative; padding-right: 30px;">';

    data.statusHistory.forEach((log, index) => {
    const logStatusInfo = window.getStatusDisplay(log.status);
    const isLast = index === data.statusHistory.length - 1;

    // Admin info
    let adminInfo = '';
    if (log.by) {
    if (log.by === 'SUPER') {
    adminInfo = '<span style="background: #e74c3c; color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; margin-right: 10px;">ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…</span>';
    } else if (log.by === 'ADMIN') {
    adminInfo = '<span style="background: #3498db; color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; margin-right: 10px;">ğŸ”§ Ù…Ø´Ø±Ù</span>';
    } else if (log.by === 'system') {
    adminInfo = '<span style="background: #95a5a6; color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; margin-right: 10px;">ğŸ¤– Ø§Ù„Ù†Ø¸Ø§Ù…</span>';
    } else {
    adminInfo = `<span style="background: #7f8c8d; color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.85rem; margin-right: 10px;">ğŸ‘¤ ${log.by}</span>`;
    }
    }

    historyHTML += `
    <div style="position: relative; margin-bottom: ${isLast ? '0' : '25px'};">
    <div style="position: absolute; right: -30px; top: 5px; width: 18px; height: 18px; background: ${logStatusInfo.color}; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 2;"></div>
    ${!isLast ? '<div style="position: absolute; right: -21px; top: 23px; width: 2px; height: calc(100% + 25px); background: #ddd; z-index: 1;"></div>' : ''}
    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(250,250,250,0.95) 100%); padding: 18px; border-radius: 12px; border-right: 4px solid ${logStatusInfo.color}; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; flex-wrap: wrap; gap: 10px;">
    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
    <span style="background: ${logStatusInfo.color}; color: white; padding: 6px 14px; border-radius: 8px; font-weight: bold; font-size: 0.95rem;">${logStatusInfo.icon} ${logStatusInfo.text}</span>
    ${adminInfo}
    </div>
    <span style="color: #999; font-size: 0.85rem; font-weight: 600;">${window.formatDateTime(log.timestamp)}</span>
    </div>
    ${log.note ? `<p style="margin: 10px 0 0 0; color: #555; line-height: 1.6; font-size: 0.95rem; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px;">ğŸ’¬ ${log.note}</p>` : ''}
    </div>
    </div>
    `;
    });

    historyHTML += '</div></div>';
    }

    if (data.vCode && data.vCode !== "") {
    resultDiv.style.display = 'block';
    resultDiv.style.background = 'linear-gradient(135deg, rgba(39, 174, 96, 0.08) 0%, rgba(46, 204, 113, 0.08) 100%)';
    resultDiv.style.border = '3px solid var(--secondary)';
    resultDiv.innerHTML = `
    <div style="text-align: center;">
    <i style="font-size: 90px; display: block; margin-bottom: 20px; animation: pulse 2s infinite;">âœ…</i>
    <h3 style="color: var(--secondary); margin-bottom: 25px; font-size: 2rem; font-weight: 900;">ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!</h3>
    </div>

    <div style="background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); padding: 35px; border-radius: 25px; margin: 25px 0; box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3); text-align: center;">
    <p style="color: rgba(255,255,255,0.9); font-size: 1.1rem; margin-bottom: 12px; font-weight: 600;">ğŸ”¢ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</p>
    <h2 style="color: white; font-size: 4.5rem; font-weight: 900; margin: 0; text-shadow: 0 4px 10px rgba(0,0,0,0.2); letter-spacing: 3px;">${data.vCode}</h2>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 25px 0;">
    <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
    <p style="color: #999; font-size: 0.9rem; margin: 0 0 8px 0;">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</p>
    <p style="color: var(--primary); font-size: 1.3rem; font-weight: bold; margin: 0;">ğŸšœ ${data.vType}</p>
    </div>
    <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
    <p style="color: #999; font-size: 0.9rem; margin: 0 0 8px 0;">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</p>
    <p style="color: var(--primary); font-size: 1.3rem; font-weight: bold; margin: 0;">ğŸ“… ${data.vYear || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
    </div>

    </div>

    <div style="background: white; padding: 20px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
    <div>
    <p style="color: #999; font-size: 0.85rem; margin: 0 0 5px 0;">ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</p>
    <p style="color: var(--primary); font-size: 1.1rem; font-weight: bold; margin: 0; font-family: monospace;">${data.refNumber || 'N/A'}</p>
    </div>
    <div>
    <p style="color: #999; font-size: 0.85rem; margin: 0 0 5px 0;">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙƒÙˆÙŠØ¯</p>
    <p style="color: var(--primary); font-size: 1.1rem; font-weight: bold; margin: 0;">${window.formatDateTime(data.codedAt)}</p>
    </div>
    </div>
    </div>

    ${historyHTML}

    <div style="background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%); padding: 20px; border-radius: 15px; margin-top: 25px; border: 2px solid rgba(52, 152, 219, 0.3); text-align: center;">
    <p style="margin: 0; color: var(--info); font-size: 1rem; line-height: 1.8;">
    <strong style="font-size: 1.1rem;">âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</strong><br>
    <span style="font-size: 0.95rem;">ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ù…Ù‚Ø± Ø±Ø¦Ø§Ø³Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</span>
    </p>
    </div>
    `;
    } else {
    resultDiv.style.display = 'block';
    resultDiv.style.background = 'linear-gradient(135deg, rgba(243, 156, 18, 0.08) 0%, rgba(214, 137, 16, 0.08) 100%)';
    resultDiv.style.border = '3px solid var(--warning)';
    resultDiv.innerHTML = `
    <div style="text-align: center;">
    <i style="font-size: 90px; display: block; margin-bottom: 20px; animation: pulse 2s infinite;">${statusInfo.icon}</i>
    <h3 style="color: var(--warning); margin-bottom: 20px; font-size: 2rem; font-weight: 900;">${statusInfo.text}</h3>
    </div>

    <div style="background: ${statusInfo.color}; color: white; padding: 25px; border-radius: 20px; margin: 25px 0; text-align: center; box-shadow: 0 8px 25px rgba(0,0,0,0.15);">
    <p style="margin: 0; font-size: 1.3rem; font-weight: bold;">${statusInfo.icon} ${statusInfo.text}</p>
    <p style="margin: 10px 0 0 0; font-size: 1rem; opacity: 0.95;">Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 25px 0;">
    <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
    <p style="color: #999; font-size: 0.9rem; margin: 0 0 8px 0;">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</p>
    <p style="color: var(--primary); font-size: 1.3rem; font-weight: bold; margin: 0;">ğŸšœ ${data.vType}</p>
    </div>
    <div style="background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
    <p style="color: #999; font-size: 0.9rem; margin: 0 0 8px 0;">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</p>
    <p style="color: var(--primary); font-size: 1.3rem; font-weight: bold; margin: 0;">ğŸ“… ${data.vYear || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
    </div>

    </div>

    <div style="background: white; padding: 20px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
    <div>
    <p style="color: #999; font-size: 0.85rem; margin: 0 0 5px 0;">ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</p>
    <p style="color: var(--primary); font-size: 1.1rem; font-weight: bold; margin: 0; font-family: monospace;">${data.refNumber || 'N/A'}</p>
    </div>
    <div>
    <p style="color: #999; font-size: 0.85rem; margin: 0 0 5px 0;">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</p>
    <p style="color: var(--primary); font-size: 1.1rem; font-weight: bold; margin: 0;">${window.formatDateTime(data.timestamp)}</p>
    </div>
    </div>
    </div>

    ${historyHTML}

    <div style="background: linear-gradient(135deg, rgba(243, 156, 18, 0.1) 0%, rgba(214, 137, 16, 0.1) 100%); padding: 20px; border-radius: 15px; margin-top: 25px; border: 2px solid rgba(243, 156, 18, 0.3); text-align: center;">
    <p style="margin: 0; color: var(--warning); font-size: 1rem; line-height: 1.8;">
    <strong style="font-size: 1.1rem;">â³ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</strong><br>
    <span style="font-size: 0.95rem;">Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹</span>
    </p>
    </div>
    `;
    }
    }
    document.getElementById('loadingSpinner').style.display = 'none';
    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message);
    }
    };

    // Submit Complaint
    document.getElementById('submitCompBtn').onclick = async () => {
    const btn = document.getElementById('submitCompBtn');
    const ownerName = document.getElementById('compOwnerName').value.trim();
    const nid = document.getElementById('compNationalId').value.trim();
    const phone = document.getElementById('compPhone').value.trim();
    const compType = document.getElementById('compType').value;
    const details = document.getElementById('compDetails').value.trim();

    // Get all image files
    const selfie = document.getElementById('compSelfie').files[0];
    const idCard = document.getElementById('compIdCard').files[0];
    const problemImages = document.getElementById('compProblemImage').files;
    const vehicleImage = document.getElementById('compVehicleImage').files[0];

    if (!ownerName || nid.length !== 14 || phone.length !== 11 || !compType || !details) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
    return;
    }

    if (!selfie || !idCard || !vehicleImage) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:\nâ€¢ ØµÙˆØ±Ø© Ø³ÙŠÙ„ÙÙŠ\nâ€¢ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©\nâ€¢ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©/Ø§Ù„ÙƒÙˆØ¯");
    return;
    }; 
    document.getElementById('loadingSpinner').style.display = 'block';
    btn.disabled = true;
    btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

    try {
    const imgUrls = {
    selfie: '',
    idCard: '',
    problemImages: [],
    vehicleImage: ''
    };

    // Upload selfie
    btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠÙ„ÙÙŠ...";
    imgUrls.selfie = await uploadToSupabaseStorage(selfie);

    // Upload ID card
    btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©...";
    imgUrls.idCard = await uploadToSupabaseStorage(idCard);

    // Upload vehicle image
    btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©...";
    imgUrls.vehicleImage = await uploadToSupabaseStorage(vehicleImage);

    // Upload problem images
    if (problemImages.length > 0) {
    for (let i = 0; i < problemImages.length; i++) {
    btn.innerText = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ${i + 1} Ù…Ù† ${problemImages.length}...`;
    const url = await uploadToSupabaseStorage(problemImages[i]);
    imgUrls.problemImages.push(url);
    }
    }

    await addComplaintToSupabase({
    owner_name: ownerName,
    national_id: nid,
    phone,
    complaint_type: compType,
    details,
    images: imgUrls,
    status: 'pending',
    reply: '',
    submitted_at: Date.now()
    }); 
    document.getElementById('loadingSpinner').style.display = 'none';

    // Send confirmation WhatsApp to citizen
    const confirmMessage = `âœ… *ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø´ÙƒÙˆØ§Ùƒ Ø¨Ù†Ø¬Ø§Ø­!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${ownerName}\n` +
    `ğŸ“‹ Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰: ${compType}\n` +
    `ğŸ“¸ ØªÙ… Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©\n\n` +
    `â³ Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´ÙƒÙˆØ§Ùƒ ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª\n\n` +
    `ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 01021102607\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;

    // Auto-send WhatsApp (no confirmation needed for citizen's own submission)
    if (phone && phone.length === 11) {
    const whatsappUrl = `https://wa.me/2${phone}?text=${encodeURIComponent(confirmMessage)}`;
    window.open(whatsappUrl, '_blank');
    }

    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø´ÙƒÙˆØ§Ùƒ Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“‹ ØªÙ… Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©\nâ³ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø±Ø¯ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª.\n\nğŸ“± Ø³ÙŠØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…");
    location.reload();
    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    alert("âŒ Ø®Ø·Ø£: " + error.message);
    btn.disabled = false;
    btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´ÙƒÙˆÙ‰ âœ‰ï¸";
    }
    };

    // Complaint Inquiry
    document.getElementById('complaintInquiryBtn').onclick = async () => {
    const owner = document.getElementById('compInqOwnerName').value.trim();
    const nid = document.getElementById('compInqNationalId').value.trim();
    const phone = document.getElementById('compInqPhone').value.trim();

    if (!owner || nid.length !== 14 || phone.length !== 11) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
    return;
    }; 
    document.getElementById('loadingSpinner').style.display = 'block';

    try {
    // Search in Database
    const { data: complaints, error } = await window.supabaseClient
    .from('complaints')
    .select('*')
    .eq('national_id', nid)
    .eq('owner_name', owner)
    .eq('phone', phone)
    .order('submitted_at', { ascending: false });

    if (error) throw error;

    const resultDiv = document.getElementById('complaintInquiryResult');

    if (!complaints || complaints.length === 0) {
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
    <div style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.1) 0%, rgba(192, 57, 43, 0.1) 100%); padding: 40px; border-radius: 25px; text-align: center; border: 3px solid var(--danger);">
    <i style="font-size: 80px; display: block; margin-bottom: 20px;">âŒ</i>
    <h3 style="color: var(--danger); margin-bottom: 15px; font-size: 1.8rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰ Ù…Ø·Ø§Ø¨Ù‚Ø©</h3>
    <p style="color: #666; font-size: 1.1rem;">ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</p>
    </div>
    `;
    } else {
    let complaintsHTML = '';
    complaints.forEach((data) => {
    const statusColor = data.status === 'replied' ? 'var(--secondary)' : 'var(--warning)';
    const statusText = data.status === 'replied' ? 'âœ… ØªÙ… Ø§Ù„Ø±Ø¯' : 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
    const statusBg = data.status === 'replied' ? 'rgba(39, 174, 96, 0.15)' : 'rgba(243, 156, 18, 0.15)';

    complaintsHTML += `
    <div style="background: linear-gradient(135deg, ${statusBg} 0%, ${statusBg} 100%); padding: 30px; border-radius: 20px; margin-bottom: 20px; border: 3px solid ${statusColor};">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h3 style="color: ${statusColor}; margin: 0; font-size: 1.5rem;">${data.complaint_type || 'Ø´ÙƒÙˆÙ‰'}</h3>
    <span style="background: ${statusColor}; color: white; padding: 8px 16px; border-radius: 10px; font-weight: bold;">${statusText}</span>
    </div>
    <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
    <p style="color: #666; margin: 0; line-height: 1.8;"><strong style="color: var(--primary);">Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong><br>${data.details || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„'}</p>
    </div>
    <p style="color: #666; font-size: 0.9rem;"><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…:</strong> ${window.formatDateTime(data.submitted_at)}</p>
    ${data.images ? `
    <div style="margin: 15px 0;">
    <button class="btn btn-view-inquiry-images" data-id="${data.id}" style="background: rgba(211, 84, 0, 0.1); color: var(--accent); padding: 10px 20px; border-radius: 12px; font-weight: bold;">ğŸ–¼ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙ‚Ø©</button>
    </div>
    ` : ''}
    ${data.status === 'replied' && data.reply ? `
    <div style="background: linear-gradient(135deg, rgba(39, 174, 96, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%); padding: 20px; border-radius: 15px; border: 2px solid var(--secondary); margin-top: 15px;">
    <p style="color: var(--secondary); margin: 0 0 10px 0; font-weight: bold; font-size: 1.1rem;">ğŸ’¬ Ø§Ù„Ø±Ø¯ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</p>
    <p style="color: #555; margin: 0; line-height: 1.8;">${data.reply}</p>
    </div>
    ` : `
    <div style="background: rgba(243, 156, 18, 0.1); padding: 15px; border-radius: 10px; text-align: center; margin-top: 15px;">
    <p style="color: var(--warning); margin: 0; font-weight: bold;">â³ Ø´ÙƒÙˆØ§Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª</p>
    </div>
    `}
    </div>
    `;
    });

    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
    <h3 style="text-align: center; color: var(--primary); margin-bottom: 30px; font-size: 1.8rem;">Ø´ÙƒØ§ÙˆÙŠÙƒ (${complaints.length})</h3>
    ${complaintsHTML}
    `;

    // Add event listeners for image viewing buttons
    const complaintsData = {};
    complaints.forEach((data) => {
    complaintsData[data.id] = data;
    });

    resultDiv.querySelectorAll('.btn-view-inquiry-images').forEach(btn => {
    btn.onclick = () => {
    const compId = btn.getAttribute('data-id');
    const data = complaintsData[compId];
    if (data && data.images) {
    if (typeof data.images === 'object' && !Array.isArray(data.images)) {
    // New format: categorized images
    showCategorizedImages(data.images);
    } else if (Array.isArray(data.images)) {
    // Old format: array of images
    viewImages(data.images);
    }
    } else {
    alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶");
    }
    };
    });
    }
    document.getElementById('loadingSpinner').style.display = 'none';
    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message);
    console.error(error);
    }
    };
    </script>

    <!-- Admin Panel JavaScript -->
    <script>
    // Admin Panel - Supabase Only
    let currentEditId = "";
    let userRole = "";
    let currentUsername = "";

    // Log Admin Action to Supabase
    async function logAdminAction(username, action, details) {
    try {
    await window.supabaseClient
    .from('admin_logs')
    .insert([{
    username: username,
    role: userRole,
    action: action,
    details: details,
    logged_at: Date.now(),
    ip_address: 'N/A'
    }]);
    } catch (error) {
    console.error("Error logging action:", error);
    }
    }

    window.logAdminAction = logAdminAction;

    // Send WhatsApp Notification Function
    async function sendWhatsAppNotification(phone, message, confirmMessage = "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…ÙˆØ§Ø·Ù†ØŸ") {
    if (!phone || phone.length !== 11) {
    return false;
    }

    const whatsappUrl = `https://wa.me/2${phone}?text=${encodeURIComponent(message)}`;

    if (confirm(confirmMessage)) {
    window.open(whatsappUrl, '_blank');
    return true;
    }
    return false;
    }

    window.sendWhatsAppNotification = sendWhatsAppNotification;

    // Get Smart Next Code from Database
    async function getSmartNextCode() {
    try {
    const { data, error } = await window.supabaseClient
    .from('orders')
    .select('code')
    .not('code', 'is', null)
    .order('code', { ascending: false })
    .limit(1);

    if (error) throw error;

    let maxCode = 100;
    if (data && data.length > 0 && data[0].code) {
    const code = parseInt(data[0].code);
    if (!isNaN(code) && code > maxCode) maxCode = code;
    }
    return { last: maxCode, next: maxCode + 1 };
    } catch (error) {
    console.error('Error getting next code:', error);
    return { last: 100, next: 101 };
    }
    }

    // Make getSmartNextCode global
    window.getSmartNextCode = getSmartNextCode;

    // Login (SECURE VERSION)
    document.getElementById('loginBtn').onclick = () => {
    document.getElementById('loginModal').style.display = 'block';
    document.getElementById('loginUsername').value = '';
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginUsername').focus();
    }; 
    document.getElementById('confirmLoginBtn').onclick = async () => {
    const email = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value.trim();

    if (!email || !password) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
    return;
    }

    // Show loading
    const btn = document.getElementById('confirmLoginBtn');
    const originalText = btn.innerText;
    btn.innerText = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
    btn.disabled = true;

    try {
    // Sign in with secure authentication
    const { data, error } = await window.supabaseClient.auth.signInWithPassword({
    email: email,
    password: password
    });

    if (error) {
    alert("âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    btn.innerText = originalText;
    btn.disabled = false;
    console.error('Supabase login error:', error);
    return;
    }

    // Successful login
    const user = data.user;

    // Determine role based on email
    const userEmail = user.email.toLowerCase();
    if (userEmail.includes('super') || userEmail === 'admin@kafrsaqr.com') {
        userRole = 'SUPER'; // Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…
    } else if (userEmail.includes('admin')) {
        userRole = 'ADMIN'; // Ù…Ø´Ø±Ù
    } else {
        userRole = 'VIEWER'; // Ø¹Ø±Ø¶ ÙÙ‚Ø·
    }

    currentUsername = user.email.split('@')[0];

    // Save session
    sessionStorage.setItem('supabaseSession', JSON.stringify(data.session));
    sessionStorage.setItem('adminRole', userRole);
    sessionStorage.setItem('adminUsername', currentUsername);

    // Hide login modal
    document.getElementById('loginModal').style.display = 'none';

    // Log admin login
    await logAdminAction(currentUsername, 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„', `Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…`);

    // Show role badge
    const roleBadge = userRole === "SUPER" ? "ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…" : userRole === "ADMIN" ? "ğŸ”§ Ù…Ø´Ø±Ù" : "ğŸ‘ï¸ Ø¹Ø±Ø¶ ÙÙ‚Ø·";
    const roleColor = userRole === "SUPER" ? "#e74c3c" : userRole === "ADMIN" ? "#3498db" : "#95a5a6";

    document.getElementById('portalSection').style.display = 'none';
    document.getElementById('citizenPage').style.display = 'none';
    document.getElementById('inquiryPage').style.display = 'none';
    document.getElementById('complaintsPage').style.display = 'none';
    document.getElementById('complaintInquiryPage').style.display = 'none';
    document.getElementById('adminPage').style.display = 'block';
    document.getElementById('goPortalBtn').style.display = 'inline-flex';
    document.getElementById('logoutBtn').style.display = 'inline-flex';
    document.getElementById('loginBtn').style.display = 'none';

    // Show toggle columns button on mobile only
    const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
    if (isMobileDevice) {
    document.getElementById('toggleColumnsBtn').style.display = 'inline-block';
    }

    // Add role badge to header
    const header = document.querySelector('header');
    const existingBadge = document.getElementById('roleBadge');
    if (existingBadge) existingBadge.remove();
    const badge = document.createElement('div');
    badge.id = 'roleBadge';
    badge.style.cssText = `background: ${roleColor}; color: white; padding: 8px 20px; border-radius: 12px; font-weight: bold; font-size: 0.9rem;`;
    badge.innerText = roleBadge;
    header.appendChild(badge);

    loadAdminData();
    loadComplaints();

    // Hide buttons based on role
    const bulkImportBtn = document.getElementById('bulkImportBtn');
    if (userRole === 'VIEWER' && bulkImportBtn) {
    bulkImportBtn.style.display = 'none';
    }

    // Hide cleanup button for non-SUPER users
    const cleanupBtn = document.getElementById('cleanupDuplicatesBtn');
    const cleanupMainBtn = document.getElementById('cleanDuplicatesMainBtn');
    if (userRole !== 'SUPER') {
    if (cleanupBtn) cleanupBtn.style.display = 'none';
    if (cleanupMainBtn) cleanupMainBtn.style.display = 'none';
    }
    } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    btn.innerText = originalText;
    btn.disabled = false;
    btn.innerText = originalText;
    btn.disabled = false;
    }
    };

    // Get Signed URL for Private Images
    async function getSignedUrl(filePath) {
    if (!filePath) return '';

    // If it's already a full URL, return it
    if (filePath.startsWith('http')) return filePath;

    try {
    const { data, error } = await window.supabaseClient.storage
    .from('vehicle-images')
    .createSignedUrl(filePath, 3600); // Valid for 1 hour

    if (error) {
    console.error('Error getting signed URL:', error);
    return filePath;
    }

    return data.signedUrl;
    } catch (err) {
    console.error('Error:', err);
    return filePath;
    }
    }

    // View Images
    async function viewImages(images) {
    const modal = document.getElementById("imgModal");
    const mainImg = document.getElementById("mainViewImg");
    const thumbContainer = document.getElementById("modalThumbnails");

    thumbContainer.innerHTML = '';

    // Get signed URLs for all images
    const signedUrls = await Promise.all(images.map(img => getSignedUrl(img)));
    mainImg.src = signedUrls[0];

    signedUrls.forEach(src => {
    const img = document.createElement('img');
    img.src = src;
    img.style.width = "80px";
    img.style.height = "80px";
    img.style.cursor = "pointer";
    img.style.objectFit = "cover";
    img.style.borderRadius = "15px";
    img.style.border = "3px solid white";
    img.onclick = () => mainImg.src = src;
    thumbContainer.appendChild(img);
    });

    modal.style.display = "block";
    }

    // View Categorized Images (for complaints)
    async function showCategorizedImages(images) {
    const modal = document.getElementById("imgModal");
    const mainImg = document.getElementById("mainViewImg");
    const thumbContainer = document.getElementById("modalThumbnails");

    thumbContainer.innerHTML = '';

    // Collect all images with labels
    const allImages = [];

    if (images.selfie) {
    const url = await getSignedUrl(images.selfie);
    allImages.push({ url, label: 'ğŸ“¸ ØµÙˆØ±Ø© Ø³ÙŠÙ„ÙÙŠ' });
    }
    if (images.idCard) {
    const url = await getSignedUrl(images.idCard);
    allImages.push({ url, label: 'ğŸªª ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' });
    }
    if (images.vehicleImage) {
    const url = await getSignedUrl(images.vehicleImage);
    allImages.push({ url, label: 'ğŸšœ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©/Ø§Ù„ÙƒÙˆØ¯' });
    }
    if (images.problemImages && images.problemImages.length > 0) {
    images.problemImages.forEach((url, index) => {
    allImages.push({ url: url, label: `ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ${index + 1}` });
    });
    }

    if (allImages.length === 0) {
    alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶");
    return;
    }

    // Set first image
    mainImg.src = allImages[0].url;

    // Create thumbnails with labels
    allImages.forEach(imgData => {
    const container = document.createElement('div');
    container.style.textAlign = 'center';

    const img = document.createElement('img');
    img.src = imgData.url;
    img.style.width = "80px";
    img.style.height = "80px";
    img.style.cursor = "pointer";
    img.style.objectFit = "cover";
    img.style.borderRadius = "15px";
    img.style.border = "3px solid white";
    img.onclick = () => mainImg.src = imgData.url;

    const label = document.createElement('div');
    label.innerText = imgData.label;
    label.style.color = 'white';
    label.style.fontSize = '0.75rem';
    label.style.marginTop = '5px';
    label.style.fontWeight = 'bold';

    container.appendChild(img);
    container.appendChild(label);
    thumbContainer.appendChild(container);
    });

    modal.style.display = "block";
    }

    // Logout function
    window.logoutAdmin = async function() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…ØŸ')) {
    // Sign out from system
    await window.supabaseClient.auth.signOut();
    
    sessionStorage.removeItem('supabaseSession');
    sessionStorage.removeItem('adminRole');
    sessionStorage.removeItem('adminUsername');
    document.getElementById('adminPage').style.display = 'none';
    document.getElementById('portalSection').style.display = 'block';
    document.getElementById('goPortalBtn').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'none';
    document.getElementById('loginBtn').style.display = 'inline-flex';
    const badge = document.getElementById('roleBadge');
    if (badge) badge.remove();
    
    console.log('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    location.reload();
    }
    };

    // Go to Portal function (without logout)
    window.goToPortal = function() {
    document.getElementById('adminPage').style.display = 'none';
    document.getElementById('citizenPage').style.display = 'none';
    document.getElementById('inquiryPage').style.display = 'none';
    document.getElementById('complaintsPage').style.display = 'none';
    document.getElementById('complaintInquiryPage').style.display = 'none';
    document.getElementById('portalSection').style.display = 'block';
    document.getElementById('goPortalBtn').style.display = 'none';
    console.log('ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨ÙˆØ§Ø¨Ø© (Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„)');
    };

    async function loadAdminData() {
    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

    const tbody = document.getElementById('dataTable');
    tbody.innerHTML = '<tr><td colspan="12" style="text-align:center; padding:20px; font-size:1rem; color:#666;">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>';

    try {
    // Load ALL data from Database (handle pagination for large datasets)
    let allOrders = [];
    let from = 0;
    const batchSize = 1000;
    let hasMore = true;

    while (hasMore) {
    const { data: batch, error } = await window.supabaseClient
    .from('orders')
    .select('*')
    .order('submitted_at', { ascending: false })
    .range(from, from + batchSize - 1);

    if (error) throw error;

    if (batch && batch.length > 0) {
    allOrders = allOrders.concat(batch);
    from += batchSize;
    hasMore = batch.length === batchSize;
    } else {
    hasMore = false;
    }
    }

    const orders = allOrders;
    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${orders ? orders.length : 0} Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    let total = 0, coded = 0, pending = 0;

    if (orders && orders.length > 0) {
    orders.forEach(item => {
    total++;
    if (item.status === 'coded' || item.status === 'delivered') {
    coded++;
    } else if (item.status === 'pending' || item.status === 'approved' || !item.status) {
    pending++;
    }
    });
    }

    // Convert Supabase data to match expected format
    const supabaseOrders = (orders || []).map(item => ({
    id: item.id,
    owner: item.owner_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    nationalId: item.national_id || '',
    phone: item.phone || '',
    vType: item.vehicle_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    vYear: item.vehicle_year || '',
    chassisNumber: item.chassis_number || '',
    motorNumber: item.motor_number || '',
    address: item.address || '',
    vCode: item.code || '',
    refNumber: item.ref_number || '',
    timestamp: item.submitted_at || Date.now(),
    status: item.status || 'pending',
    images: item.images || [],
    source: 'supabase'
    }));

    const combinedOrders = [...supabaseOrders];

    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${supabaseOrders.length} Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    // Sort by vCode (numeric) - codes first, then non-coded at end
    combinedOrders.sort((a, b) => {
    const codeA = a.vCode ? parseInt(a.vCode) : 999999;
    const codeB = b.vCode ? parseInt(b.vCode) : 999999;
    return codeA - codeB;
    });

    // Clear table before progressive rendering
    const tbodyElement = document.getElementById('dataTable');
    if (tbodyElement) {
    tbodyElement.innerHTML = '';
    }

    // Build table rows and render progressively
    const ordersArray = [];
    tbody.innerHTML = ''; // Clear existing rows

    // Detect mobile device
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;

    // On mobile: render progressively (show first 10 immediately, then load more)
    if (isMobile) {
    console.log('ğŸ“± ÙˆØ¶Ø¹ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: Ø¹Ø±Ø¶ ØªØ¯Ø±ÙŠØ¬ÙŠ Ø³Ø±ÙŠØ¹');

    // Show first 10 rows IMMEDIATELY
    const quickShowCount = Math.min(10, combinedOrders.length);
    const quickFragment = document.createDocumentFragment();

    for (let i = 0; i < quickShowCount; i++) {
    const item = combinedOrders[i];
    const tr = document.createElement('tr');
    tr.innerHTML = `
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:600; font-size:0.7rem;">${item.owner}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-weight:500; font-size:0.65rem;">${item.nationalId}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; font-size:0.65rem;">${item.phone || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);"><span style="background:linear-gradient(135deg, var(--info) 0%, var(--primary) 100%); color:white; padding:2px 4px; border-radius:4px; font-weight:600; font-size:0.65rem;">${item.vType}</span></td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; color:#555; font-size:0.65rem;">${item.vYear || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.chassisNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.chassisNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.motorNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.motorNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); max-width: 90px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color:#555; font-size:0.65rem;" title="${item.address || '-'}">${item.address || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-size:0.6rem; color:#666;">${window.formatDateTime(item.timestamp)}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:bold; font-size:0.85rem; color:${item.vCode ? 'var(--secondary)' : 'var(--danger)'}">${item.vCode || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);">ğŸ–¼ï¸ (${item.images ? item.images.length : 0})</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-size:0.6rem; color:#999;">Ø¹Ø±Ø¶ ÙÙ‚Ø·</td>
    `;
    quickFragment.appendChild(tr);
    ordersArray.push({ element: tr, item: item, id: item.id });
    }

    tbody.appendChild(quickFragment);
    console.log(`âš¡ ØªÙ… Ø¹Ø±Ø¶ Ø£ÙˆÙ„ ${quickShowCount} ØµÙ ÙÙˆØ±Ø§Ù‹`);

    // Now load the rest progressively (10 at a time)
    let currentIndex = quickShowCount;
    const batchSize = 10;
    const maxRows = Math.min(combinedOrders.length, 200); // Limit to 200 on mobile

    function loadNextBatch() {
    if (currentIndex >= maxRows) {
    console.log(`âœ… ØªÙ… Ø¹Ø±Ø¶ ${currentIndex} Ø³Ø¬Ù„`);
    initializePagination(ordersArray);
    return;
    }

    const endIndex = Math.min(currentIndex + batchSize, maxRows);
    const fragment = document.createDocumentFragment();

    for (let i = currentIndex; i < endIndex; i++) {
    const item = combinedOrders[i];
    const tr = document.createElement('tr');
    tr.innerHTML = `
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:600; font-size:0.7rem;">${item.owner}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-weight:500; font-size:0.65rem;">${item.nationalId}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; font-size:0.65rem;">${item.phone || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);"><span style="background:linear-gradient(135deg, var(--info) 0%, var(--primary) 100%); color:white; padding:2px 4px; border-radius:4px; font-weight:600; font-size:0.65rem;">${item.vType}</span></td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; color:#555; font-size:0.65rem;">${item.vYear || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.chassisNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.chassisNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.motorNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.motorNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); max-width: 90px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color:#555; font-size:0.65rem;" title="${item.address || '-'}">${item.address || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-size:0.6rem; color:#666;">${window.formatDateTime(item.timestamp)}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:bold; font-size:0.85rem; color:${item.vCode ? 'var(--secondary)' : 'var(--danger)'}">${item.vCode || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);">ğŸ–¼ï¸ (${item.images ? item.images.length : 0})</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-size:0.6rem; color:#999;">Ø¹Ø±Ø¶ ÙÙ‚Ø·</td>
    `;
    fragment.appendChild(tr);
    ordersArray.push({ element: tr, item: item, id: item.id });
    }

    tbody.appendChild(fragment);
    currentIndex = endIndex;

    if (currentIndex % 50 === 0) {
    console.log(`ğŸ“Š ØªÙ… Ø¹Ø±Ø¶ ${currentIndex} Ù…Ù† ${maxRows} Ø³Ø¬Ù„`);
    }

    // Continue loading
    setTimeout(loadNextBatch, 100); // Load next batch after 100ms
    }

    // Start loading more after showing first 10
    setTimeout(loadNextBatch, 100);

    } else {
    // Desktop: Progressive rendering
    console.log('ğŸ’» ÙˆØ¶Ø¹ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: Ø¹Ø±Ø¶ ØªØ¯Ø±ÙŠØ¬ÙŠ');

    // Function to render rows in batches
    let renderIndex = 0;
    const batchSize = 10;
    const renderDelay = 200;
    const maxInitialRows = combinedOrders.length;
    const maxIndex = Math.min(maxInitialRows, combinedOrders.length);

    function renderNextBatch() {
    try {
    // On mobile, stop at 100 rows initially
    const endIndex = Math.min(renderIndex + batchSize, maxIndex);
    const fragment = document.createDocumentFragment();

    for (let i = renderIndex; i < endIndex; i++) {
    const item = combinedOrders[i];
    const id = item.id;

    const tr = document.createElement('tr');
    tr.innerHTML = `
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:600; font-size:0.7rem;">${item.owner}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-weight:500; font-size:0.65rem;">${item.nationalId}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; font-size:0.65rem;">${item.phone || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);"><span style="background:linear-gradient(135deg, var(--info) 0%, var(--primary) 100%); color:white; padding:2px 4px; border-radius:4px; font-weight:600; font-size:0.65rem;">${item.vType}</span></td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; color:#555; font-size:0.65rem;">${item.vYear || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.chassisNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.chassisNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.motorNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.motorNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); max-width: 90px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color:#555; font-size:0.65rem;" title="${item.address || '-'}">${item.address || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-size:0.6rem; color:#666;">${window.formatDateTime(item.timestamp)}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:bold; font-size:0.85rem; color:${item.vCode ? 'var(--secondary)' : 'var(--danger)'}">${item.vCode || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);"><button class="btn view-btn" style="background:rgba(26, 82, 118, 0.12); color:var(--primary); padding:3px 6px; font-weight:600; font-size:0.6rem;">ğŸ–¼ï¸ (${item.images ? item.images.length : 0})</button></td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); display:flex; gap:2px; flex-wrap:wrap;">
    <button class="btn btn-status" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©" style="padding:3px 5px; background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%); color: white; display: ${userRole === 'VIEWER' ? 'none' : 'inline-flex'}; font-size:0.65rem;">ğŸ”„</button>
    <button class="btn btn-code" title="ØªÙƒÙˆÙŠØ¯" style="padding:3px 5px; background: linear-gradient(135deg, var(--info) 0%, #2874a6 100%); color: white; display: ${userRole === 'VIEWER' ? 'none' : 'inline-flex'}; font-size:0.65rem;">ğŸ”¢</button>
    <button class="btn btn-edit" title="ØªØ¹Ø¯ÙŠÙ„" style="padding:3px 5px; background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%); color: white; display: ${userRole === 'VIEWER' ? 'none' : 'inline-flex'}; font-size:0.65rem;">âœï¸</button>
    <button class="btn btn-del" title="Ø­Ø°Ù" style="padding:3px 5px; background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white; display: ${userRole === 'SUPER' ? 'inline-flex' : 'none'}; font-size:0.65rem;">ğŸ—‘ï¸</button>
    <button class="btn btn-log" title="Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" style="padding:3px 5px; background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; font-size:0.65rem;">ğŸ“‹</button>
    </td>
    `;

    tr.querySelector('.btn-status').onclick = async () => {
    document.getElementById('statusChangeModal').style.display = 'block';
    document.getElementById('newStatusSelect').value = item.status || 'pending';
    document.getElementById('statusNote').value = '';
    document.getElementById('sendWhatsAppStatus').checked = true;
    window.currentStatusChangeItem = { item, id };
    };

    tr.querySelector('.btn-code').onclick = async () => {
    if (item.vCode) {
    alert("âš ï¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù…ÙƒÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ø±Ù‚Ù…: " + item.vCode);
    return;
    }
    const info = await getSmartNextCode();
    document.getElementById('codeHint').innerText = `Ø¢Ø®Ø± ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…: (${info.last}) | Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­: (${info.next})`;
    document.getElementById('manualCodeInput').value = info.next;
    document.getElementById('codeModal').style.display = 'block';
    document.getElementById('confirmCodeBtn').onclick = async () => {
    const newCode = document.getElementById('manualCodeInput').value;
    if (!newCode) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ ØµØ­ÙŠØ­");
    return;
    }

    // Check if code already exists
    document.getElementById('loadingSpinner').style.display = 'block';

    try {
    const { data: existingCode, error: checkError } = await window.supabaseClient
    .from('orders')
    .select('id, owner_name, code')
    .eq('code', newCode.toString())
    .single();

    if (existingCode) {
    document.getElementById('loadingSpinner').style.display = 'none';
    alert(`âŒ Ø§Ù„ÙƒÙˆØ¯ ${newCode} Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!\n\nğŸ‘¤ Ø§Ù„Ù…Ø§Ù„Ùƒ: ${existingCode.owner_name}\n\nâš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø¢Ø®Ø±`);
    return;
    }

    const { error } = await window.supabaseClient
    .from('orders')
    .update({
    code: newCode.toString(),
    coded_at: Date.now(),
    status: "coded",
    status_history: [...(item.statusHistory || []), {
    status: "coded",
    timestamp: Date.now(),
    note: `ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø¨Ø±Ù‚Ù…: ${newCode}`,
    by: userRole
    }]
    })
    .eq('id', id);

    if (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:', error);
    throw error;
    }

    await logAdminAction(currentUsername, 'ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨Ø©', `ØªÙ… ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨Ø© ${item.vType} Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} Ø¨Ø§Ù„ÙƒÙˆØ¯: ${newCode}`);
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('codeModal').style.display = 'none';

    const sendWhatsApp = document.getElementById('sendWhatsAppCode').checked;
    if (sendWhatsApp) {
    const message = `ğŸ‰ *ØªÙ… ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${item.owner}\n` +
    `ğŸ”¢ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: *${newCode}*\n` +
    `ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${item.vType}\n` +
    `ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber}\n\n` +
    `âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù…Ù† Ø§Ù„Ù…Ù‚Ø±\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;
    if (item.phone && item.phone.length === 11) {
    const whatsappUrl = `https://wa.me/2${item.phone}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
    }
    }

    alert("âœ… ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!" + (sendWhatsApp && item.phone && item.phone.length === 11 ? "\nğŸ“± ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±" : ""));

    // Reload data to show updated record
    await loadAdminData();

    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙƒÙˆÙŠØ¯:', error);
    alert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙƒÙˆÙŠØ¯:\n\n${error.message || error.toString()}\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`);
    }
    };
    };

    tr.querySelector('.btn-edit').onclick = async () => {
    document.getElementById('editOwnerName').value = item.owner;
    document.getElementById('editPhone').value = item.phone || '';
    document.getElementById('editVType').value = item.vType;
    document.getElementById('editVYear').value = item.vYear || '';
    document.getElementById('editAddress').value = item.address || '';
    document.getElementById('editModal').style.display = 'block';
    document.getElementById('confirmEditBtn').onclick = async () => {
    const newOwner = document.getElementById('editOwnerName').value.trim();
    const newPhone = document.getElementById('editPhone').value.trim();
    const newVType = document.getElementById('editVType').value;
    const newVYear = document.getElementById('editVYear').value;
    const newAddress = document.getElementById('editAddress').value.trim();
    if (!newOwner || !newPhone || newPhone.length !== 11) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
    return;
    }
    document.getElementById('loadingSpinner').style.display = 'block';
    const { error: editError2 } = await window.supabaseClient
    .from('orders')
    .update({
    owner_name: newOwner,
    phone: newPhone,
    vehicle_type: newVType,
    vehicle_year: newVYear,
    address: newAddress,
    status_history: [...(item.statusHistory || []), {
    status: item.status || 'pending',
    timestamp: Date.now(),
    note: "ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
    by: userRole
    }]
    })
    .eq('id', id);
    if (editError2) throw editError2;
    await logAdminAction(currentUsername, 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª', `ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ÙƒØ¨Ø© ${item.vType} Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber})`);
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('editModal').style.display = 'none';
    alert("âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
    };
    };

    tr.querySelector('.btn-del').onclick = async () => {
    if (confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
    try {
    // Delete from Database
    const { error } = await window.supabaseClient
    .from("orders")
    .delete()
    .eq("id", id);
    if (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:', error);
    alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + error.message);
    return;
    }
    await logAdminAction(currentUsername, 'Ø­Ø°Ù Ø·Ù„Ø¨', `ØªÙ… Ø­Ø°Ù Ø·Ù„Ø¨ Ù…Ø±ÙƒØ¨Ø© ${item.vType} Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber})`);
    alert("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");
    await loadAdminData();
    } catch (err) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù:', err);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù");
    }
    }
    };

    tr.querySelector('.btn-log').onclick = () => {
    showActivityLog(item);
    };

    tr.querySelector('.view-btn').onclick = () => {
    if (item.images && item.images.length > 0) {
    viewImages(item.images);
    } else {
    alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶");
    }
    };

    fragment.appendChild(tr);
    ordersArray.push({ element: tr, item: item, id: id });
    }

    // Add batch to DOM
    tbody.appendChild(fragment);
    renderIndex = endIndex;

    // Progress update
    if (renderIndex % 100 === 0 || renderIndex === maxIndex) {
    console.log(`ğŸ“Š ØªÙ… Ø¹Ø±Ø¶ ${renderIndex} Ù…Ù† ${maxIndex} Ø³Ø¬Ù„`);
    }

    // Continue rendering
    if (renderIndex < maxIndex) {
    setTimeout(renderNextBatch, renderDelay);
    } else {
    console.log('âœ… ØªÙ… Ø¹Ø±Ø¶ ' + renderIndex + ' Ø³Ø¬Ù„');
    initializePagination(ordersArray);
    }
    } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:', error);
    if (renderIndex < maxIndex) {
    setTimeout(renderNextBatch, 500);
    }
    }
    }

    // Start progressive rendering
    console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ: ' + combinedOrders.length + ' Ø³Ø¬Ù„');
    renderNextBatch();
    }; 
    document.getElementById('statTotal').innerText = total; 
    document.getElementById('statCoded').innerText = coded; 
    document.getElementById('statPending').innerText = pending;

    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + combinedOrders.length + ' Ø³Ø¬Ù„ Ø¨Ø¹Ø¯ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±');
    console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù€ ' + combinedOrders.length + ' Ø³Ø¬Ù„');

    // Show "Load All Data" button if there might be more data
    if (supabaseOrders.length >= 50) {document.getElementById('loadAllDataBtn').style.display = 'inline-block';
    }
    } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error); 
    document.getElementById('dataTable').innerHTML = '<tr><td colspan="12" style="text-align:center; padding:20px; color:var(--danger);">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
    }
    }

    // Load All Data function
    window.loadAllData = async function() {
    if (window.isLoadingAll) {
    console.log('â³ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°...');
    return;
    }
    window.isLoadingAll = true; 
    document.getElementById('loadAllDataBtn').style.display = 'none'; 
    document.getElementById('loadingMoreInfo').style.display = 'inline-block';

    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

    try {
    // Load ALL data from Supabase without limit (handle pagination)
    let allSupabaseOrders = [];
    let from = 0;
    const batchSize = 1000;
    let hasMore = true;

    while (hasMore) {
    const { data: batch, error } = await window.supabaseClient
    .from('orders')
    .select('*')
    .order('submitted_at', { ascending: false })
    .range(from, from + batchSize - 1);

    if (error) throw error;

    if (batch && batch.length > 0) {
    allSupabaseOrders = allSupabaseOrders.concat(batch);
    from += batchSize;
    hasMore = batch.length === batchSize;
    console.log(`ğŸ“¥ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allSupabaseOrders.length} Ø³Ø¬Ù„...`);
    } else {
    hasMore = false;
    }
    }

    const supabaseOrders = allSupabaseOrders;
    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${supabaseOrders.length} Ø³Ø¬Ù„`);

    // Convert Supabase data to match expected format
    const allOrders = supabaseOrders.map(item => ({
    id: item.id,
    owner: item.owner_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    nationalId: item.national_id || '',
    phone: item.phone || '',
    vType: item.vehicle_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
    vYear: item.vehicle_year || '',
    chassisNumber: item.chassis_number || '',
    motorNumber: item.motor_number || '',
    address: item.address || '',
    vCode: item.code || '',
    refNumber: item.ref_number || '',
    timestamp: item.submitted_at || Date.now(),
    status: item.status || 'pending',
    statusHistory: item.status_history || [],
    images: item.images || [],
    source: 'supabase'
    }));

    let total = 0, coded = 0, pending = 0;

    allOrders.forEach(item => {
    total++;
    if (item.status === 'coded' || item.status === 'delivered') {
    coded++;
    } else if (item.status === 'pending' || item.status === 'approved' || !item.status) {
    pending++;
    }
    });

    allOrders.sort((a, b) => {
    const codeA = a.vCode ? parseInt(a.vCode) : 999999;
    const codeB = b.vCode ? parseInt(b.vCode) : 999999;
    return codeA - codeB;
    });

    // Rebuild table with all data
    const ordersArray = [];
    allOrders.forEach(item => {
    const id = item.id;
    const tr = document.createElement('tr');
    tr.innerHTML = `
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:600; font-size:0.7rem;">${item.owner}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-weight:500; font-size:0.65rem;">${item.nationalId}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; font-size:0.65rem;">${item.phone || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);"><span style="background:linear-gradient(135deg, var(--info) 0%, var(--primary) 100%); color:white; padding:2px 4px; border-radius:4px; font-weight:600; font-size:0.65rem;">${item.vType}</span></td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:500; color:#555; font-size:0.65rem;">${item.vYear || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.chassisNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.chassisNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-family:monospace; font-size:0.6rem; color:${item.motorNumber ? '#27ae60' : '#999'}; font-weight:500;">${item.motorNumber || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); max-width: 90px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color:#555; font-size:0.65rem;" title="${item.address || '-'}">${item.address || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-size:0.6rem; color:#666;">${window.formatDateTime(item.timestamp)}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); font-weight:bold; font-size:0.85rem; color:${item.vCode ? 'var(--secondary)' : 'var(--danger)'}">${item.vCode || '-'}</td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85);"><button class="btn view-btn" style="background:rgba(26, 82, 118, 0.12); color:var(--primary); padding:3px 6px; font-weight:600; font-size:0.6rem;">ğŸ–¼ï¸ (${item.images ? item.images.length : 0})</button></td>
    <td style="padding: 3px 2px; background: rgba(255, 255, 255, 0.85); display:flex; gap:2px; flex-wrap:wrap;">
    <button class="btn btn-status" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©" style="padding:3px 5px; background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%); color: white; display: ${userRole === 'VIEWER' ? 'none' : 'inline-flex'}; font-size:0.65rem;">ğŸ”„</button>
    <button class="btn btn-code" title="ØªÙƒÙˆÙŠØ¯" style="padding:3px 5px; background: linear-gradient(135deg, var(--info) 0%, #2874a6 100%); color: white; display: ${userRole === 'VIEWER' ? 'none' : 'inline-flex'}; font-size:0.65rem;">ğŸ”¢</button>
    <button class="btn btn-edit" title="ØªØ¹Ø¯ÙŠÙ„" style="padding:3px 5px; background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%); color: white; display: ${userRole === 'VIEWER' ? 'none' : 'inline-flex'}; font-size:0.65rem;">âœï¸</button>
    <button class="btn btn-del" title="Ø­Ø°Ù" style="padding:3px 5px; background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white; display: ${userRole === 'SUPER' ? 'inline-flex' : 'none'}; font-size:0.65rem;">ğŸ—‘ï¸</button>
    <button class="btn btn-log" title="Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" style="padding:3px 5px; background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; font-size:0.65rem;">ğŸ“‹</button>
    </td>
    `;

    // Attach button handlers
    tr.querySelector('.btn-status').onclick = async () => {
    document.getElementById('statusChangeModal').style.display = 'block';
    document.getElementById('newStatusSelect').value = item.status || 'pending';
    document.getElementById('statusNote').value = '';
    document.getElementById('sendWhatsAppStatus').checked = true;
    window.currentStatusChangeItem = { item, id };
    };

    tr.querySelector('.btn-code').onclick = async () => {
    if (item.vCode) {
    alert("âš ï¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù…ÙƒÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ø±Ù‚Ù…: " + item.vCode);
    return;
    }
    const info = await getSmartNextCode();
    document.getElementById('codeHint').innerText = `Ø¢Ø®Ø± ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…: (${info.last}) | Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­: (${info.next})`;
    document.getElementById('manualCodeInput').value = info.next;
    document.getElementById('codeModal').style.display = 'block';
    document.getElementById('confirmCodeBtn').onclick = async () => {
    const newCode = document.getElementById('manualCodeInput').value;
    if (!newCode) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ ØµØ­ÙŠØ­");
    return;
    }

    // Check if code already exists
    document.getElementById('loadingSpinner').style.display = 'block';
    const { data: existingCode, error: checkError } = await window.supabaseClient
    .from('orders')
    .select('id, owner_name, code')
    .eq('code', newCode.toString())
    .single();

    if (existingCode) {
    document.getElementById('loadingSpinner').style.display = 'none';
    alert(`âŒ Ø§Ù„ÙƒÙˆØ¯ ${newCode} Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!\n\nğŸ‘¤ Ø§Ù„Ù…Ø§Ù„Ùƒ: ${existingCode.owner_name}\n\nâš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø¢Ø®Ø±`);
    return;
    }

    const { error: codeError2 } = await window.supabaseClient
    .from('orders')
    .update({
    code: newCode.toString(),
    coded_at: Date.now(),
    status: "coded",
    status_history: [...(item.statusHistory || []), {
    status: "coded",
    timestamp: Date.now(),
    note: `ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø¨Ø±Ù‚Ù…: ${newCode}`,
    by: userRole
    }]
    })
    .eq('id', id);
    if (codeError2) throw codeError2;
    await logAdminAction(currentUsername, 'ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨Ø©', `ØªÙ… ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨Ø© ${item.vType} Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} Ø¨Ø§Ù„ÙƒÙˆØ¯: ${newCode}`);
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('codeModal').style.display = 'none';
    const sendWhatsApp = document.getElementById('sendWhatsAppCode').checked;
    if (sendWhatsApp) {
    const message = `ğŸ‰ *ØªÙ… ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${item.owner}\n` +
    `ğŸ”¢ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: *${newCode}*\n` +
    `ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${item.vType}\n` +
    `ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber}\n\n` +
    `âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù…Ù† Ø§Ù„Ù…Ù‚Ø±\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;
    if (item.phone && item.phone.length === 11) {
    const whatsappUrl = `https://wa.me/2${item.phone}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
    }
    }
    alert("âœ… ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!" + (sendWhatsApp && item.phone && item.phone.length === 11 ? "\nğŸ“± ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±" : ""));
    };
    };

    tr.querySelector('.btn-edit').onclick = async () => {
    document.getElementById('editOwnerName').value = item.owner;
    document.getElementById('editPhone').value = item.phone || '';
    document.getElementById('editVType').value = item.vType;
    document.getElementById('editVYear').value = item.vYear || '';
    document.getElementById('editAddress').value = item.address || '';
    document.getElementById('editModal').style.display = 'block';
    document.getElementById('confirmEditBtn').onclick = async () => {
    const newOwner = document.getElementById('editOwnerName').value.trim();
    const newPhone = document.getElementById('editPhone').value.trim();
    const newVType = document.getElementById('editVType').value;
    const newVYear = document.getElementById('editVYear').value;
    const newAddress = document.getElementById('editAddress').value.trim();
    if (!newOwner || !newPhone || newPhone.length !== 11) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
    return;
    }
    document.getElementById('loadingSpinner').style.display = 'block';
    const { error: editError3 } = await window.supabaseClient
    .from('orders')
    .update({
    owner_name: newOwner,
    phone: newPhone,
    vehicle_type: newVType,
    vehicle_year: newVYear,
    address: newAddress,
    status_history: [...(item.statusHistory || []), {
    status: item.status || 'pending',
    timestamp: Date.now(),
    note: "ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
    by: userRole
    }]
    })
    .eq('id', id);
    if (editError3) throw editError3;
    await logAdminAction(currentUsername, 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª', `ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ÙƒØ¨Ø© ${item.vType} Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber})`);
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('editModal').style.display = 'none';
    alert("âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
    };
    };

    tr.querySelector('.btn-del').onclick = async () => {
    if (confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
    try {
    // Delete from Database
    const { error } = await window.supabaseClient
    .from("orders")
    .delete()
    .eq("id", id);
    if (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:', error);
    alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + error.message);
    return;
    }
    await logAdminAction(currentUsername, 'Ø­Ø°Ù Ø·Ù„Ø¨', `ØªÙ… Ø­Ø°Ù Ø·Ù„Ø¨ Ù…Ø±ÙƒØ¨Ø© ${item.vType} Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber})`);
    alert("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");
    await loadAdminData();
    } catch (err) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù:', err);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù");
    }
    }
    };

    tr.querySelector('.btn-log').onclick = () => {
    showActivityLog(item);
    };

    tr.querySelector('.view-btn').onclick = () => {
    if (item.images && item.images.length > 0) {
    viewImages(item.images);
    } else {
    alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶");
    }
    };

    ordersArray.push({ element: tr, item: item, id: id });
    });
    document.getElementById('statTotal').innerText = total;
    document.getElementById('statCoded').innerText = coded;
    document.getElementById('statPending').innerText = pending;
    document.getElementById('loadingMoreInfo').style.display = 'none';

    initializePagination(ordersArray);
    console.log(`ğŸ‰ ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­: ${supabaseOrders.length} Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);
    window.isLoadingAll = false;

    } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
    document.getElementById('loadingMoreInfo').style.display = 'none';
    document.getElementById('loadAllDataBtn').style.display = 'inline-block';
    window.isLoadingAll = false;
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
    };

    // Load Complaints
    async function loadComplaints() {
    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰...');
    
    try {
    const { data: complaints, error } = await window.supabaseClient
    .from('complaints')
    .select('*')
    .order('submitted_at', { ascending: false });

    if (error) throw error;

    const tableBody = document.getElementById('compTableBody');
    tableBody.innerHTML = '';

    // Update complaints count
    document.getElementById('statCompTotal').innerText = complaints ? complaints.length : 0;

    if (!complaints || complaints.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰</td></tr>';
    return;
    }

    complaints.forEach((complaint) => {
    const statusColor = complaint.status === 'replied' ? 'var(--secondary)' : 'var(--warning)';
    const statusText = complaint.status === 'replied' ? 'âœ… ØªÙ… Ø§Ù„Ø±Ø¯' : 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
    
    const tr = document.createElement('tr');
    tr.style.background = 'rgba(255, 255, 255, 0.85)';
    
    tr.innerHTML = `
    <td style="padding: 18px; font-weight: 600;">${complaint.owner_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
    <td style="padding: 18px; font-family: monospace;">${complaint.phone || '-'}</td>
    <td style="padding: 18px;"><span style="background: rgba(211, 84, 0, 0.1); color: var(--accent); padding: 6px 12px; border-radius: 8px; font-weight: 600;">${complaint.complaint_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
    <td style="padding: 18px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${complaint.details || '-'}">${complaint.details || '-'}</td>
    <td style="padding: 18px; text-align: center;">
    <button class="btn btn-view-complaint-images" style="background: rgba(26, 82, 118, 0.12); color: var(--primary); padding: 8px 16px; font-weight: 600;">ğŸ–¼ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</button>
    </td>
    <td style="padding: 18px;"><span style="background: ${statusColor}; color: white; padding: 6px 12px; border-radius: 8px; font-weight: bold;">${statusText}</span></td>
    <td style="padding: 18px; display: flex; gap: 8px; flex-wrap: wrap;">
    <button class="btn btn-reply-complaint" style="background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white; padding: 8px 16px; font-weight: 600; display: ${userRole === 'VIEWER' ? 'none' : 'inline-flex'};">ğŸ’¬ Ø±Ø¯</button>
    <button class="btn btn-delete-complaint" style="background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white; padding: 8px 16px; font-weight: 600; display: ${userRole === 'SUPER' ? 'inline-flex' : 'none'};">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </td>
    `;

    // View images button
    tr.querySelector('.btn-view-complaint-images').onclick = () => {
    if (complaint.images) {
    if (typeof complaint.images === 'object' && !Array.isArray(complaint.images)) {
    showCategorizedImages(complaint.images);
    } else if (Array.isArray(complaint.images)) {
    viewImages(complaint.images);
    }
    } else {
    alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶");
    }
    };

    // Reply button
    tr.querySelector('.btn-reply-complaint').onclick = () => {
    document.getElementById('complaintReplyModal').style.display = 'block';
    document.getElementById('complaintReplyText').value = complaint.reply || '';
    document.getElementById('sendWhatsAppReply').checked = true;
    window.currentComplaintReply = { 
    item: {
    ownerName: complaint.owner_name,
    phone: complaint.phone,
    type: complaint.complaint_type
    }, 
    id: complaint.id 
    };
    };

    // Delete button (SUPER only)
    const deleteBtn = tr.querySelector('.btn-delete-complaint');
    if (deleteBtn) {
    deleteBtn.onclick = async () => {
    if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´ÙƒÙˆÙ‰ØŸ\n\nØ§Ù„Ù…Ù‚Ø¯Ù… Ù…Ù†: ${complaint.owner_name}\nØ§Ù„Ù†ÙˆØ¹: ${complaint.complaint_type}\n\nâš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
    return;
    }

    document.getElementById('loadingSpinner').style.display = 'block';

    try {
    const { error } = await window.supabaseClient
    .from('complaints')
    .delete()
    .eq('id', complaint.id);

    if (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø´ÙƒÙˆÙ‰:', error);
    throw error;
    }

    // Log delete action
    await logAdminAction(currentUsername, 'Ø­Ø°Ù Ø´ÙƒÙˆÙ‰', `ØªÙ… Ø­Ø°Ù Ø´ÙƒÙˆÙ‰ Ù…Ù† Ù†ÙˆØ¹: ${complaint.complaint_type} Ù„Ù„Ù…ÙˆØ§Ø·Ù†: ${complaint.owner_name}`);

    document.getElementById('loadingSpinner').style.display = 'none';
    alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!");

    // Reload complaints
    await loadComplaints();

    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø´ÙƒÙˆÙ‰:', error);
    alert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø´ÙƒÙˆÙ‰:\n\n${error.message || error.toString()}\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`);
    }
    };
    }

    tableBody.appendChild(tr);
    });

    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${complaints.length} Ø´ÙƒÙˆÙ‰`);
    } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰:', error);
    document.getElementById('compTableBody').innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--danger);">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</td></tr>';
    }
    }

    // Show Orders/Complaints
    document.getElementById('showOrdersBtn').onclick = () => {
    document.getElementById('ordersTableContainer').style.display = 'block';
    document.getElementById('complaintsTableContainer').style.display = 'none';
    document.getElementById('adminLogsTableContainer').style.display = 'none';
    showAllOrdersInTable();
    };

    // Status Change Modal Handler
    document.getElementById('confirmStatusChangeBtn').onclick = async () => {
    if (!window.currentStatusChangeItem) return;

    const { item, id } = window.currentStatusChangeItem;
    const newStatus = document.getElementById('newStatusSelect').value;
    const note = document.getElementById('statusNote').value.trim();
    const sendWhatsApp = document.getElementById('sendWhatsAppStatus').checked;

    const statusNames = {
    "pending": "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
    "approved": "ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„",
    "coded": "ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯",
    "delivered": "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…"
    };

    if (!id) {
    alert("âŒ Ø®Ø·Ø£: Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    console.error('Missing order ID:', window.currentStatusChangeItem);
    return;
    }

    document.getElementById('loadingSpinner').style.display = 'block';

    try {
    const { error: statusError } = await window.supabaseClient
    .from('orders')
    .update({
    status: newStatus,
    status_history: [...(item.statusHistory || []), {
    status: newStatus,
    timestamp: Date.now(),
    note: note || "",
    by: userRole
    }]
    })
    .eq('id', id);

    if (statusError) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:', statusError);
    throw statusError;
    }

    // Log status change action
    await logAdminAction(currentUsername, 'ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø©', `ØªÙ… ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ù…Ø±ÙƒØ¨Ø© ${item.vType} Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} Ø¥Ù„Ù‰: ${statusNames[newStatus]} (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber})`);

    // Send WhatsApp notification if checkbox is checked
    if (sendWhatsApp && item.phone && item.phone.length === 11) {
    let message = '';
    const statusName = statusNames[newStatus];

    if (newStatus === 'approved') {
    message = `âœ… *ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨Ùƒ!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${item.owner}\n` +
    `ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${item.vType}\n` +
    ` Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber}\n\n` +
    `âœ… Ø§Ù„Ø­Ø§Ù„Ø©: ${statusName}\n` +
    `â³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„ØªÙƒÙˆÙŠØ¯ØŒ Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;
    } else if (newStatus === 'delivered') {
    message = `ğŸ‰ *ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ø±ÙƒØ¨Ø©!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${item.owner}\n` +
    `ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${item.vType}\n` +
    `ğŸ”¢ Ø§Ù„ÙƒÙˆØ¯: ${item.vCode || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}\n` +
    `ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber}\n\n` +
    `âœ… Ø§Ù„Ø­Ø§Ù„Ø©: ${statusName}\n` +
    `ğŸŠ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ÙƒÙ… Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ØªÙƒÙˆÙŠØ¯\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;
    } else if (newStatus === 'pending') {
    message = `â³ *ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${item.owner}\n` +
    `ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${item.vType}\n` +
    `ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber}\n\n` +
    `â³ Ø§Ù„Ø­Ø§Ù„Ø©: ${statusName}\n` +
    `ğŸ“ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;
    } else if (newStatus === 'coded') {
    message = `âœ… *ØªÙ… ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨ØªÙƒ!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${item.owner}\n` +
    `ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${item.vType}\n` +
    `ğŸ”¢ Ø§Ù„ÙƒÙˆØ¯: ${item.vCode || 'Ø³ÙŠØªÙ… Ø¥Ø¨Ù„Ø§ØºÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹'}\n` +
    `ğŸ“‹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ: ${item.refNumber}\n\n` +
    `âœ… Ø§Ù„Ø­Ø§Ù„Ø©: ${statusName}\n` +
    `ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 01021102607\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;
    }

    if (message) {
    const whatsappUrl = `https://wa.me/2${item.phone}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
    }
    }

    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('statusChangeModal').style.display = 'none';
    alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!" + (sendWhatsApp && item.phone && item.phone.length === 11 ? "\nğŸ“± ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±" : ""));

    // Reload data to show updated record
    await loadAdminData();

    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:', error);
    alert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:\n\n${error.message || error.toString()}\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`);
    }
    };

    document.getElementById('showComplaintsBtn').onclick = () => {
    document.getElementById('ordersTableContainer').style.display = 'none';
    document.getElementById('complaintsTableContainer').style.display = 'block';
    document.getElementById('adminLogsTableContainer').style.display = 'none';
    loadComplaints();
    };

    // Complaint Reply Modal Handler
    document.getElementById('confirmComplaintReplyBtn').onclick = async () => {
    if (!window.currentComplaintReply) return;

    const { item, id } = window.currentComplaintReply;
    const reply = document.getElementById('complaintReplyText').value.trim();
    const sendWhatsApp = document.getElementById('sendWhatsAppReply').checked;

    if (!reply) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø±Ø¯");
    return;
    }

    if (!id) {
    alert("âŒ Ø®Ø·Ø£: Ù…Ø¹Ø±Ù Ø§Ù„Ø´ÙƒÙˆÙ‰ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    console.error('Missing complaint ID:', window.currentComplaintReply);
    return;
    }

    document.getElementById('loadingSpinner').style.display = 'block';

    try {
    const { error } = await window.supabaseClient
    .from('complaints')
    .update({
    reply: reply,
    status: 'replied'
    })
    .eq('id', id);

    if (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙˆÙ‰:', error);
    throw error;
    }

    // Log complaint reply action
    await logAdminAction(currentUsername, 'Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø´ÙƒÙˆÙ‰', `ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø´ÙƒÙˆÙ‰ Ù…Ù† Ù†ÙˆØ¹: ${item.type} Ù„Ù„Ù…ÙˆØ§Ø·Ù†: ${item.ownerName}`);

    // Send WhatsApp notification if checkbox is checked
    if (sendWhatsApp && item.phone && item.phone.length === 11) {
    const message = `âœ… *ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø´ÙƒÙˆØ§Ùƒ!*\n\n` +
    `ğŸ‘¤ Ø§Ù„Ø³ÙŠØ¯/Ø©: ${item.ownerName}\n` +
    `ğŸ“‹ Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰: ${item.type}\n\n` +
    `ğŸ’¬ *Ø§Ù„Ø±Ø¯ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:*\n${reply}\n\n` +
    `ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 01021102607\n\n` +
    `_Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±_`;

    const whatsappUrl = `https://wa.me/2${item.phone}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
    }

    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('complaintReplyModal').style.display = 'none';
    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­!" + (sendWhatsApp && item.phone && item.phone.length === 11 ? "\nğŸ“± ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯" : ""));

    // Reload complaints to show updated data
    await loadComplaints();

    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰:', error);
    alert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø±Ø¯:\n\n${error.message || error.toString()}\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`);
    }
    };

    document.getElementById('showAdminLogsBtn').onclick = () => {
    document.getElementById('ordersTableContainer').style.display = 'none';
    document.getElementById('complaintsTableContainer').style.display = 'none';
    document.getElementById('adminLogsTableContainer').style.display = 'block';
    loadAdminLogs();
    };

    // Filter functions for stat cards
    function showAllOrders() {
        filteredOrdersData = allOrdersData;
        currentPage = 1;
        renderCurrentPage();
        const ordersContainer = document.getElementById('ordersTableContainer');
        const complaintsContainer = document.getElementById('complaintsTableContainer');
        const logsContainer = document.getElementById('adminLogsContainer');
        
        if (ordersContainer) ordersContainer.style.display = 'block';
        if (complaintsContainer) complaintsContainer.style.display = 'none';
        if (logsContainer) logsContainer.style.display = 'none';
    }

    function showAllOrdersInTable() {
        // OLD FUNCTION - Replaced by showAllOrders with Pagination
        showAllOrders();
    }

    function showCodedOrders() {
        filteredOrdersData = allOrdersData.filter(orderData => {
            const item = orderData.item;
            return item.status === 'coded' || item.status === 'delivered';
        });
        currentPage = 1;
        renderCurrentPage();
        const ordersContainer = document.getElementById('ordersTableContainer');
        const complaintsContainer = document.getElementById('complaintsTableContainer');
        const logsContainer = document.getElementById('adminLogsContainer');
        if (ordersContainer) ordersContainer.style.display = 'block';
        if (complaintsContainer) complaintsContainer.style.display = 'none';
        if (logsContainer) logsContainer.style.display = 'none';
    }

    function showPendingOrders() {
        filteredOrdersData = allOrdersData.filter(orderData => {
            const item = orderData.item;
            return item.status === 'pending' || item.status === 'approved' || !item.status;
        });
        currentPage = 1;
        renderCurrentPage();
        const ordersContainer = document.getElementById('ordersTableContainer');
        const complaintsContainer = document.getElementById('complaintsTableContainer');
        const logsContainer = document.getElementById('adminLogsContainer');
        if (ordersContainer) ordersContainer.style.display = 'block';
        if (complaintsContainer) complaintsContainer.style.display = 'none';
        if (logsContainer) logsContainer.style.display = 'none';
    }

    function showComplaintsTable() {
        const ordersContainer = document.getElementById('ordersTableContainer');
        const complaintsContainer = document.getElementById('complaintsTableContainer');
        const filterStatus = document.getElementById('filterStatus');
        if (ordersContainer) ordersContainer.style.display = 'none';
        if (complaintsContainer) complaintsContainer.style.display = 'block';
        if (filterStatus) filterStatus.style.display = 'none';
        loadComplaints();
    }

    // Make functions global
    window.showAllOrders = showAllOrders;
    window.showCodedOrders = showCodedOrders;
    window.showPendingOrders = showPendingOrders;
    window.showComplaintsTable = showComplaintsTable;

    // Show Activity Log
    function showActivityLog(item) {
    const modal = document.getElementById('activityLogModal');
    const content = document.getElementById('activityLogContent');
    const history = item.statusHistory || [];

    let html = `
    <div style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.1) 0%, rgba(44, 62, 80, 0.1) 100%); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 2px solid #34495e;">
    <h4 style="color: #34495e; margin: 0 0 10px 0;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨:</h4>
    <p style="margin: 5px 0;"><strong>Ø§Ù„Ù…Ø§Ù„Ùƒ:</strong> ${item.owner}</p>
    <p style="margin: 5px 0;"><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ:</strong> ${item.refNumber || 'N/A'}</p>
    <p style="margin: 5px 0;"><strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</strong> ${item.vType}</p>
    </div>
    `;

    if (history.length === 0) {
    html += '<p style="text-align: center; color: #999; padding: 40px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª</p>';
    } else {
    html += '<div style="position: relative; padding-right: 30px;">';
    history.forEach((log, index) => {
    const statusInfo = window.getStatusDisplay(log.status);
    const isLast = index === history.length - 1;
    html += `
    <div style="position: relative; margin-bottom: 25px;">
    <div style="position: absolute; right: -30px; top: 0; width: 20px; height: 20px; background: ${statusInfo.color}; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"></div>
    ${!isLast ? '<div style="position: absolute; right: -21px; top: 20px; width: 2px; height: calc(100% + 25px); background: #ddd;"></div>' : ''}
    <div style="background: white; padding: 20px; border-radius: 15px; border: 2px solid ${statusInfo.color}; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <span style="background: ${statusInfo.color}; color: white; padding: 6px 12px; border-radius: 8px; font-weight: bold; font-size: 0.9rem;">${statusInfo.icon} ${statusInfo.text}</span>
    <span style="color: #999; font-size: 0.85rem;">${window.formatDateTime(log.timestamp)}</span>
    </div>
    ${log.note ? `<p style="margin: 10px 0 0 0; color: #555; line-height: 1.6;">${log.note}</p>` : ''}
    ${log.by ? `<p style="margin: 10px 0 0 0; color: #999; font-size: 0.85rem;">Ø¨ÙˆØ§Ø³Ø·Ø©: ${log.by === 'SUPER' ? 'ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…' : log.by === 'ADMIN' ? 'ğŸ”§ Ù…Ø´Ø±Ù' : log.by}</p>` : ''}
    </div>
    </div>
    `;
    });
    html += '</div>';
    }

    content.innerHTML = html;
    modal.style.display = 'block';
    }

    window.showActivityLog = showActivityLog;

    // Date Filter
    let dateFilterActive = false;
    let filterFromTimestamp = null;
    let filterToTimestamp = null; 
    document.getElementById('dateFilterBtn').onclick = () => {document.getElementById('dateFilterModal').style.display = 'block';
    };

    // Toggle columns button (mobile only)
    document.getElementById('toggleColumnsBtn').onclick = () => {
    const table = document.querySelector('#dataTable').parentElement.parentElement.querySelector('table');
    if (table.classList.contains('show-all-columns')) {
    table.classList.remove('show-all-columns');
    document.getElementById('toggleColumnsBtn').innerHTML = 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©';
    } else {
    table.classList.add('show-all-columns');
    document.getElementById('toggleColumnsBtn').innerHTML = 'ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø²ÙŠØ§Ø¯Ø©';
    }
    };

    document.getElementById('applyDateFilterBtn').onclick = () => {
    const fromDate = document.getElementById('filterFromDate').value;
    const toDate = document.getElementById('filterToDate').value;

    if (!fromDate || !toDate) {
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† ÙˆØ§Ù„Ù‰");
    return;
    }

    filterFromTimestamp = new Date(fromDate).setHours(0, 0, 0, 0);
    filterToTimestamp = new Date(toDate).setHours(23, 59, 59, 999);
    dateFilterActive = true;
    document.getElementById('dateFilterModal').style.display = 'none';
    document.getElementById('filterStatus').style.display = 'block';
    document.getElementById('filterStatusText').innerText = `ğŸ“… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† ${fromDate} Ø¥Ù„Ù‰ ${toDate}`;

    applyDateFilter();
    };

    function clearDateFilter() {
    dateFilterActive = false;
    filterFromTimestamp = null;
    filterToTimestamp = null; 
    document.getElementById('filterFromDate').value = ''; 
    document.getElementById('filterToDate').value = ''; 
    document.getElementById('dateFilterModal').style.display = 'none'; 
    document.getElementById('filterStatus').style.display = 'none';
    showAllOrdersInTable();
    }

    window.clearDateFilter = clearDateFilter;

    function applyDateFilter() {
    let count = 0;
    document.querySelectorAll('#dataTable tr').forEach(row => {
    const timestampCell = row.cells[5]; // Date column
    if (timestampCell) {
    const dateText = timestampCell.innerText;
    // Try to parse the date - this is approximate
    const rowDate = new Date(dateText.split(' ')[0].split('/').reverse().join('-'));
    const rowTimestamp = rowDate.getTime();

    if (rowTimestamp >= filterFromTimestamp && rowTimestamp <= filterToTimestamp) {
    row.style.display = '';
    count++;
    } else {
    row.style.display = 'none';
    }
    }
    }); 
    document.getElementById('filterStatusText').innerText = `ğŸ“… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© (${count} Ø·Ù„Ø¨)`;
    }

    // Load Admin Logs
    async function loadAdminLogs() {
    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†...');
    
    try {
    const { data: logs, error } = await window.supabaseClient
    .from('admin_logs')
    .select('*')
    .order('logged_at', { ascending: false })
    .limit(200);

    if (error) throw error;

    const tableBody = document.getElementById('adminLogsTableBody');
    tableBody.innerHTML = '';

    if (!logs || logs.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª</td></tr>';
    return;
    }

    logs.forEach(item => {
    const roleIcon = item.role === 'SUPER' ? 'ğŸ‘‘' : item.role === 'ADMIN' ? 'ğŸ”§' : 'ğŸ‘ï¸';
    const roleText = item.role === 'SUPER' ? 'Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…' : item.role === 'ADMIN' ? 'Ù…Ø´Ø±Ù' : 'Ø¹Ø±Ø¶ ÙÙ‚Ø·';

    const tr = document.createElement('tr');
    tr.innerHTML = `
    <td style="padding: 18px; background: rgba(255, 255, 255, 0.85); font-weight:bold;">
    <span style="background: ${item.role === 'SUPER' ? '#e74c3c' : item.role === 'ADMIN' ? '#3498db' : '#95a5a6'}; color: white; padding: 6px 12px; border-radius: 8px; font-size: 0.9rem;">
    ${roleIcon} ${item.username}
    </span>
    <br><small style="color: #999; font-size: 0.85rem;">${roleText}</small>
    </td>
    <td style="padding: 18px; background: rgba(255, 255, 255, 0.85); font-weight:600; color: var(--primary);">${item.action}</td>
    <td style="padding: 18px; background: rgba(255, 255, 255, 0.85); color: #555;">${item.details}</td>
    <td style="padding: 18px; background: rgba(255, 255, 255, 0.85); font-size:0.9rem; color:#666;">${window.formatDateTime(item.logged_at)}</td>
    <td style="padding: 18px; background: rgba(255, 255, 255, 0.85); font-family: monospace; color: #999;">${item.ip_address || 'N/A'}</td>
    `;
    tableBody.appendChild(tr);
    });

    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${logs.length} Ø³Ø¬Ù„`);
    } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†:', error);
    document.getElementById('adminLogsTableBody').innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: var(--danger);">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„</td></tr>';
    }
    }

    // Export Excel
    document.getElementById('exportExcelBtn').onclick = () => {
    const wb = XLSX.utils.table_to_book(document.getElementById("excelTable"));
    XLSX.writeFile(wb, `Ù…Ù†Ø¸ÙˆÙ…Ø©_ÙƒÙØ±_ØµÙ‚Ø±_${new Date().toLocaleDateString('ar-EG')}.xlsx`);
    alert("âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
    };

    // Clean Duplicates Main Button (same as cleanDuplicatesBtn)
    document.getElementById('cleanDuplicatesMainBtn').onclick = async () => {
    if (!confirm('ğŸ§¹ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©ØŸ\n\nØ³ÙŠØªÙ…:\nâœ… Ø­Ø°Ù Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\nâœ… Ø­Ø°Ù Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…\nâœ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø£Ø­Ø¯Ø« Ø³Ø¬Ù„ ÙÙ‚Ø·')) {
    return;
    }

    const loadingDiv = document.createElement('div');
    loadingDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:10000;text-align:center;';
    loadingDiv.innerHTML = '<div style="font-size:3rem;margin-bottom:15px;">ğŸ§¹</div><div style="font-size:1.2rem;color:#333;font-weight:600;">Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©...</div><div style="margin-top:10px;color:#666;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>';
    document.body.appendChild(loadingDiv);

    try {
    // Load all data from Supabase (with pagination)
    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    let allOrders = [];
    let from = 0;
    const batchSize = 1000;
    let hasMore = true;

    while (hasMore) {
    const { data: batch, error } = await window.supabaseClient
    .from('orders')
    .select('*')
    .order('submitted_at', { ascending: false })
    .range(from, from + batchSize - 1);

    if (error) throw error;

    if (batch && batch.length > 0) {
    allOrders = allOrders.concat(batch);
    from += batchSize;
    hasMore = batch.length === batchSize;
    console.log(`ğŸ“¥ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allOrders.length} Ø³Ø¬Ù„...`);
    } else {
    hasMore = false;
    }
    }

    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allOrders.length} Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    // Find duplicates by national_id
    const seenNIDs = new Map();
    const duplicateIds = [];

    allOrders.forEach(order => {
    if (!order.national_id) return;

    if (seenNIDs.has(order.national_id)) {
    const existing = seenNIDs.get(order.national_id);
    const existingDate = new Date(existing.submitted_at || 0);
    const currentDate = new Date(order.submitted_at || 0);

    if (currentDate > existingDate) {
    duplicateIds.push(existing.id);
    seenNIDs.set(order.national_id, order);
    } else {
    duplicateIds.push(order.id);
    }
    } else {
    seenNIDs.set(order.national_id, order);
    }
    });

    console.log(`ğŸ” ÙˆØ¬Ø¯Øª ${duplicateIds.length} Ø³Ø¬Ù„ Ù…ÙƒØ±Ø±`);

    if (duplicateIds.length === 0) {
    loadingDiv.remove();
    alert('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…ÙƒØ±Ø±Ø©!\n\nØ¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙØ±ÙŠØ¯Ø©.');
    return;
    }

    // Delete duplicates from Supabase
    console.log('ğŸ—‘ï¸ Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    const deleteBatchSize = 50;
    let deletedCount = 0;

    for (let i = 0; i < duplicateIds.length; i += deleteBatchSize) {
    const batch = duplicateIds.slice(i, i + deleteBatchSize);
    const { error: deleteError } = await window.supabaseClient
    .from('orders')
    .delete()
    .in('id', batch);

    if (deleteError) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø¯ÙØ¹Ø©:', deleteError);
    } else {
    deletedCount += batch.length;
    console.log(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ù…Ù† ${duplicateIds.length}`);
    }
    }

    // Clean LocalStorage
    console.log('ğŸ§¹ Ø¬Ø§Ø±ÙŠ ØªÙ†Ø¸ÙŠÙ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...');
    const uniqueOrders = Array.from(seenNIDs.values()).map(order => ({
    id: order.id,
    owner: order.owner_name,
    nationalId: order.national_id,
    phone: order.phone,
    address: order.address,
    vType: order.vehicle_type,
    vCode: order.code || '',
    vYear: order.vehicle_year,
    chassisNumber: order.chassis_number,
    motorNumber: order.motor_number,
    refNumber: order.ref_number,
    timestamp: order.submitted_at,
    status: order.status,
    images: order.images || []
    }));

    // Data stored securely in Database
    console.log(`âœ… ØªÙ… Ø­ÙØ¸ ${uniqueOrders.length} Ø³Ø¬Ù„ ÙØ±ÙŠØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    loadingDiv.remove();
    alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù: ${deletedCount} Ø³Ø¬Ù„ Ù…ÙƒØ±Ø±\nâœ… ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€: ${uniqueOrders.length} Ø³Ø¬Ù„ ÙØ±ÙŠØ¯\n\nâ˜ï¸ ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    // Reload data
    await loadAdminData();
    } catch (error) {
    loadingDiv.remove();
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…ÙƒØ±Ø±: ' + error.message);
    console.error('Clean duplicates error:', error);
    }
    };

    // Search - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Pagination Ø§Ù„Ø¬Ø¯ÙŠØ¯
    // ØªÙ… Ù†Ù‚Ù„ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Pagination

    // Make functions and variables global
    window.viewImages = viewImages;

    // Bulk Import - Open Modal instead of new page
    document.getElementById('bulkImportBtn').onclick = () => {
    document.getElementById('bulkImportModal').style.display = 'block';
    document.getElementById('bulkImportFile').value = '';
    document.getElementById('importPreview').style.display = 'none';
    document.getElementById('importPreview').innerHTML = '';
    };

    // Upload LocalStorage to Supabase
    const uploadBtn = document.getElementById('uploadLocalToSupabaseBtn');
    if (uploadBtn) {
    uploadBtn.onclick = async () => {
    if (!confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ SupabaseØŸ\n\nÙ…Ù„Ø§Ø­Ø¸Ø©: LocalStorage ØªÙ… Ø¥Ø²Ø§Ù„ØªÙ‡ Ù„Ù„Ø£Ù…Ø§Ù†ØŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·.')) {
    return;
    }

    // LocalStorage removed - data is only in Supabase now
    alert('â„¹ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·.\n\nØ§Ø³ØªØ®Ø¯Ù… "ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª.');
    return;

    console.log(`ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø³Ø±ÙŠØ¹: ${orders.length} Ø³Ø¬Ù„`);

    for (let i = 0; i < orders.length; i += batchSize) {
    const batch = orders.slice(i, Math.min(i + batchSize, orders.length));

    // Upload without checking duplicates (faster!)
    const promises = batch.map(async (order) => {
    try {

    uploaded++;
    if (uploaded % 100 === 0) {
    console.log(`âœ… ØªÙ… Ø±ÙØ¹ ${uploaded} Ù…Ù† ${orders.length}`);
    }
    } catch (err) {
    console.error('Ø®Ø·Ø£:', err);
    skipped++;
    }
    });

    await Promise.all(promises);
    }
    document.getElementById('loadingSpinner').style.display = 'none';
    alert(`âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“¤ ØªÙ… Ø±ÙØ¹: ${uploaded} Ø³Ø¬Ù„\nâŒ ÙØ´Ù„: ${skipped} Ø³Ø¬Ù„\n\nØ§ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø§Ù„ØªÙ„ÙÙˆÙ† Ø§Ù„Ø¢Ù†!`);
    };
    }

    // Cleanup Duplicates Button Handler
    if (document.getElementById('cleanupDuplicatesBtn')) {
    document.getElementById('cleanupDuplicatesBtn').onclick = async () => {
    if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©ØŸ\n\nØ³ÙŠØªÙ…:\nâœ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\nâœ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© Ù…Ù† LocalStorage\nâœ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø£ÙˆÙ„ Ø³Ø¬Ù„ ÙÙ‚Ø· Ù„ÙƒÙ„ Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ\n\nâš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§!')) {
    return;
    }
    document.getElementById('loadingSpinner').style.display = 'block';

    try {
    console.log('ğŸ§¹ Ø¨Ø¯Ø¡ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©...');

    // Step 1: Load all data from Supabase
    const { data: allSupabaseOrders, error: loadError } = await window.supabaseClient
    .from('orders')
    .select('*');

    if (loadError) throw loadError;

    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allSupabaseOrders.length} Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    // Step 2: Find duplicates by nationalId and refNumber
    const seenNIDs = new Map(); // nationalId -> first record
    const seenRefs = new Map(); // refNumber -> first record
    const duplicatesToDelete = [];

    allSupabaseOrders.forEach(order => {
    let isDuplicate = false;

    // Check nationalId duplicate
    if (order.nationalId) {
    if (seenNIDs.has(order.nationalId)) {
    isDuplicate = true;
    duplicatesToDelete.push({ id: order.id, reason: `Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ Ù…ÙƒØ±Ø±: ${order.nationalId}` });
    } else {
    seenNIDs.set(order.nationalId, order);
    }
    }

    // Check refNumber duplicate (only if not already marked as duplicate)
    if (!isDuplicate && order.refNumber) {
    if (seenRefs.has(order.refNumber)) {
    isDuplicate = true;
    duplicatesToDelete.push({ id: order.id, reason: `Ø±Ù‚Ù… Ù…Ø±Ø¬Ø¹ÙŠ Ù…ÙƒØ±Ø±: ${order.refNumber}` });
    } else {
    seenRefs.set(order.refNumber, order);
    }
    }
    });

    console.log(`ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${duplicatesToDelete.length} Ø³Ø¬Ù„ Ù…ÙƒØ±Ø±`);

    if (duplicatesToDelete.length === 0) {
    alert('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªÙƒØ±Ø±Ø©!\n\nÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø¸ÙŠÙØ© Ø¨Ø§Ù„ÙØ¹Ù„.'); 
    document.getElementById('loadingSpinner').style.display = 'none';
    return;
    }

    // Step 3: Delete duplicates from Database
    let deletedCount = 0;
    for (const dup of duplicatesToDelete) {
    try {
    const { error } = await window.supabaseClient
    .from('orders')
    .delete()
    .eq('id', dup.id);
    if (error) throw error;
    deletedCount++;
    console.log(`âœ… ØªÙ… Ø­Ø°Ù: ${dup.reason}`);
    } catch (e) {
    console.error(`âŒ ÙØ´Ù„ Ø­Ø°Ù ${dup.id}:`, e);
    }
    }

    // Step 4: Log the action
    await logAdminAction(currentUsername, 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©', `ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ Ù…ÙƒØ±Ø± Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`); 
    document.getElementById('loadingSpinner').style.display = 'none';
    alert(`âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:\nğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ Ù…ÙƒØ±Ø± Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\nğŸ’¾ ØªÙ… ØªÙ†Ø¸ÙŠÙ LocalStorage\n\nğŸ”„ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¢Ù†...`);
    location.reload();

    } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
    document.getElementById('loadingSpinner').style.display = 'none';
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n' + error.message);
    }
    };
    }

    // Download Template
    document.getElementById('downloadTemplateBtn').onclick = () => {
    const templateData = [
    ['Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ', 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³Ù†Ø©', 'Ø§Ù„Ù„ÙˆÙ†', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©'],
    ['Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø­Ø³Ù†', '29501011234567', '01012345678', 'ØªÙˆÙƒØªÙˆÙƒ', '2020', 'Ø£Ø­Ù…Ø±', 'ÙƒÙØ± ØµÙ‚Ø± - Ø­ÙŠ Ø§Ù„Ù†ØµØ±', ''],
    ['ÙØ§Ø·Ù…Ø© Ù…Ø­Ù…ÙˆØ¯ Ø³Ø¹ÙŠØ¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', '29601021234568', '01098765432', 'Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„', '2021', 'Ø£Ø³ÙˆØ¯', 'Ø§Ù„Ø¨ÙˆÙ‡Ø§ - Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¬Ù„Ø§Ø¡', '']
    ];

    const ws = XLSX.utils.aoa_to_sheet(templateData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    XLSX.writeFile(wb, 'Ù†Ù…ÙˆØ°Ø¬_Ø§Ø³ØªÙŠØ±Ø§Ø¯_Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª.xlsx');
    };

    // Clean Duplicates Button
    document.getElementById('cleanDuplicatesBtn').onclick = async () => {
    if (!confirm('ğŸ§¹ Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©ØŸ\n\nØ³ÙŠØªÙ…:\nâœ… Ø­Ø°Ù Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\nâœ… Ø­Ø°Ù Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ù† LocalStorage\nâœ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø£Ø­Ø¯Ø« Ø³Ø¬Ù„ ÙÙ‚Ø·')) {
    return;
    }

    const loadingDiv = document.createElement('div');
    loadingDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:30px;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:10000;text-align:center;';
    loadingDiv.innerHTML = '<div style="font-size:3rem;margin-bottom:15px;">ğŸ§¹</div><div style="font-size:1.2rem;color:#333;font-weight:600;">Ø¬Ø§Ø±ÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©...</div><div style="margin-top:10px;color:#666;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>';
    document.body.appendChild(loadingDiv);

    try {
    // 1. Load all data from Supabase (with pagination for large datasets)
    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    let allOrders = [];
    let from = 0;
    const batchSize = 1000;
    let hasMore = true;

    while (hasMore) {
    const { data: batch, error } = await window.supabaseClient
    .from('orders')
    .select('*')
    .order('submitted_at', { ascending: false })
    .range(from, from + batchSize - 1);

    if (error) throw error;

    if (batch && batch.length > 0) {
    allOrders = allOrders.concat(batch);
    from += batchSize;
    hasMore = batch.length === batchSize;
    console.log(`ğŸ“¥ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allOrders.length} Ø³Ø¬Ù„...`);
    } else {
    hasMore = false;
    }
    }

    console.log(`ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allOrders.length} Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    // 2. Find duplicates by national_id
    const seenNIDs = new Map(); // national_id -> latest record
    const duplicateIds = []; // IDs to delete

    allOrders.forEach(order => {
    if (!order.national_id) return; // Skip records without national_id

    if (seenNIDs.has(order.national_id)) {
    // Found duplicate - keep the newer one
    const existing = seenNIDs.get(order.national_id);
    const existingDate = new Date(existing.submitted_at || 0);
    const currentDate = new Date(order.submitted_at || 0);

    if (currentDate > existingDate) {
    // Current is newer - delete existing, keep current
    duplicateIds.push(existing.id);
    seenNIDs.set(order.national_id, order);
    } else {
    // Existing is newer - delete current
    duplicateIds.push(order.id);
    }
    } else {
    // First occurrence - keep it
    seenNIDs.set(order.national_id, order);
    }
    });

    console.log(`ğŸ” ÙˆØ¬Ø¯Øª ${duplicateIds.length} Ø³Ø¬Ù„ Ù…ÙƒØ±Ø±`);

    if (duplicateIds.length === 0) {
    loadingDiv.remove();
    alert('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…ÙƒØ±Ø±Ø©!\n\nØ¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙØ±ÙŠØ¯Ø©.');
    return;
    }

    // 3. Delete duplicates from Supabase in batches
    console.log('ğŸ—‘ï¸ Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    const deleteBatchSize = 50;
    let deletedCount = 0;

    for (let i = 0; i < duplicateIds.length; i += deleteBatchSize) {
    const batch = duplicateIds.slice(i, i + deleteBatchSize);
    const { error: deleteError } = await window.supabaseClient
    .from('orders')
    .delete()
    .in('id', batch);

    if (deleteError) {
    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø¯ÙØ¹Ø©:', deleteError);
    } else {
    deletedCount += batch.length;
    console.log(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ù…Ù† ${duplicateIds.length}`);
    }
    }

    // 4. Clean LocalStorage
    console.log('ğŸ§¹ Ø¬Ø§Ø±ÙŠ ØªÙ†Ø¸ÙŠÙ LocalStorage...');
    const uniqueOrders = Array.from(seenNIDs.values()).map(order => ({
    id: order.id,
    owner: order.owner_name,
    nationalId: order.national_id,
    phone: order.phone,
    address: order.address,
    vType: order.vehicle_type,
    vCode: order.code || '',
    vYear: order.vehicle_year,
    chassisNumber: order.chassis_number,
    motorNumber: order.motor_number,
    refNumber: order.ref_number,
    timestamp: order.submitted_at,
    status: order.status,
    images: order.images || []
    }));

    // Data stored securely in Database
    console.log(`âœ… ØªÙ… Ø­ÙØ¸ ${uniqueOrders.length} Ø³Ø¬Ù„ ÙØ±ÙŠØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    // 5. Reload data
    loadingDiv.remove();
    alert(`âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:\nâ€¢ ØªÙ… Ø­Ø°Ù: ${deletedCount} Ø³Ø¬Ù„ Ù…ÙƒØ±Ø±\nâ€¢ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${uniqueOrders.length} Ø³Ø¬Ù„ ÙØ±ÙŠØ¯\n\nØ³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¢Ù†...`);
    await loadAdminData();

    } catch (error) {
    loadingDiv.remove();
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:', error);
    alert(`âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:\n\n${error.message}`);
    }
    };

    let importedData = [];

    // Read Excel File
    document.getElementById('bulkImportFile').onchange = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
    try {
    const data = new Uint8Array(event.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

    if (jsonData.length < 2) {
    alert('âŒ Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
    return;
    }

    console.log('ğŸ“‹ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ:', jsonData.length);
    console.log('ğŸ“‹ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ (Header):', jsonData[0]);
    console.log('ğŸ“‹ Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ:', jsonData[1]);

    // Try Fixed Columns First (B-H format)
    let useFixedColumns = false;
    const columnMap = {};
    let dataStartRow = 1; // Default: data starts from row 1

    // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø«Ø§Ø¨Øª Ù„Ù„Ø£Ø¹Ù…Ø¯Ø© (Ù†ÙØ³ import_excel.html):
    // A=0 (Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ Ø£Ùˆ ÙØ§Ø¶ÙŠ)
    // B=1 (Ø§Ù„ÙƒÙˆØ¯), C=2 (Ø§Ù„Ø§Ø³Ù…), D=3 (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ), E=4 (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†), 
    // F=5 (Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡), G=6 (Ø§Ù„Ù…ÙˆØªÙˆØ±), H=7 (Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†)

    // Check if data follows fixed column format
    // Look for actual data (skip header rows)
    let foundFixedFormat = false;
    for (let i = 1; i < Math.min(jsonData.length, 5); i++) {
    if (jsonData[i] && jsonData[i].length >= 4) {
    const colC = jsonData[i][2]; // Column C - Ø§Ù„Ø§Ø³Ù…
    const colD = jsonData[i][3]; // Column D - Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ

    // Skip if row looks like header
    const colCStr = String(colC || '').trim();
    const colDStr = String(colD || '').trim();
    if (colCStr.includes('Ø§Ø³Ù…') || colCStr.includes('Ø§Ù„Ø§Ø³Ù…') || 
        colDStr.includes('Ù‚ÙˆÙ…ÙŠ') || colDStr.includes('Ø§Ù„Ø±Ù‚Ù…') ||
        colCStr.includes('name') || colDStr.includes('national')) {
    continue; // Skip header row
    }

    // Check if C has name and D has national ID
    if (colC && colD) {
    const nameStr = String(colC).trim();
    const nidStr = String(colD).replace(/[^0-9]/g, '');

    // If C looks like a name (length > 2) and D has digits
    if (nameStr.length > 2 && nidStr.length >= 10) {
    foundFixedFormat = true;
    dataStartRow = i;
    console.log('ğŸ“ ÙˆØ¬Ø¯Øª Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØµÙ ' + (i + 1));
    break;
    }
    }
    }
    }

    if (foundFixedFormat) {
    useFixedColumns = true;
    console.log('ğŸ“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© (B-H)ØŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙ ' + (dataStartRow + 1));
    }

    if (useFixedColumns) {
    // Fixed columns: B=1, C=2, D=3, E=4, F=5, G=6, H=7
    // Ù†ÙØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ import_excel.html
    columnMap.vCode = 1;        // B - Ø§Ù„ÙƒÙˆØ¯
    columnMap.owner = 2;        // C - Ø§Ù„Ø§Ø³Ù…
    columnMap.nationalId = 3;   // D - Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ
    columnMap.address = 4;      // E - Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    columnMap.chassisNumber = 5; // F - Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡
    columnMap.motorNumber = 6;   // G - Ø§Ù„Ù…ÙˆØªÙˆØ±
    columnMap.phone = 7;         // H - Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†
    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ©:', columnMap);
    } else {
    // Smart Column Detection
    const headers = jsonData[0].map(h => String(h).toLowerCase().trim());

    const patterns = {
    owner: ['Ø§Ø³Ù…', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù…Ø§Ù„Ùƒ', 'name', 'owner'],
    nationalId: ['Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ', 'Ø§Ù„Ù‚ÙˆÙ…ÙŠ', 'Ø¨Ø·Ø§Ù‚Ø©', 'national', 'id'],
    phone: ['Ù‡Ø§ØªÙ', 'ØªÙ„ÙŠÙÙˆÙ†', 'Ù…ÙˆØ¨Ø§ÙŠÙ„', 'phone', 'mobile'],
    vType: ['Ù†ÙˆØ¹', 'Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'type', 'vehicle'],
    vYear: ['Ù…ÙˆØ¯ÙŠÙ„', 'Ø³Ù†Ø©', 'year', 'model'],
    vColor: ['Ù„ÙˆÙ†', 'color'],
    address: ['Ø¹Ù†ÙˆØ§Ù†', 'address', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'],
    vCode: ['ÙƒÙˆØ¯', 'code', 'Ø§Ù„ÙƒÙˆØ¯'],
    chassisNumber: ['Ø´Ø§Ø³ÙŠÙ‡', 'chassis', 'Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡'],
    motorNumber: ['Ù…ÙˆØªÙˆØ±', 'motor', 'Ø§Ù„Ù…ÙˆØªÙˆØ±']
    };

    // Match columns automatically
    for (let i = 0; i < headers.length; i++) {
    const header = headers[i];
    for (const [key, keywords] of Object.entries(patterns)) {
    if (keywords.some(kw => header.includes(kw))) {
    columnMap[key] = i;
    break;
    }
    }
    }

    console.log('ğŸ§  Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
    }

    // Check required columns
    if (columnMap.owner === undefined || columnMap.nationalId === undefined) {
    alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ)\n\nØªØ£ÙƒØ¯ Ù…Ù†:\nâ€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø£Ø¹Ù…Ø¯Ø© (B-H)\nâ€¢ Ø£Ùˆ ÙˆØ¶Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„');
    return;
    }

    importedData = [];
    const preview = document.getElementById('importPreview');

    // Determine starting row for data processing
    const startRow = useFixedColumns ? dataStartRow : 1;

    let previewHTML = `<h4 style="color: #8e44ad; margin-top: 0;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© (${jsonData.length - startRow} Ø³Ø¬Ù„):</h4>
    <p style="color: #666; margin-bottom: 15px;">âœ… ${useFixedColumns ? 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© (B-H)' : 'ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹'}</p>
    <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
    <thead>
    <tr style="background: #8e44ad; color: white;">
    <th style="padding: 8px; border: 1px solid #ddd;">#</th>
    <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„ÙƒÙˆØ¯</th>
    <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„Ø§Ø³Ù…</th>
    <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th>
    <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„Ù‡Ø§ØªÙ</th>
    <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„Ø´Ø§Ø³ÙŠÙ‡</th>
    <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„Ù…ÙˆØªÙˆØ±</th>
    <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
    </tr>
    </thead>
    <tbody>`;

    for (let i = startRow; i < jsonData.length; i++) {
    const row = jsonData[i];
    if (!row || row.length === 0) continue;

    // Skip empty rows (check if any cell has data)
    const hasData = row.some(cell => cell !== null && cell !== undefined && String(cell).trim() !== '');
    if (!hasData) continue;

    // Skip if no owner or national ID
    if (!row[columnMap.owner] || !row[columnMap.nationalId]) continue;

    const record = {
    owner: String(row[columnMap.owner] || '').trim(),
    nationalId: String(row[columnMap.nationalId] || '').replace(/[^0-9]/g, ''),
    phone: String(row[columnMap.phone] || '').replace(/[^0-9]/g, ''),
    vType: row[columnMap.vType] || 'ØªÙˆÙƒØªÙˆÙƒ',
    vYear: row[columnMap.vYear] || new Date().getFullYear(),
    vColor: row[columnMap.vColor] || '',
    address: row[columnMap.address] || '',
    vCode: row[columnMap.vCode] ? String(row[columnMap.vCode]).trim() : '',
    chassisNumber: row[columnMap.chassisNumber] ? String(row[columnMap.chassisNumber]).trim() : '',
    motorNumber: row[columnMap.motorNumber] ? String(row[columnMap.motorNumber]).trim() : ''
    };

    // Validation (more lenient like import_excel.html)
    const isValid = record.owner.length >= 3 && record.nationalId.length >= 10 && (!record.phone || record.phone.length === 11);
    importedData.push(record);

    const rowNumber = i - startRow + 1; // Calculate correct row number
    previewHTML += `<tr style="background: ${isValid ? 'rgba(39, 174, 96, 0.1)' : 'rgba(231, 76, 60, 0.1)'};">
    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${rowNumber}</td>
    <td style="padding: 6px; border: 1px solid #ddd; font-weight: bold; color: ${record.vCode ? '#3498db' : '#999'};">${record.vCode || '-'}</td>
    <td style="padding: 6px; border: 1px solid #ddd;">${record.owner}</td>
    <td style="padding: 6px; border: 1px solid #ddd; font-family: monospace; font-size: 0.85rem;">${record.nationalId}</td>
    <td style="padding: 6px; border: 1px solid #ddd; font-family: monospace;">${record.phone || '-'}</td>
    <td style="padding: 6px; border: 1px solid #ddd; font-family: monospace; font-size: 0.8rem; color: ${record.chassisNumber ? '#27ae60' : '#999'};">${record.chassisNumber || '-'}</td>
    <td style="padding: 6px; border: 1px solid #ddd; font-family: monospace; font-size: 0.8rem; color: ${record.motorNumber ? '#27ae60' : '#999'};">${record.motorNumber || '-'}</td>
    <td style="padding: 6px; border: 1px solid #ddd; font-weight: bold; color: ${isValid ? 'var(--secondary)' : 'var(--danger)'};">${isValid ? 'âœ…' : 'âŒ'}</td>
    </tr>`;
    }

    previewHTML += '</tbody></table>';
    preview.innerHTML = previewHTML;
    preview.style.display = 'block';

    alert(`âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© ${importedData.length} Ø³Ø¬Ù„ Ù…Ù† Ø§Ù„Ù…Ù„Ù\n${useFixedColumns ? 'ğŸ“ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© (B-H)' : 'ğŸ§  ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹'}`);
    } catch (error) {
    alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
    console.error(error);
    }
    };
    reader.readAsArrayBuffer(file);
    };

    // Confirm Import
    document.getElementById('confirmImportBtn').onclick = async () => {
    if (importedData.length === 0) {
    alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
    return;
    }

    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedData.length} Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ\n\nâš ï¸ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø· (Ù„Ù† ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©)`)) {
    return;
    }
    document.getElementById('loadingSpinner').style.display = 'block';
    document.getElementById('importProgress').style.display = 'block';
    document.getElementById('confirmImportBtn').disabled = true;

    let successCount = 0;
    let errorCount = 0;
    let duplicateCount = 0;
    const errors = [];

    // Helper function to update progress
    const updateProgress = (current, total, status) => {
    const percent = Math.round((current / total) * 100); 
    document.getElementById('progressBar').style.width = percent + '%'; 
    document.getElementById('progressText').textContent = percent + '%'; 
    document.getElementById('progressStatus').textContent = status;
    };

    try {
    // Load existing data from Supabase (with pagination for accurate duplicate check)
    updateProgress(0, 100, 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    console.log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±...');

    let existingOrders = [];
    let from = 0;
    const loadBatchSize = 1000;
    let hasMore = true;

    while (hasMore) {
    const { data: batch, error } = await window.supabaseClient
    .from('orders')
    .select('national_id')
    .not('national_id', 'is', null)
    .range(from, from + loadBatchSize - 1);

    if (error) throw error;

    if (batch && batch.length > 0) {
    existingOrders = existingOrders.concat(batch);
    from += loadBatchSize;
    hasMore = batch.length === loadBatchSize;
    } else {
    hasMore = false;
    }
    }

    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${existingOrders.length} Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);

    // Create a Set of existing national IDs for fast lookup
    const existingNIDs = new Set(existingOrders.map(o => o.national_id));
    console.log(`ğŸ” Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©: ${existingNIDs.size}`);

    updateProgress(10, 100, 'â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    const codeInfo = await getSmartNextCode();
    let nextCode = codeInfo.next;

    // Process all records
    const recordsToAdd = [];
    const totalRecords = importedData.length;

    for (let i = 0; i < totalRecords; i++) {
    const record = importedData[i];

    // Update progress every 10 records
    if (i % 10 === 0) {
    const progress = 10 + Math.round((i / totalRecords) * 40); // 10-50%
    updateProgress(progress, 100, `â³ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø¬Ù„ ${i + 1} Ù…Ù† ${totalRecords}...`);
    }

    // More lenient validation (like import_excel.html)
    if (!record.owner || record.owner.length < 3) {
    errorCount++;
    errors.push(`Ø§Ù„Ø³Ø¬Ù„ ${i + 1}: Ø§Ø³Ù… ØºÙŠØ± ØµØ­ÙŠØ­`);
    continue;
    }

    if (!record.nationalId || record.nationalId.length < 10) {
    errorCount++;
    errors.push(`Ø§Ù„Ø³Ø¬Ù„ ${i + 1}: Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­`);
    continue;
    }

    // Check duplicate in localStorage (much faster)
    if (existingNIDs.has(record.nationalId)) {
    duplicateCount++;
    continue;
    }

    // Only use code if it exists in Excel, don't auto-generate
    const finalCode = record.vCode || null;

    const refNumber = 'KS-IMP-' + Date.now().toString().slice(-8) + '-' + i;

    const newRecord = {
    owner: record.owner,
    nationalId: record.nationalId,
    phone: record.phone || '',
    vType: record.vType,
    vYear: record.vYear,
    vColor: record.vColor || '',
    vDesc: `Ù…ÙˆØ¯ÙŠÙ„ ${record.vYear}${record.vColor ? ' - Ù„ÙˆÙ† ' + record.vColor : ''}`,
    address: record.address || '',
    chassisNumber: record.chassisNumber || '',
    motorNumber: record.motorNumber || '',
    images: [],
    timestamp: Date.now(),
    codedAt: record.vCode ? Date.now() : null,
    vCode: finalCode,
    refNumber: refNumber,
    importedBy: 'admin',
    importedAt: Date.now(),
    status: record.vCode ? "coded" : "pending",
    statusHistory: [{
    status: record.vCode ? "coded" : "pending",
    timestamp: Date.now(),
    note: record.vCode ? `Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø¹ ÙƒÙˆØ¯: ${finalCode}` : "Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel - Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙƒÙˆÙŠØ¯",
    by: userRole
    }]
    };

    recordsToAdd.push(newRecord);
    existingNIDs.add(record.nationalId); // Add to set to prevent duplicates within import
    successCount++;
    }

    // Save to Supabase first (primary storage)
    updateProgress(50, 100, 'â˜ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    console.log('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    const batchSize = 50; // Supabase batchis 500, we use 50 for safety
    for (let i = 0; i < recordsToAdd.length; i += batchSize) {
    const batch = recordsToAdd.slice(i, i + batchSize);

    // Update progress
    const progress = 60 + Math.round((i / recordsToAdd.length) * 35); // 60-95%
    updateProgress(progress, 100, `â˜ï¸ Ø­ÙØ¸ ${Math.min(i + batchSize, recordsToAdd.length)} Ù…Ù† ${recordsToAdd.length} ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...`);

    // Save batch to Supabase in parallel (much faster!)
    const savePromises = batch.map(async (record) => {
    try {
    const { error } = await window.supabaseClient
    .from('orders')
    .insert([{
    owner_name: record.owner,
    national_id: record.nationalId,
    phone: record.phone,
    vehicle_type: record.vType,
    vehicle_year: record.vYear,
    address: record.address,
    chassis_number: record.chassisNumber,
    motor_number: record.motorNumber,
    images: record.images || [],
    submitted_at: record.timestamp, // âœ… REQUIRED FIELD
    ref_number: record.refNumber,
    status: record.status,
    code: record.vCode || null
    }]);
    if (error) throw error;
    return true;
    } catch (e) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„:', {
    message: e.message,
    details: e.details,
    hint: e.hint,
    code: e.code,
    fullError: e,
    recordData: {
    owner_name: record.owner,
    national_id: record.nationalId,
    phone: record.phone,
    vehicle_type: record.vType,
    vehicle_year: record.vYear
    }
    });
    errorCount++;
    errors.push(`Ø®Ø·Ø£: ${e.message || e.toString()}`);
    return null;
    }
    });
    await Promise.all(savePromises);

    console.log(`âœ… ØªÙ… Ø­ÙØ¸ ${Math.min(i + batchSize, recordsToAdd.length)} Ù…Ù† ${recordsToAdd.length} ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª`);
    }

    // Update LocalStorage cache after successful Supabase save
    updateProgress(95, 100, 'ğŸ’¾ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©...');
    await loadAdminData(); // Reload from Supabase to update LocalStorage

    updateProgress(100, 100, 'âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯!');
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('importProgress').style.display = 'none';
    document.getElementById('bulkImportModal').style.display = 'none';

    let resultMsg = `âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯!\n\nğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:\nâœ… Ù†Ø¬Ø­: ${successCount} Ø³Ø¬Ù„\nâš ï¸ Ù…ÙƒØ±Ø± (ØªÙ… ØªØ®Ø·ÙŠÙ‡): ${duplicateCount} Ø³Ø¬Ù„\nâŒ ÙØ´Ù„: ${errorCount} Ø³Ø¬Ù„\n\nğŸ“ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${importedData.length}\n\nâ˜ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${successCount} Ø³Ø¬Ù„\nğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: ${successCount} Ø³Ø¬Ù„`;
    if (errors.length > 0 && errors.length <= 5) {
    resultMsg += '\n\nâŒ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:\n' + errors.slice(0, 5).join('\n');
    if (errors.length > 5) {
    resultMsg += `\n... Ùˆ ${errors.length - 5} Ø£Ø®Ø·Ø§Ø¡ Ø£Ø®Ø±Ù‰`;
    }
    }
    alert(resultMsg);

    } catch (error) {
    document.getElementById('loadingSpinner').style.display = 'none';
    document.getElementById('importProgress').style.display = 'none';
    document.getElementById('confirmImportBtn').disabled = false;
    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: ' + error.message);
    console.error('Import error:', error);
    }
    };

    // On page load - check for existing admin session
    (function() {
    const savedAuth = sessionStorage.getItem('adminAuth');
    const savedRole = sessionStorage.getItem('adminRole');
    const savedUsername = sessionStorage.getItem('adminUsername');

    if (savedAuth === 'true' && savedRole && savedUsername) {
    // Auto-restore admin session
    userRole = savedRole;
    currentUsername = savedUsername; 
    document.getElementById('portalSection').style.display = 'none'; 
    document.getElementById('adminPage').style.display = 'block'; 
    document.getElementById('goPortalBtn').style.display = 'inline-flex'; 
    document.getElementById('logoutBtn').style.display = 'inline-flex'; 
    document.getElementById('loginBtn').style.display = 'none';

    // Restore badge
    const header = document.querySelector('header');
    const roleBadge = userRole === 'SUPER' ? 'ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…' : userRole === 'ADMIN' ? 'ğŸ”§ Ù…Ø´Ø±Ù' : 'ğŸ‘ï¸ Ø¹Ø±Ø¶ ÙÙ‚Ø·';
    const roleColor = userRole === 'SUPER' ? '#e74c3c' : userRole === 'ADMIN' ? '#3498db' : '#95a5a6';
    const badge = document.createElement('div');
    badge.id = 'roleBadge';
    badge.style.cssText = `background: ${roleColor}; color: white; padding: 8px 20px; border-radius: 12px; font-weight: bold; font-size: 0.9rem;`;
    badge.innerText = roleBadge;
    header.appendChild(badge);

    console.log(`âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„: ${currentUsername} (${userRole})`);
    }
    })();

    // ============================================
    // PAGINATION SYSTEM
    // ============================================
    let currentPage = 1;
    let recordsPerPage = 100;
    let allOrdersData = [];
    let filteredOrdersData = [];

    window.searchOrders = function() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    const searchType = document.getElementById('searchType') ?document.getElementById('searchType').value : 'all';

    if (!searchTerm) {
    filteredOrdersData = allOrdersData;
    } else {
    filteredOrdersData = allOrdersData.filter(orderData => {
    const item = orderData.item;

    if (searchType === 'all') {
    return (
    (item.owner && item.owner.toLowerCase().includes(searchTerm)) ||
    (item.name && item.name.toLowerCase().includes(searchTerm)) ||
    (item.vCode && item.vCode.toString().toLowerCase().includes(searchTerm)) ||
    (item.nationalId && item.nationalId.toLowerCase().includes(searchTerm)) ||
    (item.phone && item.phone.includes(searchTerm)) ||
    (item.refNumber && item.refNumber.toLowerCase().includes(searchTerm)) ||
    (item.address && item.address.toLowerCase().includes(searchTerm)) ||
    (item.chassisNumber && item.chassisNumber.toLowerCase().includes(searchTerm)) ||
    (item.motorNumber && item.motorNumber.toLowerCase().includes(searchTerm))
    );
    } else if (searchType === 'name') {
    return (item.owner && item.owner.toLowerCase().includes(searchTerm)) || (item.name && item.name.toLowerCase().includes(searchTerm));
    } else if (searchType === 'code') {
    return item.vCode && item.vCode.toString().toLowerCase().includes(searchTerm);
    } else if (searchType === 'nationalId') {
    return item.nationalId && item.nationalId.includes(searchTerm);
    } else if (searchType === 'phone') {
    return item.phone && item.phone.includes(searchTerm);
    } else if (searchType === 'chassis') {
    return item.chassisNumber && item.chassisNumber.toLowerCase().includes(searchTerm);
    } else if (searchType === 'motor') {
    return item.motorNumber && item.motorNumber.toLowerCase().includes(searchTerm);
    }
    return false;
    });
    }
    currentPage = 1;
    renderCurrentPage();
    const resultMsg = filteredOrdersData.length === allOrdersData.length ? 
    `ğŸ” Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${allOrdersData.length}` : 
    `ğŸ” Ø§Ù„Ø¨Ø­Ø« (${searchType}) Ø¹Ù†: "${searchTerm}" - Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${filteredOrdersData.length} Ù…Ù† ${allOrdersData.length}`;
    console.log(resultMsg);
    };

    window.changePage = function(direction) {
    const totalPages = Math.ceil(filteredOrdersData.length / recordsPerPage) || 1;
    currentPage += direction;
    if (currentPage < 1) currentPage = 1;
    if (currentPage > totalPages) currentPage = totalPages;
    renderCurrentPage();
    };

    window.changeRecordsPerPage = function() {
    recordsPerPage = parseInt(document.getElementById('recordsPerPage').value);
    currentPage = 1;
    renderCurrentPage();
    };

    function renderCurrentPage() {
    const startIndex = (currentPage - 1) * recordsPerPage;
    const endIndex = startIndex + recordsPerPage;
    const pageData = filteredOrdersData.slice(startIndex, endIndex);
    const totalPages = Math.ceil(filteredOrdersData.length / recordsPerPage) || 1; 
    document.getElementById('pageInfo').textContent = `ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}`; 
    document.getElementById('totalRecordsInfo').textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${filteredOrdersData.length} Ø³Ø¬Ù„`;

    const tableBody = document.getElementById('dataTable');
    tableBody.innerHTML = '';

    pageData.forEach(orderData => {
    const tr = orderData.element;
    tableBody.appendChild(tr);
    });

    const actualEnd = Math.min(endIndex, filteredOrdersData.length);
    console.log(`ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© ${currentPage}/${totalPages}: Ø§Ù„Ø³Ø¬Ù„Ø§Øª ${startIndex + 1}-${actualEnd} Ù…Ù† ${filteredOrdersData.length}`);
    }

    function initializePagination(ordersArray) {
    allOrdersData = ordersArray;
    filteredOrdersData = ordersArray;
    currentPage = 1;
    renderCurrentPage();
    }

    console.log('âœ… Ù†Ø¸Ø§Ù… Pagination Ø¬Ø§Ù‡Ø²');

    </script>

    </body>
    </html>
