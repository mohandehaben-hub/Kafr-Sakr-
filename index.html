<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منظومة تكويد المركبات - كفر صقر</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --primary: #1a5276; 
            --secondary: #27ae60; 
            --accent: #d35400; 
            --danger: #e74c3c;
            --bg: #f4f7f9; 
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border: #e0e6ed;
            --shadow: 0 10px 25px rgba(0,0,0,0.05);
            --shadow-hover: 0 15px 35px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            direction: rtl; 
            color: var(--text-dark);
            line-height: 1.6;
            padding-bottom: 90px;
        }
        
        header { 
            background: linear-gradient(135deg, var(--primary), #2c3e50); 
            color: white; 
            padding: 20px 5%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: var(--shadow); 
            border-bottom: 4px solid var(--accent);
            flex-wrap: wrap;
        }

        .header-title h1 { 
            margin: 0; 
            font-size: clamp(1.2rem, 4vw, 1.8rem); 
            font-weight: 800; 
            letter-spacing: -0.5px;
        }

        .header-title p { 
            margin: 2px 0 0; 
            font-size: clamp(0.8rem, 2vw, 0.95rem); 
            color: #f1c40f; 
            font-weight: 600;
        }

        .container { 
            max-width: 1200px; 
            margin: 30px auto; 
            padding: 0 20px; 
        }

        .card { 
            background: white; 
            padding: 40px; 
            border-radius: 20px; 
            box-shadow: var(--shadow); 
            transition: box-shadow 0.3s;
        }

        .card:hover { box-shadow: var(--shadow-hover); }

        .page-title { 
            text-align: center; 
            color: var(--primary); 
            margin-bottom: 30px; 
            font-size: 1.6rem;
            position: relative;
            padding-bottom: 10px;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, var(--secondary), var(--accent));
            border-radius: 2px;
        }

        .form-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 25px; 
        }

        .full-row { grid-column: 1 / -1; }

        .input-group { display: flex; flex-direction: column; }

        .input-group label { 
            margin-bottom: 10px; 
            font-weight: 700; 
            color: var(--text-dark); 
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group input, .input-group select { 
            padding: 15px 18px; 
            border: 2px solid var(--border); 
            border-radius: 12px; 
            background: #fff; 
            font-size: 1rem;
            transition: all 0.3s;
            outline: none;
        }

        .input-group input:focus, .input-group select:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 10px rgba(26, 82, 118, 0.15);
        }

        .input-group input[type="file"] {
            border: 2px dashed var(--border);
            background: #fafafa;
            cursor: pointer;
            text-align: center;
            padding: 25px;
        }

        .input-group input[type="file"]:hover {
            border-color: var(--secondary);
            background: #f0f8f0;
        }

        #submitBtn { 
            width: 100%; 
            background: linear-gradient(135deg, var(--secondary), #2ecc71); 
            color: white; 
            padding: 18px; 
            border: none; 
            border-radius: 12px; 
            font-size: 1.2rem; 
            font-weight: 800; 
            margin-top: 30px; 
            cursor: pointer; 
            transition: all 0.3s; 
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #submitBtn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4); 
        }

        #submitBtn:disabled { 
            background: var(--text-light); 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }

        .admin-content { 
            display: none; 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: var(--shadow); 
            width: 95%; 
            margin: 20px auto; 
        }

        .admin-header {
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .admin-header h2 { 
            margin: 0; 
            color: var(--primary); 
            font-size: 1.5rem;
        }

        .admin-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .admin-controls input {
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 0.95rem;
            min-width: 250px;
        }

        .admin-controls button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-controls button:hover { background: #229954; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .data-table th, .data-table td {
            padding: 15px 10px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background: var(--primary);
            color: white;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover { background: #f8f9fa; }

        .data-table button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.3s;
            margin: 2px;
        }

        .view-btn { background: #3498db; color: white; }
        .view-btn:hover { background: #2980b9; }

        .code-btn { background: var(--secondary); color: white; }
        .code-btn:hover { background: #229954; }

        .del-btn { background: var(--danger); color: white; }
        .del-btn:hover { background: #c0392b; }

        .engineer-footer {
            background: #1c2833; 
            color: #d5dbdb; 
            text-align: center; 
            padding: 15px;
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            font-size: 0.85rem; 
            z-index: 1000;
            border-top: 3px solid var(--accent);
        }

        .engineer-footer b { color: #f1c40f; font-size: 0.95rem; }

        .modal { 
            display: none; 
            position: fixed; 
            z-index: 10000; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            text-align: center; 
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-main-img { 
            max-width: 90%; 
            max-height: 75vh; 
            margin-top: 30px; 
            border-radius: 15px; 
            border: 4px solid #fff; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #modalThumbnails {
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            padding: 15px; 
            overflow-x: auto;
            max-width: 90%;
            margin: 0 auto;
        }

        #modalThumbnails img {
            width: 70px; 
            height: 70px; 
            cursor: pointer; 
            border-radius: 8px; 
            transition: 0.3s;
            border: 2px solid transparent;
        }

        #modalThumbnails img:hover { 
            border-color: var(--accent); 
            transform: scale(1.1); 
        }

        #closeModalBtn {
            position: absolute; 
            top: 20px; 
            right: 30px; 
            color: white; 
            font-size: 40px; 
            cursor: pointer; 
            transition: 0.3s;
        }

        #closeModalBtn:hover { color: var(--accent); }

        @media (max-width: 768px) {
            header { justify-content: center; text-align: center; gap: 10px; }
            .container { margin: 15px auto; }
            .card { padding: 25px; }
            .form-grid { grid-template-columns: 1fr; }
            .admin-controls { flex-direction: column; align-items: stretch; }
            .admin-controls input { min-width: auto; }
            .data-table { font-size: 0.8rem; }
            .data-table th, .data-table td { padding: 10px 5px; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-title">
        <h1>رئاسة مركز ومدينة كفر صقر</h1>
        <p>مع تحياتي رئيس مجلس المدينة د/ أحمد المقدم</p>
    </div>
    <div id="adminBtnArea">
        <button id="loginBtn" style="background:rgba(255,255,255,0.15); color:white; padding:10px 18px; border:1px solid white; border-radius:8px; cursor:pointer; font-weight:600; font-size: 14px; transition:0.3s;"><i class="fas fa-lock"></i> لوحة التحكم</button>
    </div>
</header>

<div class="container" id="citizenPage">
    <div class="card">
        <h2 class="page-title"><i class="fas fa-car"></i> تسجيل بيانات المركبة</h2>
        <div class="form-grid">
            <div class="input-group full-row">
                <label><i class="fas fa-user"></i> الاسم الرباعي للمالك</label>
                <input type="text" id="ownerName" placeholder="كما هو مدون في بطاقة الرقم القومي" required>
            </div>
            <div class="input-group">
                <label><i class="fas fa-id-card"></i> الرقم القومي (14 رقم)</label>
                <input type="number" id="nationalId" placeholder="أدخل الـ 14 رقماً" required>
            </div>
            <div class="input-group">
                <label><i class="fas fa-phone"></i> رقم الهاتف المحمول</label>
                <input type="tel" id="phone" placeholder="01xxxxxxxxx" required>
            </div>
            <div class="input-group">
                <label><i class="fas fa-motorcycle"></i> نوع المركبة</label>
                <select id="vType" required>
                    <option value="توكتوك">توكتوك</option>
                    <option value="موتوسيكل">موتوسيكل</option>
                    <option value="تروسيكل">تروسيكل</option>
                </select>
            </div>
            <div class="input-group">
                <label><i class="fas fa-palette"></i> الموديل / اللون</label>
                <input type="text" id="vDesc" placeholder="مثال: بجاج 2024 - أحمر" required>
            </div>
            <div class="input-group full-row">
                <label><i class="fas fa-map-marker-alt"></i> العنوان السكني الحالي</label>
                <input type="text" id="address" placeholder="المدينة / القرية / الشارع" required>
            </div>
            <div class="input-group full-row">
                <label><i class="fas fa-images"></i> صور المركبة والمستندات</label>
                <input type="file" id="multiFiles" accept="image/*" multiple required>
            </div>
        </div>
        <button id="submitBtn"><i class="fas fa-check"></i> تأكيد البيانات وحفظ الطلب</button>
    </div>
</div>

<div id="adminPage" class="admin-content">
    <div class="admin-header">
        <h2><i class="fas fa-tasks"></i> مراجعة الطلبات</h2>
        <button onclick="location.reload()" style="background:var(--danger); color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; transition:0.3s;"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
    </div>
    <div class="admin-controls">
        <input type="text" id="searchInput" placeholder="ابحث باسم المالك أو الرقم القومي...">
        <button id="exportExcelBtn"><i class="fas fa-file-excel"></i> تصدير Excel</button>
    </div>
    <div style="overflow-x: auto;">
        <table class="data-table" id="excelTable">
            <thead>
                <tr>
                    <th>المالك</th>
                    <th>القومي</th>
                    <th>الهاتف</th>
                    <th>العنوان</th>
                    <th>النوع</th>
                    <th>الكود</th>
                    <th>تاريخ الطلب</th>
                    <th>تاريخ الموافقة</th>
                    <th>الصور</th>
                    <th>الإجراء</th>
                </tr>
            </thead>
            <tbody id="dataTable"></tbody>
        </table>
    </div>
</div>

<div id="imgModal" class="modal">
    <span id="closeModalBtn">&times;</span>
    <img id="mainViewImg" class="modal-main-img">
    <div id="modalThumbnails"></div>
</div>

<footer class="engineer-footer">
    تم التطوير بواسطة <b>المهندس مهند إيهاب التهامي</b><br>
    خبير هندسة البرمجيات والمتخصص في تطوير الأنظمة الأمنية المتقدمة
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc, getDocs, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC0GsXy-mODZ_O2uqFJMKsjmK9bNDbrU9U",
        authDomain: "system-storage-bd0ed.firebaseapp.com",
        projectId: "system-storage-bd0ed",
        storageBucket: "system-storage-bd0ed.firebasestorage.app",
        messagingSenderId: "501351821676",
        app
