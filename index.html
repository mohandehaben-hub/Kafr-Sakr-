<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†Ø¸ÙˆÙ…Ø© ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© - ÙƒÙØ± ØµÙ‚Ø±</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root { 
--primary: #1a5276; --secondary: #27ae60; --accent: #d35400; --danger: #e74c3c;
--warning: #f39c12; --info: #3498db; --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
--glass-white: rgba(255, 255, 255, 0.85); --glass-border: rgba(255, 255, 255, 0.5);
--text-dark: #2c3e50; --shadow-lg: 0 20px 60px rgba(0,0,0,0.3);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
background: var(--bg-gradient); background-attachment: fixed;
direction: rtl; color: var(--text-dark); padding-bottom: 100px; min-height: 100vh;
}
header { 
background: rgba(26, 82, 118, 0.95); backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px); color: white; padding: 20px 5%; 
display: flex; justify-content: space-between; align-items: center; 
box-shadow: var(--shadow-lg); border-bottom: 3px solid rgba(255, 255, 255, 0.3);
position: sticky; top: 0; z-index: 1000; animation: slideDown 0.5s ease;
}
@keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
@keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
.header-title h1 { margin: 0; font-size: 1.4rem; text-shadow: 0 3px 6px rgba(0,0,0,0.3); }
.header-title small { color: #f1c40f; font-size: 0.85rem; display: block; margin-top: 5px; }
.container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
.card { 
background: var(--glass-white); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
padding: 40px; border-radius: 30px; border: 2px solid var(--glass-border);
box-shadow: var(--shadow-lg); animation: fadeIn 0.6s ease; margin-bottom: 30px; margin-top: 20px;
}
.portal-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 35px; margin-top: 50px; }
.portal-box {
background: var(--glass-white); backdrop-filter: blur(20px); padding: 60px 35px;
border-radius: 35px; text-align: center; cursor: pointer; border: 3px solid transparent;
transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
box-shadow: 0 15px 40px rgba(0,0,0,0.15); position: relative; overflow: hidden;
}
.portal-box::before {
content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
transform: scale(0); transition: transform 0.6s ease;
}
.portal-box:hover::before { transform: scale(1); }
.portal-box:hover { transform: translateY(-10px) scale(1.03); border-color: var(--primary);
background: white; box-shadow: 0 25px 60px rgba(26, 82, 118, 0.3); }
.portal-box i { font-size: 90px; display: block; margin-bottom: 25px; animation: pulse 2s infinite; }
.portal-box h2 { color: var(--primary); margin: 15px 0; font-size: 1.5rem; }
.portal-box p { color: #666; font-size: 1rem; line-height: 1.6; }
.search-results { 
max-height: 250px; overflow-y: auto; background: white; border: 2px solid var(--glass-border); 
border-radius: 15px; display: none; position: absolute; width: 100%; z-index: 999;
box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-top: 5px;
}
.result-item { padding: 15px; cursor: pointer; border-bottom: 1px solid #eee; 
transition: all 0.3s; color: #333; font-weight: 500; }
.result-item:hover { background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%); 
color: white; padding-right: 25px; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
gap: 25px; margin-bottom: 35px; margin-top: 20px; }
.stat-card { 
background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.6) 100%); 
backdrop-filter: blur(10px); padding: 30px; border-radius: 25px; text-align: center; 
border: 2px solid var(--glass-border); box-shadow: 0 8px 25px rgba(0,0,0,0.1);
transition: all 0.4s ease; position: relative; overflow: hidden;
}
.stat-card::before {
content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
}
.stat-card:hover { transform: translateY(-10px) rotate(2deg); box-shadow: 0 15px 40px rgba(0,0,0,0.2); }
.stat-card h3 { margin: 15px 0; font-size: 2.5rem; background: linear-gradient(45deg, var(--primary), var(--info));
background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; }
.stat-card p { margin: 0; color: #555; font-size: 1rem; font-weight: 600; text-transform: uppercase; }
.form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
.input-group { display: flex; flex-direction: column; margin-bottom: 20px; position: relative; }
.input-group label { margin-bottom: 12px; font-weight: 700; color: var(--primary); font-size: 1rem;
display: flex; align-items: center; gap: 8px; }
.input-group label::before { content: 'â—'; color: var(--accent); font-size: 0.8rem; }
.input-group input, .input-group select, .input-group textarea { 
padding: 16px; border: 2px solid var(--glass-border); border-radius: 15px; 
background: rgba(255, 255, 255, 0.95); font-size: 1.05rem; transition: all 0.3s;
font-family: inherit; font-weight: 500;
}
.input-group input:focus, .input-group select:focus, .input-group textarea:focus { 
outline: none; border-color: var(--primary); 
box-shadow: 0 0 0 5px rgba(26, 82, 118, 0.15); transform: translateY(-2px); 
}
.input-group input.error { border-color: var(--danger); animation: shake 0.5s; }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 
75% { transform: translateX(10px); } }
.validation-msg { font-size: 0.85rem; margin-top: 8px; padding: 8px 12px; border-radius: 8px;
display: none; font-weight: 600; }
.validation-msg.error { background: rgba(231, 76, 60, 0.1); color: var(--danger); display: block; }
.validation-msg.success { background: rgba(39, 174, 96, 0.1); color: var(--secondary); display: block; }
table { width: 100%; border-collapse: separate; border-spacing: 0 10px; background: transparent; }
thead { position: sticky; top: 0; z-index: 100; background: white; }
th { background: linear-gradient(135deg, rgba(26, 82, 118, 0.95) 0%, rgba(52, 152, 219, 0.95) 100%); 
color: white; padding: 20px; font-size: 1rem; font-weight: 700; text-transform: uppercase;
box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
th:first-child { border-radius: 0 20px 20px 0; }
th:last-child { border-radius: 20px 0 0 20px; }
td { padding: 18px; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(8px); 
border-top: 2px solid var(--glass-border); border-bottom: 2px solid var(--glass-border);
font-weight: 500; transition: all 0.3s; }
tr:hover td { background: rgba(255, 255, 255, 0.98); transform: scale(1.01); }
td:first-child { border-right: 2px solid var(--glass-border); border-radius: 0 20px 20px 0; }
td:last-child { border-left: 2px solid var(--glass-border); border-radius: 20px 0 0 20px; }
.btn { 
cursor: pointer; border: none; padding: 14px 24px; border-radius: 16px; font-weight: 700; 
transition: all 0.4s ease; display: inline-flex; align-items: center; justify-content: center; 
gap: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.15); font-size: 1rem;
position: relative; overflow: hidden; text-transform: uppercase; letter-spacing: 0.5px;
}
.btn::before {
content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0;
background: rgba(255,255,255,0.3); border-radius: 50%; transition: width 0.6s, height 0.6s;
transform: translate(-50%, -50%);
}
.btn:hover::before { width: 300px; height: 300px; }
.btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
.btn:active { transform: translateY(-1px); }
.btn-primary { background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white; }
.btn-auto { background: linear-gradient(135deg, var(--info) 0%, #2874a6 100%); color: white; }
.btn-edit { background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%); color: white; }
.btn-del { background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); color: white; }
.btn-wa { background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); color: white; }
.btn-print { background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; }
.admin-content { display: none; padding: 30px 0; }
.modal { 
display: none; position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; 
background: rgba(0,0,0,0.75); backdrop-filter: blur(15px); overflow-y: auto; 
animation: fadeIn 0.3s ease;
}
.modal-content { 
background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%); 
margin: 3% auto; padding: 45px; width: 92%; max-width: 750px; border-radius: 35px; 
border: 3px solid var(--glass-border); box-shadow: 0 30px 80px rgba(0,0,0,0.4);
position: relative; animation: slideDown 0.5s ease;
}
.modal-content h3 { color: var(--primary); border-bottom: 3px solid var(--glass-border); 
padding-bottom: 20px; margin-top: 0; font-size: 1.8rem; }
.close-modal { position: absolute; top: 20px; left: 25px; color: var(--danger); 
font-size: 45px; cursor: pointer; transition: all 0.3s; font-weight: bold; }
.close-modal:hover { transform: rotate(90deg) scale(1.2); color: #c0392b; }
.engineer-footer { 
background: linear-gradient(135deg, rgba(28, 40, 51, 0.98) 0%, rgba(44, 62, 80, 0.98) 100%); 
backdrop-filter: blur(15px); color: #ecf0f1; text-align: center; padding: 18px; 
position: fixed; bottom: 0; width: 100%; font-size: 0.95rem; 
border-top: 4px solid var(--accent); z-index: 999; box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
font-weight: 600; letter-spacing: 0.5px;
}
.support-box { 
background: linear-gradient(135deg, rgba(52, 152, 219, 0.12) 0%, rgba(155, 89, 182, 0.12) 100%); 
border: 3px dashed rgba(52, 152, 219, 0.5); border-radius: 25px; padding: 30px; 
margin-top: 35px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}
.support-box p { margin-top: 0; font-weight: 700; color: var(--primary); font-size: 1.2rem; 
margin-bottom: 20px; }
.loading { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
z-index: 20000; }
.spinner { border: 8px solid rgba(255,255,255,0.3); border-top: 8px solid var(--primary);
border-radius: 50%; width: 80px; height: 80px; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@media print { body * { visibility: hidden; } #printSection, #printSection * { visibility: visible; }
#printSection { position: absolute; left: 0; top: 0; width: 100%; } }
@media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } 
.portal-container { grid-template-columns: 1fr; } .header-title h1 { font-size: 1.1rem; } }
.vehicle-card {
background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
backdrop-filter: blur(10px); padding: 30px 20px; border-radius: 20px; text-align: center;
cursor: pointer; border: 3px solid transparent; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
box-shadow: 0 8px 25px rgba(0,0,0,0.1); position: relative; overflow: hidden;
}
.vehicle-card::before {
content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
background: radial-gradient(circle, rgba(26, 82, 118, 0.1) 0%, transparent 70%);
transform: scale(0); transition: transform 0.5s ease;
}
.vehicle-card:hover::before { transform: scale(1); }
.vehicle-card:hover {
transform: translateY(-10px) scale(1.05); border-color: var(--primary);
box-shadow: 0 20px 50px rgba(26, 82, 118, 0.3);
}
.vehicle-card.selected {
border-color: var(--secondary); background: linear-gradient(135deg, rgba(39, 174, 96, 0.15) 0%, rgba(46, 204, 113, 0.15) 100%);
box-shadow: 0 15px 40px rgba(39, 174, 96, 0.4); transform: scale(1.05);
}
.vehicle-card.selected::after {
content: 'âœ“'; position: absolute; top: 10px; right: 10px; width: 35px; height: 35px;
background: var(--secondary); color: white; border-radius: 50%; display: flex;
align-items: center; justify-content: center; font-size: 1.3rem; font-weight: bold;
box-shadow: 0 4px 15px rgba(39, 174, 96, 0.5);
}
#phoneNotification {
position: fixed; top: -200px; left: 50%; transform: translateX(-50%);
background: linear-gradient(135deg, rgba(52, 152, 219, 0.98) 0%, rgba(41, 128, 185, 0.98) 100%);
backdrop-filter: blur(20px); padding: 25px 35px; border-radius: 20px;
box-shadow: 0 15px 50px rgba(0,0,0,0.3); z-index: 10000; min-width: 400px;
border: 3px solid rgba(255, 255, 255, 0.3); transition: top 0.5s ease;
}
#phoneNotification.show { top: 100px; }
@media (max-width: 768px) { #phoneNotification { min-width: 90%; } }
</style>
</head>
<body>
<div class="loading" id="loadingSpinner"><div class="spinner"></div></div>

<div id="phoneNotification">
<div style="display: flex; align-items: center; gap: 20px;">
<div style="font-size: 50px;">ğŸ“±</div>
<div style="flex: 1;">
<h3 style="color: white; margin: 0 0 10px 0; font-size: 1.3rem;">Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙ„Ù‚ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØªØ­Ø¯ÙŠØ«Ø§ØªØŸ</h3>
<p style="color: rgba(255,255,255,0.9); margin: 0 0 15px 0; font-size: 1rem;">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„ØªÙ„Ù‚ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</p>
<div style="display: flex; gap: 10px; align-items: center;">
<input type="tel" id="notificationPhone" placeholder="01XXXXXXXXX" maxlength="11" style="flex: 1; padding: 12px; border-radius: 10px; border: 2px solid white; font-size: 1rem; font-weight: 600;">
<button onclick="submitNotificationPhone()" class="btn" style="background: white; color: var(--info); padding: 12px 25px; font-weight: 700;">Ø¥Ø±Ø³Ø§Ù„</button>
<button onclick="closeNotification()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">ØªØ®Ø·ÙŠ</button>
</div>
</div>
</div>
</div>

<header>
<div class="header-title">
<h1>ğŸ›ï¸ Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±</h1>
<small>Ø¯/ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ù‚Ø¯Ù… - Ø±Ø¦ÙŠØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</small>
</div>
<div style="display:flex; gap:12px; flex-wrap: wrap;">
<button id="goPortalBtn" class="btn" style="background: rgba(255,255,255,0.15); color: white; display:none;" onclick="location.reload()">ğŸ  Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©</button>
<button id="loginBtn" class="btn" style="background: rgba(255,255,255,0.25); color: white; border: 2px solid rgba(255,255,255,0.4);">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
</div>
</header>
<div class="container">
<div id="portalSection">
<h2 style="text-align: center; color: white; margin-top: 50px; margin-bottom: 15px; font-size: 2.5rem; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</h2>
<p style="text-align: center; color: rgba(255,255,255,0.9); margin-bottom: 50px; font-size: 1.2rem; text-shadow: 0 2px 5px rgba(0,0,0,0.2);">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø°ÙŠ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„ÙŠÙ‡</p>
<div class="portal-container">
<div class="portal-box" onclick="openService('citizenPage')">
<i style="font-style: normal; font-size: 85px;">ğŸšœ</i>
<h2>Ù‚Ø³Ù… ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</h2>
<p>ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙƒØªÙˆÙƒ ÙˆØ§Ù„Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„ ÙˆØ§Ù„ØªØ±ÙˆØ³ÙŠÙƒÙ„ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ Ø¨Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø°ÙƒÙŠØ©</p>
</div>
<div class="portal-box" onclick="openService('inquiryPage')" style="border-bottom: 6px solid var(--secondary);">
<i style="font-style: normal; font-size: 85px;">ğŸ”</i>
<h2 style="color: var(--secondary);">Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
<p>ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ ÙˆÙ…Ø¹Ø±ÙØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ù…Ø±ÙƒØ¨ØªÙƒ</p>
</div>
<div class="portal-box" onclick="openService('complaintsModule')" style="border-bottom: 6px solid var(--accent);">
<i style="font-style: normal; font-size: 85px;">âš–ï¸</i>
<h2 style="color: var(--accent);">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø£Ù…Ù†</h2>
<p>ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ù…Ù†ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„</p>
</div>
</div>
</div>
<div id="citizenPage" style="display:none;">
<div class="card">
<div style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.05) 0%, rgba(52, 152, 219, 0.05) 100%); padding: 40px 30px; border-radius: 25px; margin-bottom: 40px; border: 2px solid rgba(26, 82, 118, 0.1);">
<div style="display: flex; justify-content: center; align-items: center; gap: 40px; margin-bottom: 25px; flex-wrap: wrap;">
<div style="text-align: center;">
<img src="https://i.postimg.cc/Hs92TtbL/41jjsn4SHDL-AC-UF894-1000-QL80.jpg" style="width: 90px; height: 90px; object-fit: contain; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); background: white; padding: 10px;">
<p style="margin: 10px 0 0 0; font-size: 0.85rem; color: #666; font-weight: 600;">Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ù…ØµØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
</div>
<div style="text-align: center;">
<div style="width: 3px; height: 80px; background: linear-gradient(180deg, transparent, var(--primary), transparent); margin: 0 20px;"></div>
</div>
<div style="text-align: center;">
<img src="https://i.postimg.cc/brFBgHg7/Flag-of-Sharkiya-Governorate.png" style="width: 90px; height: 90px; object-fit: contain; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); background: white; padding: 10px;">
<p style="margin: 10px 0 0 0; font-size: 0.85rem; color: #666; font-weight: 600;">Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</p>
</div>
</div>
<div style="text-align: center; border-top: 2px solid rgba(26, 82, 118, 0.2); padding-top: 25px;">
<h2 style="color: var(--primary); font-size: 2.2rem; margin: 0 0 10px 0; font-weight: 900; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±</h2>
<p style="color: #666; font-size: 1rem; margin: 5px 0; font-weight: 600;">Ø¯/ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ù‚Ø¯Ù… - Ø±Ø¦ÙŠØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</p>
<h3 style="color: var(--secondary); font-size: 1.6rem; margin: 20px 0 0 0; font-weight: 700;">ğŸ“ Ù…Ù†Ø¸ÙˆÙ…Ø© ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h3>
</div>
</div>

<div id="vehicleTypeSelection" style="margin-bottom: 40px;">
<h3 style="text-align: center; color: var(--primary); margin-bottom: 30px; font-size: 1.4rem;">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</h3>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
<div class="vehicle-card" data-type="ØªÙˆÙƒØªÙˆÙƒ" onclick="selectVehicleType('ØªÙˆÙƒØªÙˆÙƒ')">
<div style="margin-bottom: 10px;"><img src="https://i.postimg.cc/QtgDfPKv/images-(1).jpg" style="width: 100px; height: 80px; object-fit: contain; border-radius: 10px;"></div>
<h4 style="color: var(--primary); margin: 10px 0; font-size: 1.2rem;">ØªÙˆÙƒØªÙˆÙƒ</h4>
<p style="color: #666; font-size: 0.9rem;">Ù…Ø±ÙƒØ¨Ø© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø¹Ø¬Ù„Ø§Øª</p>
</div>
<div class="vehicle-card" data-type="Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„" onclick="selectVehicleType('Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„')">
<div style="margin-bottom: 10px;"><img src="https://i.postimg.cc/zfKYfM7K/hwjn-4-2.jpg" style="width: 100px; height: 80px; object-fit: contain; border-radius: 10px;"></div>
<h4 style="color: var(--primary); margin: 10px 0; font-size: 1.2rem;">Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„</h4>
<p style="color: #666; font-size: 0.9rem;">Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ©</p>
</div>
<div class="vehicle-card" data-type="ØªØ±ÙˆØ³ÙŠÙƒÙ„" onclick="selectVehicleType('ØªØ±ÙˆØ³ÙŠÙƒÙ„')">
<div style="margin-bottom: 10px;"><img src="https://i.postimg.cc/HnSfKCYf/images-(2).jpg" style="width: 100px; height: 80px; object-fit: contain; border-radius: 10px;"></div>
<h4 style="color: var(--primary); margin: 10px 0; font-size: 1.2rem;">ØªØ±ÙˆØ³ÙŠÙƒÙ„</h4>
<p style="color: #666; font-size: 0.9rem;">Ø¯Ø±Ø§Ø¬Ø© Ø«Ù„Ø§Ø«ÙŠØ©</p>
</div>
<div class="vehicle-card" data-type="Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ" onclick="selectVehicleType('Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ')">
<div style="margin-bottom: 10px;"><img src="https://i.postimg.cc/HkjpTBFt/images.jpg" style="width: 100px; height: 80px; object-fit: contain; border-radius: 10px;"></div>
<h4 style="color: var(--primary); margin: 10px 0; font-size: 1.2rem;">Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ</h4>
<p style="color: #666; font-size: 0.9rem;">Ø­Ø§ÙÙ„Ø© ØµØºÙŠØ±Ø©</p>
</div>
</div>
</div>

<div id="registrationForm" style="display:none;">
<div style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.1) 0%, rgba(52, 152, 219, 0.1) 100%); padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: center; border: 2px solid var(--primary);">
<p style="margin: 0; color: var(--primary); font-size: 1.1rem; font-weight: 600;">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±: <span id="selectedVehicleType" style="font-size: 1.3rem; color: var(--secondary);"></span> <span id="selectedVehicleIcon" style="font-size: 1.5rem;"></span></p>
<button onclick="resetVehicleSelection()" class="btn" style="background: rgba(231, 76, 60, 0.1); color: var(--danger); padding: 8px 20px; margin-top: 10px; font-size: 0.9rem;">ğŸ”„ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</button>
</div>
<div class="form-grid">
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ</label>
<input type="text" id="ownerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
</div>
<div class="input-group">
<label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
<input type="text" id="nationalId" maxlength="14" placeholder="Ù…Ø«Ø§Ù„: 29501011234567" oninput="validateNationalId(this)">
<div id="nidValidation" class="validation-msg"></div>
</div>
<div class="input-group">
<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù„Ù„ØªØ­Ù‚Ù‚)</label>
<input type="date" id="birthDate" onchange="verifyBirthDate()">
<div id="birthValidation" class="validation-msg"></div>
</div>
<div class="input-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
<input type="tel" id="phone" maxlength="11" placeholder="01XXXXXXXXX" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
</div>
<div class="input-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>
<input type="text" id="vType" readonly style="background: rgba(39, 174, 96, 0.1); border: 2px solid var(--secondary); font-weight: 700; color: var(--secondary); font-size: 1.1rem; cursor: not-allowed;">
</div>
<div class="input-group">
<label>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø§Ù„Ø³Ù†Ø©)</label>
<select id="vYear"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©...</option></select>
</div>
<div class="input-group">
<label>Ù„ÙˆÙ† Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>
<input type="text" id="vColor" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø±ØŒ Ø£Ø³ÙˆØ¯ØŒ Ø£Ø¨ÙŠØ¶...">
</div>
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‚Ø±ÙŠØ© / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label>
<input type="text" id="locSearchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† Ù‡Ù†Ø§ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø¨ÙˆÙ‡Ø§ØŒ Ø­ÙŠ ØªÙŠØ³ÙŠØ±...)" onkeyup="filterLocations()">
<div id="resultsList" class="search-results"></div>
</div>
<div class="input-group" id="detailSection" style="display:none; grid-column: 1 / -1;">
<label id="selectedPlaceLabel"></label>
<textarea id="detailedAddress" rows="3" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ØŒ Ø£Ùˆ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©..."></textarea>
</div>
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</label>
<input type="file" id="multiFiles" multiple accept="image/*" style="background: linear-gradient(135deg, rgba(26, 82, 118, 0.08) 0%, rgba(52, 152, 219, 0.08) 100%); padding: 30px; border: 3px dashed var(--primary); font-weight: 600;">
<small style="color: #666; margin-top: 10px; display: block;">âœ“ Ø¶ØºØ· Ø°ÙƒÙŠ Ù„Ù„ØµÙˆØ± (800px) - Ø³Ø¹Ø© ØªØ®Ø²ÙŠÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©</small>
</div>
<div class="input-group" style="grid-column: 1 / -1; background: linear-gradient(135deg, rgba(39, 174, 96, 0.08) 0%, rgba(46, 204, 113, 0.08) 100%); padding: 25px; border-radius: 20px; border: 2px solid var(--secondary);">
<label style="color: var(--secondary); font-size: 1.1rem;">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø­ÙŠØ© Ù„Ù„ØªÙˆØ«ÙŠÙ‚ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)</label>
<p style="color: #666; font-size: 0.95rem; margin: 10px 0;">Ø³ÙŠØªÙ… Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù„Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù†ÙŠ</p>
<div style="text-align: center; margin-top: 15px;">
<video id="cameraPreview" autoplay style="display:none; width: 100%; max-width: 300px; border-radius: 15px; border: 3px solid var(--secondary);"></video>
<canvas id="cameraCanvas" style="display:none;"></canvas>
<div id="cameraStatus" style="margin-top: 10px; font-weight: 600; padding: 10px; border-radius: 10px;"></div>
</div>
</div>
</div>
<button id="submitBtn" class="btn btn-primary" style="width: 100%; font-size: 1.4rem; margin-top: 35px; padding: 20px;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
<div class="support-box">
<p>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:</p>
<div style="display:flex; justify-content:center; gap:15px; flex-wrap:wrap;">
<a href="https://wa.me/201021102607" target="_blank" class="btn btn-wa">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>
<a href="tel:01021102607" class="btn btn-wa" style="background: linear-gradient(135deg, var(--info) 0%, #2874a6 100%);">ğŸ“ Ø§ØªØµØ§Ù„</a>
</div>
</div>
</div>
</div>
<div id="inquiryPage" style="display:none;">
<div class="card" style="border: 3px solid var(--secondary);">
<h2 style="text-align: center; color: var(--secondary); margin-bottom: 40px; font-size: 2rem;">ğŸ” Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„ØªÙƒÙˆÙŠØ¯</h2>
<p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1rem;">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ ÙˆÙ…Ø¹Ø±ÙØ© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ù…Ø±ÙƒØ¨ØªÙƒ</p>
<div class="form-grid">
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ Ù„Ù„Ù…Ø§Ù„Ùƒ</label>
<input type="text" id="inqOwnerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
</div>
<div class="input-group">
<label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
<input type="text" id="inqNationalId" maxlength="14" placeholder="Ù…Ø«Ø§Ù„: 29501011234567" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
</div>
<div class="input-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
<input type="tel" id="inqPhone" maxlength="11" placeholder="01XXXXXXXXX" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
</div>
<div class="input-group">
<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
<input type="date" id="inqBirthDate">
</div>
<div class="input-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>
<select id="inqVType">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
<option value="ØªÙˆÙƒØªÙˆÙƒ">ØªÙˆÙƒØªÙˆÙƒ</option>
<option value="Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„">Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„</option>
<option value="ØªØ±ÙˆØ³ÙŠÙƒÙ„">ØªØ±ÙˆØ³ÙŠÙƒÙ„</option>
<option value="Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ">Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ</option>
</select>
</div>
</div>
<button id="inquiryBtn" class="btn" style="width: 100%; font-size: 1.4rem; margin-top: 35px; padding: 20px; background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white;">ğŸ” Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø­Ø§Ù„Ø©</button>
<div id="inquiryResult" style="display:none; margin-top: 40px; padding: 40px; border-radius: 25px; text-align: center;"></div>
</div>
</div>
<div id="complaintsModule" style="display:none;">
<div class="card" style="border: 3px solid var(--accent);">
<h2 style="text-align: center; color: var(--accent); margin-bottom: 30px; font-size: 2rem;">âš ï¸ Ù‚Ø³Ù… Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ù…Ù†ÙŠ</h2>
<p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 1.05rem;">Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ø¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„</p>
<div class="form-grid">
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©)</label>
<input type="text" id="compOwnerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
</div>
<div class="input-group">
<label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>
<input type="text" id="compNationalId" maxlength="14" placeholder="Ù…Ø«Ø§Ù„: 29501011234567" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
</div>
<div class="input-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</label>
<input type="tel" id="compPhone" maxlength="11" placeholder="01XXXXXXXXX" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
</div>
<div class="input-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø§Ù„Ù…Ø´ØªÙƒÙ‰ Ù…Ù†Ù‡Ø§</label>
<select id="compVType">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹...</option>
<option value="ØªÙˆÙƒØªÙˆÙƒ">ØªÙˆÙƒØªÙˆÙƒ</option>
<option value="Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„">Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„</option>
<option value="ØªØ±ÙˆØ³ÙŠÙƒÙ„">ØªØ±ÙˆØ³ÙŠÙƒÙ„</option>
<option value="Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ">Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ</option>
<option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
</select>
</div>
<div class="input-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰ / Ø§Ù„Ø¨Ù„Ø§Øº</label>
<select id="compType">
<option value="Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø¬Ø±Ø©">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø¬Ø±Ø©</option>
<option value="Ø³ÙˆØ¡ Ù…Ø¹Ø§Ù…Ù„Ø©">Ø³ÙˆØ¡ Ù…Ø¹Ø§Ù…Ù„Ø©</option>
<option value="Ø§Ù„Ø³Ø¨ ÙˆØ§Ù„Ø´ØªÙ… Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚">Ø§Ù„Ø³Ø¨ ÙˆØ§Ù„Ø´ØªÙ… Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚</option>
<option value="Ù‚ÙŠØ§Ø¯Ø© Ù…ØªÙ‡ÙˆØ±Ø©">Ù‚ÙŠØ§Ø¯Ø© Ù…ØªÙ‡ÙˆØ±Ø©</option>
<option value="Ø³Ø±Ù‚Ø© Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù† Ø£ØºØ±Ø§Ø¶">Ø³Ø±Ù‚Ø© Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù† Ø£ØºØ±Ø§Ø¶ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</option>
<option value="Ù†Ø³ÙŠØ§Ù† Ø´ÙŠØ¡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©">Ù†Ø³ÙŠØ§Ù† Ø´ÙŠØ¡ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</option>
<option value="Ø±ÙØ¶ ØªÙˆØµÙŠÙ„ Ø§Ù„Ø±Ø§ÙƒØ¨">Ø±ÙØ¶ ØªÙˆØµÙŠÙ„ Ø§Ù„Ø±Ø§ÙƒØ¨</option>
<option value="Ù…Ø±ÙƒØ¨Ø© Ù…Ø®Ø§Ù„ÙØ©">Ù…Ø±ÙƒØ¨Ø© Ù…Ø®Ø§Ù„ÙØ©</option>
<option value="ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ù…Ù†ÙŠØ©">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ù…Ù†ÙŠØ©</option>
<option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
</select>
</div>
<div class="input-group" style="grid-column: 1 / -1;">
<label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ / Ø§Ù„Ø¨Ù„Ø§Øº</label>
<textarea id="compDetails" rows="5" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ù…Ø«Ø§Ù„: Ø³Ø§Ø¦Ù‚ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ Ø±Ù‚Ù… XXX Ø·Ù„Ø¨ Ø²ÙŠØ§Ø¯Ø© ÙÙŠ Ø§Ù„Ø£Ø¬Ø±Ø© Ù…Ù† 5 Ø¬Ù†ÙŠÙ‡ Ø¥Ù„Ù‰ 10 Ø¬Ù†ÙŠÙ‡...)" style="padding: 16px; border-radius: 15px; border: 2px solid var(--glass-border); font-family: inherit; font-size: 1.05rem;"></textarea>
</div>
<div class="input-group">
<label>ğŸ“¸ ØµÙˆØ±Ø© Ø³ÙŠÙ„ÙÙŠ (Ù„Ù„Ù…ÙØ¨Ù„ÙÙ‘Øº) - Ø¥Ø¬Ø¨Ø§Ø±ÙŠ</label>
<input type="file" id="compSelfie" accept="image/*" style="padding: 16px; border: 3px dashed var(--accent); background: rgba(211, 84, 0, 0.05); font-weight: 600;">
</div>
<div class="input-group">
<label>ğŸªª ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© - Ø¥Ø¬Ø¨Ø§Ø±ÙŠ</label>
<input type="file" id="compIdCard" accept="image/*" style="padding: 16px; border: 3px dashed var(--accent); background: rgba(211, 84, 0, 0.05); font-weight: 600;">
</div>
<div class="input-group" style="grid-column: 1 / -1;">
<label>ğŸ“· ØµÙˆØ± Ø§Ù„Ù…Ø´ÙƒÙ„Ø© (Ø§Ù„Ø³Ø§Ø¦Ù‚ØŒ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©ØŒ Ø£Ùˆ Ø£ÙŠ Ø¯Ù„ÙŠÙ„) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ</label>
<input type="file" id="compProblemImages" multiple accept="image/*" style="padding: 20px; border: 3px dashed var(--info); background: rgba(52, 152, 219, 0.05); font-weight: 600;">
<small style="color: #666; margin-top: 10px; display: block;">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø© Ù„Ù„Ù…Ø´ÙƒÙ„Ø©</small>
</div>
</div>
<button id="submitCompBtn" class="btn" style="width: 100%; background: linear-gradient(135deg, var(--accent) 0%, #ba4a00 100%); color: white; padding: 20px; font-size: 1.3rem; margin-top: 30px;">
Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´ÙƒÙˆÙ‰ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ù…Ù†ÙŠ âœ‰ï¸
</button>
</div>
</div>
</div>
<div id="adminPage" class="admin-content">
<div class="stats-grid">
<div class="stat-card"><p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</p><h3 id="statTotal">0</h3></div>
<div class="stat-card"><p>Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</p><h3 id="statCompTotal">0</h3></div>
<div class="stat-card"><p>ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯</p><h3 id="statCoded">0</h3></div>
<div class="stat-card"><p>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p><h3 id="statPending">0</h3></div>
</div>
<div class="card">
<div style="display:flex; gap:15px; margin-bottom:35px; flex-wrap: wrap; align-items: center;">
<button id="showOrdersBtn" class="btn" style="background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%); color: white;">ğŸšœ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</button>
<button id="showComplaintsBtn" class="btn" style="background: linear-gradient(135deg, var(--accent) 0%, #ba4a00 100%); color: white;">âš–ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</button>
<button id="showAuditLogBtn" class="btn" style="background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%); color: white;">ï¿½ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</button>
<button id="bulkImportBtn" class="btn" style="background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%); color: white;">ï¿½ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel</button>
<div style="flex: 1; position: relative;">
<input type="text" id="searchInput" style="width: 100%; padding:16px 50px 16px 16px; border-radius:16px; border:2px solid var(--glass-border); background:rgba(255,255,255,0.95); font-weight:600; transition: all 0.3s;" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ø§Ù… ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...">
<button id="clearSearchBtn" onclick="document.getElementById('searchInput').value=''; document.getElementById('searchInput').dispatchEvent(new Event('input'));" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #999; font-size: 1.5rem; cursor: pointer; display: none;">âœ–</button>
</div>
<button id="exportExcelBtn" class="btn" style="background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color:white;">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
<button onclick="location.reload()" class="btn btn-del">ğŸšª Ø®Ø±ÙˆØ¬</button>
</div>
<div id="ordersTableContainer" style="overflow-x:auto;">
<table id="excelTable">
<thead>
<tr>
<th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ù…Ø§Ù„Ùƒ</th><th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th><th>Ø§Ù„ÙƒÙˆØ¯</th>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙƒÙˆÙŠØ¯</th><th>Ø§Ù„ØµÙˆØ±</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="dataTable"></tbody>
</table>
</div>
<div id="complaintsTableContainer" style="overflow-x:auto; display: none;">
<table id="complaintsTable">
<thead>
<tr>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ù„Ø§Øº</th><th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰</th>
<th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (4 ØµÙˆØ±)</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="compTableBody"></tbody>
</table>
</div>
<div id="auditLogContainer" style="overflow-x:auto; display: none;">
<h3 style="color: #8e44ad; margin-bottom: 20px;">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø©</h3>
<table id="auditLogTable">
<thead>
<tr style="background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);">
<th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th>
<th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
</tr>
</thead>
<tbody id="auditLogBody"></tbody>
</table>
</div>
<div id="visitorsLogContainer" style="overflow-x:auto; display: none;">
<h3 style="color: #16a085; margin-bottom: 20px;">ğŸ‘ï¸ Ø³Ø¬Ù„ Ø§Ù„Ø²ÙˆØ§Ø± ÙˆØ§Ù„Ù…ØªØµÙØ­ÙŠÙ†</h3>
<table id="visitorsLogTable">
<thead>
<tr style="background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%);">
<th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th><th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…ØªØµÙØ­</th>
<th>Ø§Ù„Ù†Ø¸Ø§Ù…</th><th>Ø§Ù„Ø¯Ù‚Ø©</th><th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</th>
</tr>
</thead>
<tbody id="visitorsLogBody"></tbody>
</table>
</div>
</div>
</div>
<div id="imgModal" class="modal">
<span class="close-modal" id="closeModalBtn">&times;</span>
<img id="mainViewImg" style="max-width:90%; max-height:80vh; display:block; margin:80px auto 30px; border:8px solid white; border-radius:25px; box-shadow: 0 0 60px rgba(0,0,0,0.8);">
<div id="modalThumbnails" style="display: flex; justify-content: center; gap: 15px; padding: 25px; flex-wrap: wrap;"></div>
</div>
<div id="editModal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="document.getElementById('editModal').style.display='none'">&times;</span>
<h3>ğŸ”§ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</h3>
<div class="form-grid" style="grid-template-columns: 1fr 1fr; margin-top:25px;">
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</label>
<input type="text" id="editOwner">
</div>
<div class="input-group">
<label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</label>
<input type="text" id="editNid" maxlength="14">
</div>
<div class="input-group">
<label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input type="tel" id="editPhone" maxlength="11">
</div>
<div class="input-group">
<label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</label>
<select id="editVType">
<option value="ØªÙˆÙƒØªÙˆÙƒ">ØªÙˆÙƒØªÙˆÙƒ</option>
<option value="Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„">Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„</option>
<option value="ØªØ±ÙˆØ³ÙŠÙƒÙ„">ØªØ±ÙˆØ³ÙŠÙƒÙ„</option>
<option value="Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ">Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ</option>
</select>
</div>
<div class="input-group">
<label>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³Ù†Ø©</label>
<select id="editVYear"></select>
</div>
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù„ÙˆÙ†</label>
<input type="text" id="editVDesc">
</div>
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
<input type="text" id="editAddress">
</div>
<div class="input-group" style="grid-column: 1 / -1;">
<label>Ø±Ù‚Ù… Ø§Ù„ÙƒÙˆØ¯ (ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±)</label>
<input type="text" id="editVCode" style="border: 3px solid var(--secondary); font-weight:bold; color:var(--secondary); font-size: 1.3rem; text-align: center;">
</div>
</div>
<div style="display:flex; gap:15px; margin-top:35px;">
<button id="saveEditBtn" class="btn btn-primary" style="flex:1; padding:18px; font-size: 1.1rem;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…</button>
<button onclick="document.getElementById('editModal').style.display='none'" class="btn btn-del" style="flex:1; padding:18px; font-size: 1.1rem;">Ø¥Ù„ØºØ§Ø¡ âŒ</button>
</div>
</div>
</div>
<div id="codeModal" class="modal">
<div class="modal-content" style="max-width:500px; text-align:center;">
<span class="close-modal" onclick="document.getElementById('codeModal').style.display='none'">&times;</span>
<h3 style="color:var(--primary); font-size: 1.8rem;">ğŸ”¢ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ø°ÙƒÙŠ</h3>
<p id="codeHint" style="font-size:1.1rem; color:#555; background: rgba(0,0,0,0.06); padding:18px; border-radius:15px; margin: 25px 0; font-weight: 600;"></p>
<div class="input-group">
<label style="justify-content: center;">Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ù…Ø±ÙƒØ¨Ø©:</label>
<input type="text" id="manualCodeInput" style="text-align:center; font-size:2.5rem; font-weight:bold; color:var(--secondary); border: 3px solid var(--secondary); height: 80px;">
</div>
<div style="display:flex; gap:15px; margin-top:35px;">
<button id="confirmCodeBtn" class="btn btn-primary" style="flex:1; padding:18px; font-size: 1.1rem;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ âœ…</button>
<button onclick="document.getElementById('codeModal').style.display='none'" class="btn btn-del" style="padding:18px; font-size: 1.1rem;">ØªØ¬Ø§Ù‡Ù„ âŒ</button>
</div>
</div>
</div>
<div id="bulkImportModal" class="modal">
<div class="modal-content" style="max-width: 900px;">
<span class="close-modal" onclick="document.getElementById('bulkImportModal').style.display='none'">&times;</span>
<h3 style="color: #8e44ad; font-size: 1.8rem;">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…Ø§Ø¹ÙŠ Ù…Ù† Excel</h3>
<div style="background: linear-gradient(135deg, rgba(142, 68, 173, 0.1) 0%, rgba(155, 89, 182, 0.1) 100%); padding: 25px; border-radius: 20px; margin: 25px 0; border: 2px solid rgba(142, 68, 173, 0.3);">
<h4 style="color: #8e44ad; margin-top: 0;">ğŸ“‹ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</h4>
<p style="color: #666; line-height: 1.8; margin: 15px 0;">ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ù…Ù„Ù Excel Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨:</p>
<ol style="color: #555; line-height: 2; font-weight: 600;">
<li>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</li>
<li>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</li>
<li>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)</li>
<li>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (YYYY-MM-DD)</li>
<li>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (ØªÙˆÙƒØªÙˆÙƒ / Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„ / ØªØ±ÙˆØ³ÙŠÙƒÙ„ / Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ)</li>
<li>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³Ù†Ø©</li>
<li>Ø§Ù„Ù„ÙˆÙ†</li>
<li>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</li>
<li>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙØ§Ø±ØºØ§Ù‹)</li>
</ol>
<button id="downloadTemplateBtn" class="btn" style="background: linear-gradient(135deg, var(--info) 0%, #2874a6 100%); color: white; margin-top: 15px;">ğŸ“„ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ù†Ù…ÙˆØ°Ø¬ÙŠ</button>
</div>
<div class="input-group">
<label style="font-size: 1.1rem; color: #8e44ad;">Ø§Ø®ØªØ± Ù…Ù„Ù Excel Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯:</label>
<input type="file" id="bulkImportFile" accept=".xlsx, .xls" style="padding: 20px; border: 3px dashed #8e44ad; background: rgba(142, 68, 173, 0.05); font-weight: 600; border-radius: 15px;">
</div>
<div id="importPreview" style="display:none; margin: 25px 0; max-height: 300px; overflow-y: auto; background: white; padding: 20px; border-radius: 15px; border: 2px solid #ddd;"></div>
<div style="display:flex; gap:15px; margin-top:35px;">
<button id="confirmImportBtn" class="btn" style="flex:1; padding:18px; font-size: 1.1rem; background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white;">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
<button onclick="document.getElementById('bulkImportModal').style.display='none'" class="btn btn-del" style="flex:1; padding:18px; font-size: 1.1rem;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
</div>
</div>
</div>
<div id="successModal" class="modal">
<div class="modal-content" style="max-width: 700px; text-align: center; background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%);">
<span class="close-modal" onclick="document.getElementById('successModal').style.display='none'; location.reload();">&times;</span>
<div style="margin: 30px 0;">
<div style="width: 120px; height: 120px; margin: 0 auto 30px; background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: pulse 2s infinite; box-shadow: 0 10px 40px rgba(39, 174, 96, 0.4);">
<span style="font-size: 70px; color: white;">âœ…</span>
</div>
<h2 style="color: var(--secondary); font-size: 2.5rem; margin: 20px 0; font-weight: 900;">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!</h2>
<div id="successMessage" style="background: linear-gradient(135deg, rgba(39, 174, 96, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%); padding: 30px; border-radius: 20px; margin: 30px 0; border: 3px solid var(--secondary);"></div>
<div id="successDetails" style="text-align: right; background: white; padding: 25px; border-radius: 15px; margin: 25px 0; border: 2px solid #ddd; line-height: 2;"></div>
<button onclick="document.getElementById('successModal').style.display='none'; location.reload();" class="btn" style="background: linear-gradient(135deg, var(--secondary) 0%, #229954 100%); color: white; padding: 18px 50px; font-size: 1.3rem; margin-top: 20px;">Ø­Ø³Ù†Ø§Ù‹ØŒ Ø´ÙƒØ±Ø§Ù‹ ğŸ‘</button>
</div>
</div>
</div>
<div id="complaintSuccessModal" class="modal">
<div class="modal-content" style="max-width: 700px; text-align: center; background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%);">
<span class="close-modal" onclick="document.getElementById('complaintSuccessModal').style.display='none'; location.reload();">&times;</span>
<div style="margin: 30px 0;">
<div style="width: 120px; height: 120px; margin: 0 auto 30px; background: linear-gradient(135deg, var(--accent) 0%, #ba4a00 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: pulse 2s infinite; box-shadow: 0 10px 40px rgba(211, 84, 0, 0.4);">
<span style="font-size: 70px; color: white;">ğŸ“¨</span>
</div>
<h2 style="color: var(--accent); font-size: 2.5rem; margin: 20px 0; font-weight: 900;">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø´ÙƒÙˆØ§Ùƒ!</h2>
<div style="background: linear-gradient(135deg, rgba(211, 84, 0, 0.1) 0%, rgba(186, 74, 0, 0.1) 100%); padding: 30px; border-radius: 20px; margin: 30px 0; border: 3px solid var(--accent);">
<p style="font-size: 1.3rem; color: #555; margin: 0; line-height: 1.8;">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø´ÙƒÙˆØ§Ùƒ ÙˆØªÙˆØ«ÙŠÙ‚Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ù†ÙŠ</p>
</div>
<div id="complaintDetails" style="text-align: right; background: white; padding: 25px; border-radius: 15px; margin: 25px 0; border: 2px solid #ddd; line-height: 2;"></div>
<div style="background: rgba(243, 156, 18, 0.1); padding: 20px; border-radius: 15px; margin: 25px 0; border: 2px dashed var(--warning);">
<p style="color: #555; font-size: 1.1rem; margin: 0;">â³ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø±Ø¯ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†</p>
</div>
<button onclick="document.getElementById('complaintSuccessModal').style.display='none'; location.reload();" class="btn" style="background: linear-gradient(135deg, var(--accent) 0%, #ba4a00 100%); color: white; padding: 18px 50px; font-size: 1.3rem; margin-top: 20px;">Ø­Ø³Ù†Ø§Ù‹ØŒ Ø´ÙƒØ±Ø§Ù‹ ğŸ‘</button>
</div>
</div>
</div>
<footer class="engineer-footer">
ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« Ø¨ÙˆØ§Ø³Ø·Ø© Ù…/ Ù…Ù‡Ù†Ø¯ Ø§Ù„ØªÙ‡Ø§Ù…ÙŠ - 01021102607 | Ù†Ø¸Ø§Ù… Ù…ØªØ·ÙˆØ± Ø¨ØªÙ‚Ù†ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø©
</footer>
<script>
function openService(serviceId) {
document.getElementById('portalSection').style.display = 'none';
document.getElementById(serviceId).style.display = 'block';
document.getElementById('goPortalBtn').style.display = 'inline-flex';
if (serviceId === 'citizenPage') {
setTimeout(() => initCamera(), 500);
}
}
function fillYears(selectId) {
const select = document.getElementById(selectId);
if(!select) return;
for (let year = 2000; year <= 2200; year++) {
let opt = document.createElement('option');
opt.value = year; opt.innerText = year;
select.appendChild(opt);
}
}
fillYears('vYear'); fillYears('editVYear');
function validateNationalId(input) {
const nid = input.value.replace(/[^0-9]/g, '');
input.value = nid;
const msgDiv = document.getElementById('nidValidation');
if (nid.length === 0) { msgDiv.style.display = 'none'; input.classList.remove('error'); return; }
if (nid.length !== 14) {
msgDiv.className = 'validation-msg error';
msgDiv.innerText = 'âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù…';
input.classList.add('error');
return false;
}
const century = nid[0];
if (!['2', '3'].includes(century)) {
msgDiv.className = 'validation-msg error';
msgDiv.innerText = 'âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 2 Ø£Ùˆ 3)';
input.classList.add('error');
return false;
}
const year = parseInt((century === '2' ? '19' : '20') + nid.substring(1, 3));
const month = parseInt(nid.substring(3, 5));
const day = parseInt(nid.substring(5, 7));
if (month < 1 || month > 12 || day < 1 || day > 31) {
msgDiv.className = 'validation-msg error';
msgDiv.innerText = 'âŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
input.classList.add('error');
return false;
}
msgDiv.className = 'validation-msg success';
msgDiv.innerText = `âœ… Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ØµØ­ÙŠØ­ - ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬: ${day}/${month}/${year}`;
input.classList.remove('error');
document.getElementById('birthDate').value = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
return true;
}
function verifyBirthDate() {
const nid = document.getElementById('nationalId').value;
const birthInput = document.getElementById('birthDate').value;
const msgDiv = document.getElementById('birthValidation');
if (!nid || nid.length !== 14 || !birthInput) {
msgDiv.style.display = 'none';
return;
}
const century = nid[0];
const year = parseInt((century === '2' ? '19' : '20') + nid.substring(1, 3));
const month = parseInt(nid.substring(3, 5));
const day = parseInt(nid.substring(5, 7));
const nidDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
if (birthInput === nidDate) {
msgDiv.className = 'validation-msg success';
msgDiv.innerText = 'âœ… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ';
return true;
} else {
msgDiv.className = 'validation-msg error';
msgDiv.innerText = `âŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚! Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ­ÙŠØ­: ${day}/${month}/${year}`;
return false;
}
}
const locations = [
"Ù…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±", "Ø­ÙŠ Ø§Ù„Ù†ØµØ±", "Ø­ÙŠ Ø§Ù„Ø²Ù‡ÙˆØ±", "Ø­ÙŠ ØªÙŠØ³ÙŠØ±", "Ø­ÙŠ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©", "Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…", "Ø­ÙŠ Ø§Ù„Ø±ÙˆØ¶Ø©",
"Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø·Ø©", "Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ÙƒÙ…Ø©", "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¬Ù„Ø§Ø¡", "Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø¹Ø§Ù…", "Ø£Ø¨Ùˆ Ø§Ù„Ø´Ù‚ÙˆÙ‚", "ØªÙ„ÙŠØ¬Ø©",
"Ù…Ù†Ø´Ø£Ø© ÙŠÙˆØ³Ù Ù…Ù†ØµÙˆØ±", "Ø§Ù„Ø­Ù…Ø§Ø¯ÙŠÙŠÙ†", "Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©", "Ø§Ù„Ø¨ÙˆÙ‡Ø§", "Ø§Ù„Ù‡Ø¬Ø§Ø±Ø³Ø©", "Ø§Ø¨Ù† Ø§Ù„Ø¹Ø§Øµ", "Ø§Ù„Ø³Ù„Ø·Ø§Ù† Ø­Ø³Ù†",
"Ø§Ù„Ù‚Ø±Ø§Ù…ÙˆØµ", "ÙƒÙØ± Ø­Ù…Ø§Ø¯", "Ø§Ù„Ù‚Ø¶Ø§Ø©", "Ø§Ù„Ø­ÙˆØ§Ù…Ø¯Ø©", "Ø³Ù†Ø¬Ù‡Ø§", "ÙƒÙØ± Ø§Ù„Ø´Ø§ÙˆÙŠØ´", "Ù†Ø§Ø·ÙˆØ±Ø©", "Ù…Ù†Ø´Ø£Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ ÙˆØ§ÙƒØ¯",
"ÙƒÙØ± Ø§Ù„Ø³ÙˆÙŠØ±ÙƒÙŠ", "ÙƒÙØ± Ø§Ù„ÙØ±Ø§ÙŠØ­Ø©", "Ø§Ù„Ù…Ø¤Ø§Ù†Ø³Ø©", "Ø§Ù„Ù…Ø´Ø§Ø¹Ù„Ø©", "Ù…Ù†Ø´Ø£Ø© ØµØ¯Ù‚ÙŠ", "Ø´ÙŠØ· Ø§Ù„Ù‡ÙˆÙ‰", "Ø²ÙˆØ± Ø£Ø¨Ùˆ Ø§Ù„Ù„ÙŠÙ„",
"Ø´Ø§Ù†ÙŠØ· Ø§Ù„Ø£Ø­ÙˆØ§Ø²", "Ù…Ù†Ø´Ø£Ø© Ø¨Ø´Ø§Ø±Ø©", "Ø¢Ù‡ÙŠÙ„", "Ø§Ù„Ø¨ØªÙŠØ©", "ØªÙŠØ±Ø©", "Ø§Ù„Ù…Ø´Ø±Ø¹", "ÙƒÙØ± Ø¨Ø¯Ø±Ø§Ù†", "Ù…Ù†Ø´Ø£Ø© ØµØ¨Ø­ÙŠ",
"Ø´ÙŠÙˆØ§", "ÙƒÙØ± Ø£Ø¨ÙˆØ´ÙŠØ®Ø©", "Ø¹Ø²Ø¨Ø© Ø§Ù„ÙˆÙƒÙŠÙ„", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ø¯Ø¨Ø§Øº", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ø®Ù…Ø³Ø©", "Ø¹Ø²Ø¨Ø© Ø§Ù„ØµÙÙŠØ­", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ø´ÙˆØ§Ù",
"Ø¹Ø²Ø¨Ø© ÙˆØ§ÙƒØ¯", "Ø¹Ø²Ø¨Ø© ØµØ§Ø¯Ù‚", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ø¨Ø­Ø±", "Ø¹Ø²Ø¨Ø© Ø³Ù„Ø§Ù…Ø©", "Ø¹Ø²Ø¨Ø© Ø£Ø¨Ùˆ Ø§Ù„Ù„ÙŠÙ„", "ÙƒÙØ± Ø§Ù„Ø£Ø³ØªØ§Ø°", "Ø¹Ø²Ø¨Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø³Ù„Ø§Ù…",
"Ø¹Ø²Ø¨Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±", "Ø¹Ø²Ø¨Ø© Ø±Ø£ÙØª", "Ø¹Ø²Ø¨Ø© Ù…Ù†ØµÙˆØ±", "ÙƒÙØ± ÙŠÙˆØ³Ù", "Ø¹Ø²Ø¨Ø© Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù„ÙŠÙ…", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ù…Ø£Ù…ÙˆØ±",
"Ø¹Ø²Ø¨Ø© Ø§Ù„Ø¨Ø±Ø¬", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ø³Ù„Ø·Ø§Ù† Ø®Ø¶Ø±", "Ø¹Ø²Ø¨Ø© Ø¯ÙˆØ´", "Ø¹Ø²Ø¨Ø© Ø¬ÙˆØ¯Ø©", "ÙƒÙØ± Ù‡Ù„Ø§Ù„", "Ø¹Ø²Ø¨Ø© Ù…Ø±Ø§Ø¯",
"Ø¹Ø²Ø¨Ø© Ø£Ø¨Ùˆ ØºØ§Ù†Ù…", "Ø¹Ø²Ø¨Ø© Ø§Ù„Ø´Ø±Ù‚Ø§ÙˆÙŠ", "Ø¹Ø²Ø¨Ø© Ø´Ø§Ù‡ÙŠÙ†", "Ù…Ù†Ø´Ø£Ø© Ø´Ù„Ø¨ÙŠ", "Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠÙŠÙ†", "ÙƒÙØ± Ø£Ø¨Ùˆ Ø´Ø±Ø§Ø¨ÙŠØ©",
"Ø§Ù„ÙØ±Ø§Ø¨ÙŠÙ†", "Ø´Ù†ÙŠØ·Ø© Ø§Ù„Ø­Ø±Ø§Ø¨ÙˆØ©", "Ù†Ø¬ÙˆÙ…", "ÙƒÙØ± ÙŠÙˆÙ†Ø³", "Ø¹Ø²Ø¨Ø© Ø´Ø±Ù", "Ø§Ù„Ù…Ù†Ø´ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©"
];
function filterLocations() {
let input = document.getElementById('locSearchInput').value;
let resultsDiv = document.getElementById('resultsList');
resultsDiv.innerHTML = '';
if (input.length > 0) {
let filtered = locations.filter(loc => loc.includes(input));
if (filtered.length > 0) {
resultsDiv.style.display = 'block';
filtered.forEach(loc => {
let item = document.createElement('div');
item.classList.add('result-item');
item.innerText = loc;
item.onclick = () => selectLocation(loc);
resultsDiv.appendChild(item);
});
} else { resultsDiv.style.display = 'none'; }
} else { resultsDiv.style.display = 'none'; }
}
function selectLocation(loc) {
document.getElementById('locSearchInput').value = loc;
document.getElementById('resultsList').style.display = 'none';
document.getElementById('detailSection').style.display = 'block';
document.getElementById('selectedPlaceLabel').innerText = "Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„ ÙÙŠ (" + loc + "):";
}

let cameraStream = null;
let capturedImageBlob = null;
let cameraAvailable = false;

// ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
function autoStartCamera() {
const citizenPage = document.getElementById('citizenPage');
if (citizenPage && citizenPage.style.display !== 'none') {
initCamera();
}
}

async function initCamera() {
const video = document.getElementById('cameraPreview');
const statusDiv = document.getElementById('cameraStatus');
try {
cameraStream = await navigator.mediaDevices.getUserMedia({ 
video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }, 
audio: false 
});
video.srcObject = cameraStream;
video.style.display = 'block';
cameraAvailable = true;
statusDiv.innerHTML = '<span style="color: var(--secondary); background: rgba(39, 174, 96, 0.1); padding: 8px 15px; border-radius: 8px; display: inline-block;">âœ… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø²Ø© - Ø³ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span>';
} catch (error) {
cameraAvailable = false;
statusDiv.innerHTML = '<span style="color: #f39c12; background: rgba(243, 156, 18, 0.1); padding: 8px 15px; border-radius: 8px; display: inline-block;">âš ï¸ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØºÙŠØ± Ù…ØªØ§Ø­Ø© - Ø³ÙŠØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø© Ø­ÙŠØ©</span>';
console.log('Camera not available:', error);
}
}

async function captureImageFromCamera() {
if (!cameraAvailable || !cameraStream) {
return null;
}
try {
const video = document.getElementById('cameraPreview');
const canvas = document.getElementById('cameraCanvas');
canvas.width = video.videoWidth || 640;
canvas.height = video.videoHeight || 480;
const ctx = canvas.getContext('2d');
ctx.drawImage(video, 0, 0);
return new Promise((resolve) => {
canvas.toBlob((blob) => {
capturedImageBlob = blob;
if (cameraStream) {
cameraStream.getTracks().forEach(track => track.stop());
cameraStream = null;
}
video.style.display = 'none';
resolve(blob);
}, 'image/jpeg', 0.85);
});
} catch (error) {
console.log('Capture error:', error);
return null;
}
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
setTimeout(() => {
const citizenPage = document.getElementById('citizenPage');
if (citizenPage && citizenPage.style.display !== 'none') {
initCamera();
}
}, 500);

function selectVehicleType(type) {
const icons = {
'ØªÙˆÙƒØªÙˆÙƒ': '<img src="https://i.postimg.cc/QtgDfPKv/images-(1).jpg" style="width: 40px; height: 35px; object-fit: contain; vertical-align: middle;">',
'Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„': '<img src="https://i.postimg.cc/zfKYfM7K/hwjn-4-2.jpg" style="width: 40px; height: 35px; object-fit: contain; vertical-align: middle;">',
'ØªØ±ÙˆØ³ÙŠÙƒÙ„': '<img src="https://i.postimg.cc/HnSfKCYf/images-(2).jpg" style="width: 40px; height: 35px; object-fit: contain; vertical-align: middle;">',
'Ù…ÙŠÙƒØ±ÙˆØ¨Ø§Øµ': '<img src="https://i.postimg.cc/HkjpTBFt/images.jpg" style="width: 40px; height: 35px; object-fit: contain; vertical-align: middle;">'
};

document.querySelectorAll('.vehicle-card').forEach(card => {
card.classList.remove('selected');
});
document.querySelector(`.vehicle-card[data-type="${type}"]`).classList.add('selected');

document.getElementById('vType').value = type;
document.getElementById('selectedVehicleType').innerText = type;
document.getElementById('selectedVehicleIcon').innerHTML = icons[type];
document.getElementById('vehicleTypeSelection').style.display = 'none';
document.getElementById('registrationForm').style.display = 'block';

setTimeout(() => initCamera(), 300);
}

function resetVehicleSelection() {
document.getElementById('vehicleTypeSelection').style.display = 'block';
document.getElementById('registrationForm').style.display = 'none';
document.querySelectorAll('.vehicle-card').forEach(card => {
card.classList.remove('selected');
});
if (cameraStream) {
cameraStream.getTracks().forEach(track => track.stop());
cameraStream = null;
}
}
</script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc, getDocs, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
const firebaseConfig = {
apiKey: "AIzaSyDUZ8F7RbCEE_L3x-xVYqGHxPZqE-vH9lM",
authDomain: "system-storage-bd0ed.firebaseapp.com",
projectId: "system-storage-bd0ed",
storageBucket: "system-storage-bd0ed.firebasestorage.app",
messagingSenderId: "1059726732430",
appId: "1:1059726732430:web:e4c8e3f3b8e3e3e3e3e3e3"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const dbRef = collection(db, "orders");
const compRef = collection(db, "complaints");
const auditLogRef = collection(db, "auditLog");
const visitorsRef = collection(db, "visitors");
let userRole = "";
let currentEditId = "";
let currentUser = "";

// ğŸ” ØªØ´ÙÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
function simpleEncrypt(text) {
return btoa(encodeURIComponent(text));
}

function simpleDecrypt(encoded) {
try {
return decodeURIComponent(atob(encoded));
} catch {
return encoded;
}
}

// ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
async function logAction(action, details) {
try {
await addDoc(auditLogRef, {
user: currentUser,
role: userRole,
action: action,
details: details,
timestamp: Date.now(),
ip: 'N/A'
});
} catch (error) {
console.error('Log error:', error);
}
}

// ğŸ‘ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙˆØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
async function logVisitor() {
try {
const visitorInfo = {
timestamp: Date.now(),
userAgent: navigator.userAgent,
language: navigator.language,
platform: navigator.platform,
screenResolution: `${screen.width}x${screen.height}`,
timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
referrer: document.referrer || 'Ù…Ø¨Ø§Ø´Ø±',
page: 'Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
phone: null,
phoneProvided: false
};

// ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
await addDoc(visitorsRef, visitorInfo);

// Ø¥Ø¸Ù‡Ø§Ø± notification Ø¨Ø¹Ø¯ 30 Ø«Ø§Ù†ÙŠØ©
setTimeout(() => {
const notification = document.getElementById('phoneNotification');
if (notification) {
notification.classList.add('show');
}
}, 30000); // 30 Ø«Ø§Ù†ÙŠØ©

} catch (error) {
console.error('Visitor log error:', error);
}
}

// Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† HTML
window.closeNotification = function() {
const notification = document.getElementById('phoneNotification');
notification.classList.remove('show');
};

window.submitNotificationPhone = async function() {
const phone = document.getElementById('notificationPhone').value.trim();
if (phone.length !== 11) {
alert('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­ (11 Ø±Ù‚Ù…)');
return;
}
try {
await addDoc(visitorsRef, {
timestamp: Date.now(),
phone: phone,
phoneProvided: true,
source: 'notification',
userAgent: navigator.userAgent
});
window.closeNotification();
alert('âœ… Ø´ÙƒØ±Ø§Ù‹! Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ');
} catch (error) {
alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹');
}
};

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²Ø§Ø¦Ø± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
logVisitor();

// âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary
const CLOUDINARY_CLOUD_NAME = "dg3u3f22n";
const CLOUDINARY_UPLOAD_PRESET = "WORKSAQR";

const formatDateTime = (ts) => {
if (!ts) return "-";
const d = new Date(ts);
return d.toLocaleDateString('ar-EG') + " " + d.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
};

// Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
const uploadToCloudinary = async (file) => {
return new Promise((resolve, reject) => {
const reader = new FileReader();
reader.readAsDataURL(file);
reader.onload = async (e) => {
const img = new Image();
img.src = e.target.result;
img.onload = async () => {
const canvas = document.createElement('canvas');
const maxWidth = 800;
const scale = img.width > maxWidth ? maxWidth / img.width : 1;
canvas.width = img.width * scale;
canvas.height = img.height * scale;
const ctx = canvas.getContext('2d');
ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
canvas.toBlob(async (blob) => {
try {
const formData = new FormData();
formData.append('file', blob);
formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

console.log('Uploading to:', CLOUDINARY_CLOUD_NAME, 'Preset:', CLOUDINARY_UPLOAD_PRESET);

const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
method: 'POST',
body: formData
});

console.log('Response status:', response.status);
const data = await response.json();
console.log('Response data:', data);

if (data.secure_url) {
resolve(data.secure_url);
} else if (data.error) {
console.error('Cloudinary Error:', data.error);
reject(new Error(`Cloudinary Error: ${data.error.message}`));
} else {
reject(new Error('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© - Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©'));
}
} catch (error) {
console.error('Upload Error:', error);
reject(new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹: ${error.message}`));
}
}, 'image/jpeg', 0.70);
};
img.onerror = () => reject(new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©'));
};
reader.onerror = () => reject(new Error('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
});
};
document.getElementById('submitBtn').onclick = async () => {
const btn = document.getElementById('submitBtn');
const files = document.getElementById('multiFiles').files;
const owner = document.getElementById('ownerName').value;
const nid = document.getElementById('nationalId').value;
const phone = document.getElementById('phone').value;
const year = document.getElementById('vYear').value;
const color = document.getElementById('vColor').value;
const mainLocation = document.getElementById('locSearchInput').value;
const extraAddress = document.getElementById('detailedAddress').value;
const birthDate = document.getElementById('birthDate').value;
if (!validateNationalId(document.getElementById('nationalId'))) {
alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ ØµØ­ÙŠØ­ (14 Ø±Ù‚Ù…)");
return;
}
if (!verifyBirthDate()) {
alert("âŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ");
return;
}
if (nid.length !== 14 || !owner || files.length === 0 || !mainLocation || !year || !birthDate) { 
alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©"); 
return; 
}
if (phone.length !== 11) {
alert("âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 11 Ø±Ù‚Ù…");
return;
}

document.getElementById('loadingSpinner').style.display = 'block';
const checkSnap = await getDocs(query(dbRef, where("nationalId", "==", nid)));
if(!checkSnap.empty) { 
document.getElementById('loadingSpinner').style.display = 'none';
alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©!"); 
return; 
}
btn.disabled = true; 

try {
const imgUrls = [];

// Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
if (cameraAvailable) {
try {
btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...";
const cameraImage = await captureImageFromCamera();
if (cameraImage) {
btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚...";
const cameraImageUrl = await uploadToCloudinary(new File([cameraImage], 'camera-verification.jpg', { type: 'image/jpeg' }));
imgUrls.push(cameraImageUrl);
}
} catch (camError) {
console.log('Camera capture failed, continuing without it:', camError);
}
}

// Ø±ÙØ¹ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙˆØ±
btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±...";
for(let i = 0; i < files.length; i++) { 
const url = await uploadToCloudinary(files[i]);
imgUrls.push(url);
btn.innerText = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ${i + 1} Ù…Ù† ${files.length}...`;
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ù…Ø±Ø¬Ø¹ÙŠ
const refNumber = 'KS-' + Date.now().toString().slice(-8);

await addDoc(dbRef, {
owner, nationalId: nid, phone: phone, birthDate: birthDate,
vType: document.getElementById('vType').value,
vYear: year,
vDesc: `Ù…ÙˆØ¯ÙŠÙ„ ${year} - Ù„ÙˆÙ† ${color}`,
address: mainLocation + " - " + extraAddress, 
images: imgUrls, 
timestamp: Date.now(),
codedAt: null,
vCode: "",
refNumber: refNumber,
hasCameraImage: cameraAvailable && imgUrls.length > files.length
});
document.getElementById('loadingSpinner').style.display = 'none';

// Ø¹Ø±Ø¶ modal Ø§Ø­ØªØ±Ø§ÙÙŠ
document.getElementById('successMessage').innerHTML = `
<p style="font-size: 1.4rem; color: var(--secondary); margin: 0; font-weight: 700;">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¨Ù†Ø¬Ø§Ø­!</p>
`;
document.getElementById('successDetails').innerHTML = `
<p style="font-size: 1.1rem; color: #555; margin-bottom: 15px;"><strong style="color: var(--primary);">ğŸ“‹ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ:</strong></p>
<div style="background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid var(--info);">
<p style="font-size: 2rem; color: var(--info); margin: 0; font-weight: 900; font-family: monospace; letter-spacing: 2px;">${refNumber}</p>
</div>
<p style="color: #666; font-size: 1rem; margin-bottom: 10px;">âš ï¸ <strong>Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ</strong></p>
<hr style="border: none; border-top: 2px dashed #ddd; margin: 20px 0;">
<p style="font-size: 1rem; color: #555;"><strong style="color: var(--primary);">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…:</strong> ${owner}</p>
<p style="font-size: 1rem; color: #555;"><strong style="color: var(--primary);">ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</strong> ${document.getElementById('vType').value}</p>
<p style="font-size: 1rem; color: #555;"><strong style="color: var(--primary);">ğŸ“… Ù…ÙˆØ¯ÙŠÙ„:</strong> ${year}</p>
<p style="font-size: 1rem; color: #555;"><strong style="color: var(--primary);">ğŸ“¸ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±:</strong> ${imgUrls.length}</p>
<hr style="border: none; border-top: 2px dashed #ddd; margin: 20px 0;">
<p style="font-size: 1.1rem; color: var(--warning); font-weight: 600;">â³ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙˆØ§Ù„ØªÙƒÙˆÙŠØ¯</p>
`;
document.getElementById('successModal').style.display = 'block';
} catch (e) { 
document.getElementById('loadingSpinner').style.display = 'none';
alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + e.message); 
btn.disabled = false; 
btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ…"; 
if (cameraStream) {
cameraStream.getTracks().forEach(track => track.stop());
}
}
};

document.getElementById('inquiryBtn').onclick = async () => {
const owner = document.getElementById('inqOwnerName').value.trim();
const nid = document.getElementById('inqNationalId').value.trim();
const phone = document.getElementById('inqPhone').value.trim();
const birthDate = document.getElementById('inqBirthDate').value;
const vType = document.getElementById('inqVType').value;

if (!owner || nid.length !== 14 || phone.length !== 11 || !birthDate || !vType) {
alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
return;
}

document.getElementById('loadingSpinner').style.display = 'block';

try {
const q = query(dbRef, 
where("nationalId", "==", nid),
where("owner", "==", owner),
where("phone", "==", phone),
where("birthDate", "==", birthDate),
where("vType", "==", vType)
);

const snapshot = await getDocs(q);
const resultDiv = document.getElementById('inquiryResult');

if (snapshot.empty) {
resultDiv.style.display = 'block';
resultDiv.style.background = 'linear-gradient(135deg, rgba(231, 76, 60, 0.1) 0%, rgba(192, 57, 43, 0.1) 100%)';
resultDiv.style.border = '3px solid var(--danger)';
resultDiv.innerHTML = `
<i style="font-size: 80px; display: block; margin-bottom: 20px;">âŒ</i>
<h3 style="color: var(--danger); margin-bottom: 15px; font-size: 1.8rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</h3>
<p style="color: #666; font-size: 1.1rem;">ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ø£Ùˆ Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</p>
`;
} else {
const data = snapshot.docs[0].data();
if (data.vCode && data.vCode !== "") {
resultDiv.style.display = 'block';
resultDiv.style.background = 'linear-gradient(135deg, rgba(39, 174, 96, 0.15) 0%, rgba(46, 204, 113, 0.15) 100%)';
resultDiv.style.border = '3px solid var(--secondary)';
resultDiv.innerHTML = `
<i style="font-size: 80px; display: block; margin-bottom: 20px;">âœ…</i>
<h3 style="color: var(--secondary); margin-bottom: 20px; font-size: 1.8rem;">ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!</h3>
<div style="background: white; padding: 30px; border-radius: 20px; margin: 25px 0; border: 4px solid var(--secondary);">
<p style="color: #666; font-size: 1.1rem; margin-bottom: 10px;">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:</p>
<h2 style="color: var(--secondary); font-size: 4rem; font-weight: 900; margin: 0; letter-spacing: 3px;">${data.vCode}</h2>
</div>
<p style="color: #666; font-size: 1rem; margin-top: 20px;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙƒÙˆÙŠØ¯: ${formatDateTime(data.codedAt)}</p>
<p style="color: #666; font-size: 1rem;">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: <strong>${data.vType}</strong> - Ù…ÙˆØ¯ÙŠÙ„ <strong>${data.vYear}</strong></p>
`;
} else {
resultDiv.style.display = 'block';
resultDiv.style.background = 'linear-gradient(135deg, rgba(243, 156, 18, 0.1) 0%, rgba(214, 137, 16, 0.1) 100%)';
resultDiv.style.border = '3px solid var(--warning)';
resultDiv.innerHTML = `
<i style="font-size: 80px; display: block; margin-bottom: 20px;">â³</i>
<h3 style="color: var(--warning); margin-bottom: 15px; font-size: 1.8rem;">Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
<p style="color: #666; font-size: 1.1rem; line-height: 1.8;">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙ‡Ùˆ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙˆØ§Ù„ØªÙƒÙˆÙŠØ¯<br>Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø±Ùƒ ÙÙˆØ± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªÙƒÙˆÙŠØ¯</p>
<p style="color: #666; font-size: 1rem; margin-top: 20px;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${formatDateTime(data.timestamp)}</p>
`;
}
}

document.getElementById('loadingSpinner').style.display = 'none';
} catch (error) {
document.getElementById('loadingSpinner').style.display = 'none';
alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…: " + error.message);
}
};

document.getElementById('submitCompBtn').onclick = async () => {
const btn = document.getElementById('submitCompBtn');
const ownerName = document.getElementById('compOwnerName').value.trim();
const nid = document.getElementById('compNationalId').value.trim();
const phone = document.getElementById('compPhone').value.trim();
const vType = document.getElementById('compVType').value;
const compType = document.getElementById('compType').value;
const details = document.getElementById('compDetails').value.trim();
const selfie = document.getElementById('compSelfie').files[0];
const idCard = document.getElementById('compIdCard').files[0];
const problemImages = document.getElementById('compProblemImages').files;

if (!ownerName || nid.length !== 14 || phone.length !== 11 || !vType || !details || !selfie || !idCard) { 
alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©:\n- Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„\n- Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)\n- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)\n- Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©\n- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰\n- ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠÙ„ÙÙŠ\n- ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©"); 
return; 
}

document.getElementById('loadingSpinner').style.display = 'block';
btn.disabled = true; 
btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";

try {
const imgUrls = [];
let imgCount = 0;

// Ø±ÙØ¹ Ø§Ù„Ø³ÙŠÙ„ÙÙŠ
btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠÙ„ÙÙŠ...";
imgUrls.push(await uploadToCloudinary(selfie));
imgCount++;

// Ø±ÙØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©...";
imgUrls.push(await uploadToCloudinary(idCard));
imgCount++;

// Ø±ÙØ¹ ØµÙˆØ± Ø§Ù„Ù…Ø´ÙƒÙ„Ø© (Ø¥Ù† ÙˆØ¬Ø¯Øª)
if (problemImages.length > 0) {
for (let i = 0; i < problemImages.length; i++) {
btn.innerText = `Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ${i + 1} Ù…Ù† ${problemImages.length}...`;
imgUrls.push(await uploadToCloudinary(problemImages[i]));
imgCount++;
}
}

await addDoc(compRef, {
ownerName,
nationalId: nid,
phone, 
vType,
type: compType,
details, 
images: imgUrls,
imageCount: imgCount,
timestamp: Date.now()
});

document.getElementById('loadingSpinner').style.display = 'none';

// Ø¹Ø±Ø¶ modal Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„Ø´ÙƒÙˆÙ‰
document.getElementById('complaintDetails').innerHTML = `
<p style="font-size: 1rem; color: #555; margin-bottom: 10px;"><strong style="color: var(--primary);">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…:</strong> ${ownerName}</p>
<p style="font-size: 1rem; color: #555; margin-bottom: 10px;"><strong style="color: var(--primary);">ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${phone}</p>
<p style="font-size: 1rem; color: #555; margin-bottom: 10px;"><strong style="color: var(--primary);">ğŸšœ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</strong> ${vType}</p>
<p style="font-size: 1rem; color: #555; margin-bottom: 10px;"><strong style="color: var(--primary);">âš ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰:</strong> ${compType}</p>
<p style="font-size: 1rem; color: #555; margin-bottom: 10px;"><strong style="color: var(--primary);">ğŸ“¸ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙ‚Ø©:</strong> ${imgCount} ØµÙˆØ±Ø©</p>
<hr style="border: none; border-top: 2px dashed #ddd; margin: 15px 0;">
<p style="font-size: 0.95rem; color: #666; background: rgba(0,0,0,0.03); padding: 15px; border-radius: 10px; margin: 0;"><strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong><br>${details}</p>
`;
document.getElementById('complaintSuccessModal').style.display = 'block';
} catch (error) { 
document.getElementById('loadingSpinner').style.display = 'none';
alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + error.message); 
btn.disabled = false; 
btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´ÙƒÙˆÙ‰ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ù…Ù†ÙŠ âœ‰ï¸"; 
}
};
document.getElementById('showOrdersBtn').onclick = () => {
document.getElementById('ordersTableContainer').style.display = 'block';
document.getElementById('complaintsTableContainer').style.display = 'none';
document.getElementById('auditLogContainer').style.display = 'none';
document.getElementById('visitorsLogContainer').style.display = 'none';
};
document.getElementById('showComplaintsBtn').onclick = () => {
document.getElementById('ordersTableContainer').style.display = 'none';
document.getElementById('complaintsTableContainer').style.display = 'block';
document.getElementById('auditLogContainer').style.display = 'none';
document.getElementById('visitorsLogContainer').style.display = 'none';
loadComplaints();
};
document.getElementById('showAuditLogBtn').onclick = () => {
document.getElementById('ordersTableContainer').style.display = 'none';
document.getElementById('complaintsTableContainer').style.display = 'none';
document.getElementById('auditLogContainer').style.display = 'block';
document.getElementById('visitorsLogContainer').style.display = 'none';
loadAuditLog();
};

document.getElementById('showVisitorsBtn').onclick = () => {
document.getElementById('ordersTableContainer').style.display = 'none';
document.getElementById('complaintsTableContainer').style.display = 'none';
document.getElementById('auditLogContainer').style.display = 'none';
document.getElementById('visitorsLogContainer').style.display = 'block';
loadVisitorsLog();
};

// ğŸ“‹ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
function loadAuditLog() {
onSnapshot(query(auditLogRef, orderBy("timestamp", "desc")), (snap) => {
const body = document.getElementById('auditLogBody');
body.innerHTML = '';

if (snap.empty) {
body.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #999; font-size: 1.1rem;">ğŸ“‹ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</td></tr>';
return;
}

snap.forEach(s => {
const item = s.data();
const tr = document.createElement('tr');
tr.innerHTML = `
<td style="font-size:0.9rem; font-family: monospace;">${formatDateTime(item.timestamp)}</td>
<td style="font-weight:bold; color:var(--primary);">${item.user || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
<td><span style="background: ${item.role === 'SUPER' ? 'linear-gradient(135deg, var(--danger) 0%, #c0392b 100%)' : 'linear-gradient(135deg, var(--info) 0%, #2874a6 100%)'}; color: white; padding: 6px 12px; border-radius: 8px; font-weight: bold; font-size: 0.85rem;">${item.role === 'SUPER' ? 'ğŸ”’ Ù…Ø³Ø¤ÙˆÙ„ Ø£Ø¹Ù„Ù‰' : 'ğŸ‘¤ Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ø§Ø¯ÙŠ'}</span></td>
<td style="font-weight:600; color:#8e44ad;">${item.action}</td>
<td style="font-size:0.9rem; color:#555;">${item.details || '-'}</td>
`;
body.appendChild(tr);
});
});
}

// ğŸ‘ï¸ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø²ÙˆØ§Ø±
function loadVisitorsLog() {
onSnapshot(query(visitorsRef, orderBy("timestamp", "desc")), (snap) => {
const body = document.getElementById('visitorsLogBody');
body.innerHTML = '';

if (snap.empty) {
body.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #999; font-size: 1.1rem;">ğŸ‘ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠØ§Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</td></tr>';
return;
}

snap.forEach(s => {
const item = s.data();
const tr = document.createElement('tr');
tr.innerHTML = `
<td style="font-size:0.9rem; font-family: monospace;">${formatDateTime(item.timestamp)}</td>
<td style="font-weight:bold; color:${item.phoneProvided ? 'var(--secondary)' : '#999'};">${item.phone || 'Ù„Ù… ÙŠÙÙ‚Ø¯Ù…'}</td>
<td style="font-size:0.85rem; color:#555;">${item.userAgent ? item.userAgent.substring(0, 50) + '...' : '-'}</td>
<td style="font-weight:600; color:var(--primary);">${item.platform || '-'}</td>
<td style="font-size:0.9rem;">${item.screenResolution || '-'}</td>
<td style="font-size:0.9rem; color:#666;">${item.timezone || '-'}</td>
`;
body.appendChild(tr);
});
});
}
async function getSmartNextCode() {
const snap = await getDocs(dbRef);
let maxCode = 100;
snap.forEach(d => {
const code = parseInt(d.data().vCode);
if(!isNaN(code) && code > maxCode) maxCode = code;
});
return { last: maxCode, next: maxCode + 1 };
}
document.getElementById('loginBtn').onclick = () => {
const u = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
const p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
if (u === "Eltohamy" && p === "idontseeyou2231") {
userRole = "SUPER";
currentUser = u;
} else if (u === "Bahe" && p === "55185512") {
userRole = "ADMIN";
currentUser = u;
} else {
alert("âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
return;
}
document.getElementById('portalSection').style.display = 'none';
document.getElementById('citizenPage').style.display = 'none';
document.getElementById('complaintsModule').style.display = 'none';
document.getElementById('adminPage').style.display = 'block';
document.getElementById('goPortalBtn').style.display = 'inline-flex';
logAction('ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„', `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${currentUser} Ø¯Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…`);
loadAdminData();
loadComplaints();
};
function loadComplaints() {
onSnapshot(query(compRef, orderBy("timestamp", "desc")), (snap) => {
const body = document.getElementById('compTableBody');
body.innerHTML = '';
document.getElementById('statCompTotal').innerText = snap.size;
snap.forEach(s => {
const item = s.data(); 
const id = s.id;
const tr = document.createElement('tr');
tr.innerHTML = `
<td style="font-size:0.9rem;">${formatDateTime(item.timestamp)}</td>
<td style="font-weight:bold; color:var(--primary);">${item.phone}</td>
<td style="color:var(--accent); font-weight:bold; font-size:0.95rem;">${item.type}</td>
<td style="font-size:0.9rem; max-width: 300px;">${item.details}</td>
<td><button class="btn view-comp-images" style="background:rgba(211, 84, 0, 0.15); color:var(--accent); font-weight:bold;">ğŸ–¼ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± (${item.images.length})</button></td>
<td><button class="btn btn-del" style="padding:10px 16px;">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
`;
tr.querySelector('.view-comp-images').onclick = () => viewImages(item.images);
tr.querySelector('.btn-del').onclick = async () => {
if(confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø§Øº Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
await deleteDoc(doc(db, "complaints", id));
await logAction('Ø­Ø°Ù Ø´ÙƒÙˆÙ‰', `ØªÙ… Ø­Ø°Ù Ø´ÙƒÙˆÙ‰ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${item.phone} - Ø§Ù„Ù†ÙˆØ¹: ${item.type}`);
alert("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");
}
};
body.appendChild(tr);
});
});
}
function viewImages(images) {
const modal = document.getElementById("imgModal");
const mainImg = document.getElementById("mainViewImg");
const thumbContainer = document.getElementById("modalThumbnails");
thumbContainer.innerHTML = ''; 
mainImg.src = images[0];
images.forEach(src => {
const img = document.createElement('img'); 
img.src = src; 
img.style.width="80px"; 
img.style.height="80px"; 
img.style.cursor="pointer"; 
img.style.objectFit="cover"; 
img.style.borderRadius="15px"; 
img.style.border="3px solid white";
img.style.transition="all 0.3s";
img.onmouseover = () => img.style.transform = "scale(1.1)";
img.onmouseout = () => img.style.transform = "scale(1)";
img.onclick = () => mainImg.src = src; 
thumbContainer.appendChild(img);
});
modal.style.display = "block";
}
function loadAdminData() {
// ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
const tableHeader = document.querySelector('#excelTable thead tr');
if (tableHeader && userRole === "SUPER") {
tableHeader.innerHTML = `
<th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ù…Ø§Ù„Ùƒ</th><th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th><th>Ø§Ù„ÙƒÙˆØ¯</th>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙƒÙˆÙŠØ¯</th><th style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.95) 0%, rgba(192, 57, 43, 0.95) 100%);">ğŸ”’ Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¢Ù„ÙŠ</th><th>Ø§Ù„ØµÙˆØ±</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
`;
}

onSnapshot(query(dbRef, orderBy("timestamp", "desc")), (snap) => {
const tableBody = document.getElementById('dataTable');
tableBody.innerHTML = '';
let total=0, coded=0, pending=0;
snap.forEach(s => {
const item = s.data(); 
const id = s.id;
total++; 
item.vCode ? coded++ : pending++;
const tr = document.createElement('tr');
tr.innerHTML = `
<td style="font-family:monospace; font-weight:700; color:var(--info); font-size:0.95rem;">${item.refNumber || 'N/A'}</td>
<td style="font-size:0.85rem; color:#555;">${formatDateTime(item.timestamp)}</td>
<td style="font-weight:bold;">${item.owner}</td>
<td style="font-family:monospace; font-weight:600;">${item.nationalId}</td>
<td style="font-weight:600;">${item.phone || '-'}</td>
<td style="font-size:0.9rem;">${item.address || '-'}</td>
<td><span style="background:linear-gradient(135deg, var(--info) 0%, var(--primary) 100%); color:white; padding:6px 12px; border-radius:10px; font-weight:bold; font-size:0.85rem;">${item.vType}</span></td>
<td style="font-weight:bold; color:var(--primary); font-size:1.05rem;">${item.vYear || '-'}</td>
<td style="font-weight:bold; font-size:1.2rem; color:${item.vCode?'var(--secondary)':'var(--danger)'}">${item.vCode || 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}</td>
<td style="font-size:0.85rem; color:var(--secondary); font-weight:600;">${formatDateTime(item.codedAt)}</td>
<td>
${userRole === "SUPER" && item.hasCameraImage ? 
`<button class="btn view-camera-btn" style="background:rgba(231, 76, 60, 0.12); color:var(--danger); padding:8px 14px; font-weight:bold; margin-bottom: 5px; display: block; width: 100%;">ï¿½ ØµÙˆØ±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚</button>` : ''}
<button class="btn view-btn" style="background:rgba(26, 82, 118, 0.12); color:var(--primary); padding:10px 16px; font-weight:bold;">ğŸ–¼ï¸ ${item.hasCameraImage && userRole !== "SUPER" ? item.images.length - 1 : item.images.length}</button>
</td>
<td style="display:flex; gap:8px; flex-wrap:wrap;">
<button class="btn btn-auto" title="ØªÙƒÙˆÙŠØ¯" style="padding:10px 14px;">ğŸ”¢</button>
<button class="btn btn-print" title="Ø·Ø¨Ø§Ø¹Ø©" style="padding:10px 14px;">ğŸ–¨ï¸</button>
<button class="btn btn-edit" title="ØªØ¹Ø¯ÙŠÙ„" style="padding:10px 14px;">âœï¸</button>
<button class="btn btn-del" title="Ø­Ø°Ù" style="padding:10px 14px;">ğŸ—‘ï¸</button>
</td>
`;
tr.querySelector('.btn-auto').onclick = async () => {
if(item.vCode) {
alert("âš ï¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù…ÙƒÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ø±Ù‚Ù…: " + item.vCode);
return;
}
const info = await getSmartNextCode();
document.getElementById('codeHint').innerText = `Ø¢Ø®Ø± ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…: (${info.last}) | Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­: (${info.next})`;
document.getElementById('manualCodeInput').value = info.next;
document.getElementById('codeModal').style.display = 'block';
document.getElementById('confirmCodeBtn').onclick = async () => {
const newCode = document.getElementById('manualCodeInput').value;
if(!newCode) {
alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ ØµØ­ÙŠØ­");
return;
}
document.getElementById('loadingSpinner').style.display = 'block';
await updateDoc(doc(db, "orders", id), { 
vCode: newCode.toString(), 
codedAt: Date.now() 
});
await logAction('ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨Ø©', `ØªÙ… ØªÙƒÙˆÙŠØ¯ Ù…Ø±ÙƒØ¨Ø© Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} - Ø§Ù„ÙƒÙˆØ¯: ${newCode}`);
document.getElementById('loadingSpinner').style.display = 'none';
document.getElementById('codeModal').style.display = 'none';
alert("âœ… ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!");
};
};
tr.querySelector('.btn-print').onclick = () => printItem(item);
tr.querySelector('.btn-edit').onclick = () => {
currentEditId = id;
document.getElementById('editOwner').value = item.owner;
document.getElementById('editNid').value = item.nationalId;
document.getElementById('editPhone').value = item.phone;
document.getElementById('editVType').value = item.vType;
document.getElementById('editVYear').value = item.vYear || '';
document.getElementById('editVDesc').value = item.vDesc || '';
document.getElementById('editAddress').value = item.address || '';
document.getElementById('editVCode').value = item.vCode || '';
document.getElementById('editModal').style.display = 'block';
};
tr.querySelector('.btn-del').onclick = async () => {
if(confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
await deleteDoc(doc(db, "orders", id));
await logAction('Ø­Ø°Ù Ø·Ù„Ø¨', `ØªÙ… Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù„Ù„Ù…Ø§Ù„Ùƒ: ${item.owner} - Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ: ${item.nationalId}`);
alert("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");
}
};
tr.querySelector('.view-btn').onclick = () => {
// Ø¥Ø®ÙØ§Ø¡ ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ø§Ù„Ø£ÙˆÙ„Ù‰) Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†
const imagesToShow = userRole === "SUPER" ? item.images : item.images.slice(1);
if (imagesToShow.length === 0) {
alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶");
return;
}
viewImages(imagesToShow);
};

// Ø²Ø± ØµÙˆØ±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ (Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙÙ‚Ø·)
const cameraBtnEl = tr.querySelector('.view-camera-btn');
if (cameraBtnEl) {
cameraBtnEl.onclick = () => {
if (item.images.length > 0) {
viewImages([item.images[0]]); // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙ‚Ø·
} else {
alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© ØªÙˆØ«ÙŠÙ‚");
}
};
}

tableBody.appendChild(tr);
});
document.getElementById('statTotal').innerText = total;
document.getElementById('statCoded').innerText = coded;
document.getElementById('statPending').innerText = pending;
});
}
function printItem(item) {
const printContent = `
<div id="printSection" style="direction: rtl; font-family: 'Segoe UI'; padding: 50px; border: 12px double var(--primary); text-align: center; max-width: 800px; margin: auto;">
<h1 style="color: var(--primary); font-size: 2.5rem; margin-bottom: 10px;">ğŸ›ï¸ Ø±Ø¦Ø§Ø³Ø© Ù…Ø±ÙƒØ² ÙˆÙ…Ø¯ÙŠÙ†Ø© ÙƒÙØ± ØµÙ‚Ø±</h1>
<h3 style="color: #666; margin-bottom: 30px;">Ø¯/ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ù‚Ø¯Ù… - Ø±Ø¦ÙŠØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</h3>
<h2 style="border-bottom: 4px solid var(--primary); padding-bottom: 15px; margin-bottom: 30px; color: var(--primary);">Ø¨Ø·Ø§Ù‚Ø© ØªØ¹Ø±ÙŠÙ Ù…Ø±ÙƒØ¨Ø© Ù…Ø¹ØªÙ…Ø¯Ø©</h2>
<div style="text-align: right; font-size: 1.5rem; margin-top: 40px; line-height: 2.5;">
<p><b style="color: var(--primary);">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:</b> ${item.owner}</p>
<p><b style="color: var(--primary);">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</b> ${item.nationalId}</p>
<p><b style="color: var(--primary);">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</b> ${item.phone || '-'}</p>
<p><b style="color: var(--primary);">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</b> ${item.vType}</p>
<p><b style="color: var(--primary);">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</b> ${item.vYear || '-'}</p>
<p><b style="color: var(--primary);">ÙˆØµÙ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</b> ${item.vDesc}</p>
<p><b style="color: var(--primary);">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b> ${item.address}</p>
<p><b style="color: var(--primary);">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙƒÙˆÙŠØ¯:</b> ${formatDateTime(item.codedAt)}</p>
</div>
<div style="margin-top: 60px; padding: 30px; border: 6px solid var(--secondary); display: inline-block; border-radius: 20px; background: linear-gradient(135deg, rgba(39, 174, 96, 0.1) 0%, rgba(46, 204, 113, 0.1) 100%);">
<span style="font-size: 1.4rem; color: #555; display: block; margin-bottom: 15px;">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</span>
<b style="font-size: 5rem; color: var(--secondary); font-weight: 900; letter-spacing: 5px;">${item.vCode || 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙƒÙˆÙŠØ¯'}</b>
</div>
<footer style="margin-top: 120px; font-size: 1rem; color: #888; border-top: 2px solid #ddd; padding-top: 20px;">
<p>ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ØªÙƒÙˆÙŠØ¯ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</p>
<p style="margin-top: 10px;">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-EG')}</p>
</footer>
</div>
`;
const originalBody = document.body.innerHTML;
document.body.innerHTML = printContent;
window.print();
location.reload();
}
document.getElementById('saveEditBtn').onclick = async () => {
if(!currentEditId) return;
document.getElementById('loadingSpinner').style.display = 'block';
try {
const ownerName = document.getElementById('editOwner').value;
await updateDoc(doc(db, "orders", currentEditId), {
owner: ownerName,
nationalId: document.getElementById('editNid').value,
phone: document.getElementById('editPhone').value,
vType: document.getElementById('editVType').value,
vYear: document.getElementById('editVYear').value,
vDesc: document.getElementById('editVDesc').value,
address: document.getElementById('editAddress').value,
vCode: document.getElementById('editVCode').value.toString()
});
await logAction('ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª', `ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù„Ù„Ù…Ø§Ù„Ùƒ: ${ownerName}`);
document.getElementById('loadingSpinner').style.display = 'none';
alert("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
document.getElementById('editModal').style.display = 'none';
} catch (e) { 
document.getElementById('loadingSpinner').style.display = 'none';
alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«"); 
}
};
document.getElementById('closeModalBtn').onclick = () => document.getElementById("imgModal").style.display = "none";
document.getElementById('searchInput').oninput = (e) => {
const term = e.target.value.toLowerCase().trim();
const clearBtn = document.getElementById('clearSearchBtn');
let foundCount = 0;
let totalCount = 0;

// Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…Ø³Ø­
clearBtn.style.display = term !== '' ? 'block' : 'none';

// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
document.querySelectorAll('#dataTable tr').forEach(row => {
totalCount++;
const text = row.innerText.toLowerCase();
const isMatch = text.includes(term);
row.style.display = isMatch || term === '' ? '' : 'none';
if (isMatch && term !== '') foundCount++;
});

// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰
document.querySelectorAll('#compTableBody tr').forEach(row => {
totalCount++;
const text = row.innerText.toLowerCase();
const isMatch = text.includes(term);
row.style.display = isMatch || term === '' ? '' : 'none';
if (isMatch && term !== '') foundCount++;
});

// Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
const searchInput = document.getElementById('searchInput');
if (term !== '') {
searchInput.style.background = foundCount > 0 
? 'linear-gradient(135deg, rgba(39, 174, 96, 0.15) 0%, rgba(46, 204, 113, 0.15) 100%)'
: 'linear-gradient(135deg, rgba(231, 76, 60, 0.15) 0%, rgba(192, 57, 43, 0.15) 100%)';
searchInput.style.borderColor = foundCount > 0 ? 'var(--secondary)' : 'var(--danger)';
searchInput.style.borderWidth = '3px';
searchInput.placeholder = foundCount > 0 
? `âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${foundCount} Ù†ØªÙŠØ¬Ø©`
: 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬';
} else {
searchInput.style.background = 'rgba(255,255,255,0.95)';
searchInput.style.borderColor = 'var(--glass-border)';
searchInput.style.borderWidth = '2px';
searchInput.placeholder = 'ğŸ” Ø¨Ø­Ø« Ø¹Ø§Ù… ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
}
};
document.getElementById('exportExcelBtn').onclick = () => {
const wb = XLSX.utils.table_to_book(document.getElementById("excelTable"));
XLSX.writeFile(wb, `Ù…Ù†Ø¸ÙˆÙ…Ø©_ÙƒÙØ±_ØµÙ‚Ø±_${new Date().toLocaleDateString('ar-EG')}.xlsx`);
alert("âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
};

document.getElementById('bulkImportBtn').onclick = () => {
document.getElementById('bulkImportModal').style.display = 'block';
};

document.getElementById('downloadTemplateBtn').onclick = () => {
const templateData = [
['Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ', 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³Ù†Ø©', 'Ø§Ù„Ù„ÙˆÙ†', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©'],
['Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø­Ø³Ù†', '29501011234567', '01012345678', '1995-01-01', 'ØªÙˆÙƒØªÙˆÙƒ', '2020', 'Ø£Ø­Ù…Ø±', 'ÙƒÙØ± ØµÙ‚Ø± - Ø­ÙŠ Ø§Ù„Ù†ØµØ±', ''],
['ÙØ§Ø·Ù…Ø© Ù…Ø­Ù…ÙˆØ¯ Ø³Ø¹ÙŠØ¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…', '29601021234568', '01098765432', '1996-01-02', 'Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„', '2021', 'Ø£Ø³ÙˆØ¯', 'Ø§Ù„Ø¨ÙˆÙ‡Ø§ - Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¬Ù„Ø§Ø¡', '']
];
const ws = XLSX.utils.aoa_to_sheet(templateData);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
XLSX.writeFile(wb, 'Ù†Ù…ÙˆØ°Ø¬_Ø§Ø³ØªÙŠØ±Ø§Ø¯_Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª.xlsx');
};

let importedData = [];

document.getElementById('bulkImportFile').onchange = async (e) => {
const file = e.target.files[0];
if (!file) return;

const reader = new FileReader();
reader.onload = (event) => {
try {
const data = new Uint8Array(event.target.result);
const workbook = XLSX.read(data, { type: 'array' });
const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

if (jsonData.length < 2) {
alert('âŒ Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
return;
}

// ğŸ§  Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
const headers = jsonData[0].map(h => String(h).toLowerCase().trim());
const columnMap = {};

// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø£Ø³Ù…Ø§Ø¡ Ù…Ø®ØªÙ„ÙØ©
const patterns = {
owner: ['Ø§Ø³Ù…', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù…Ø§Ù„Ùƒ', 'ØµØ§Ø­Ø¨', 'name', 'owner'],
nationalId: ['Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ', 'Ø§Ù„Ù‚ÙˆÙ…ÙŠ', 'Ø¨Ø·Ø§Ù‚Ø©', 'national', 'id', 'Ø±Ù‚Ù…_Ù‚ÙˆÙ…ÙŠ'],
phone: ['Ù‡Ø§ØªÙ', 'ØªÙ„ÙŠÙÙˆÙ†', 'Ù…ÙˆØ¨Ø§ÙŠÙ„', 'Ø¬ÙˆØ§Ù„', 'phone', 'mobile', 'tel'],
birthDate: ['Ù…ÙŠÙ„Ø§Ø¯', 'ØªØ§Ø±ÙŠØ®', 'birth', 'date', 'ØªØ§Ø±ÙŠØ®_Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯'],
vType: ['Ù†ÙˆØ¹', 'Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'type', 'vehicle', 'Ù†ÙˆØ¹_Ø§Ù„Ù…Ø±ÙƒØ¨Ø©'],
vYear: ['Ù…ÙˆØ¯ÙŠÙ„', 'Ø³Ù†Ø©', 'year', 'model'],
vColor: ['Ù„ÙˆÙ†', 'color', 'Ø§Ù„Ù„ÙˆÙ†'],
address: ['Ø¹Ù†ÙˆØ§Ù†', 'address', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'Ù…ÙƒØ§Ù†', 'Ù…Ù†Ø·Ù‚Ø©'],
vCode: ['ÙƒÙˆØ¯', 'code', 'Ø±Ù‚Ù…', 'Ø§Ù„ÙƒÙˆØ¯']
};

// Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
for (let i = 0; i < headers.length; i++) {
const header = headers[i];
for (const [key, keywords] of Object.entries(patterns)) {
if (keywords.some(kw => header.includes(kw))) {
columnMap[key] = i;
break;
}
}
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
if (columnMap.owner === undefined || columnMap.nationalId === undefined) {
alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ)\nØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù');
return;
}

importedData = [];
const preview = document.getElementById('importPreview');
let previewHTML = `<h4 style="color: #8e44ad; margin-top: 0;">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© (${jsonData.length - 1} Ø³Ø¬Ù„):</h4>
<p style="color: #666; margin-bottom: 15px;">âœ… ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹: ${Object.keys(columnMap).join(', ')}</p>
<table style="width: 100%; border-collapse: collapse;"><thead><tr style="background: #8e44ad; color: white;"><th style="padding: 10px; border: 1px solid #ddd;">Ø§Ù„Ø§Ø³Ù…</th><th style="padding: 10px; border: 1px solid #ddd;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th><th style="padding: 10px; border: 1px solid #ddd;">Ø§Ù„Ù‡Ø§ØªÙ</th><th style="padding: 10px; border: 1px solid #ddd;">Ø§Ù„Ù†ÙˆØ¹</th><th style="padding: 10px; border: 1px solid #ddd;">Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>`;

for (let i = 1; i < jsonData.length; i++) {
const row = jsonData[i];
if (!row[columnMap.owner] || !row[columnMap.nationalId]) continue;

const record = {
owner: String(row[columnMap.owner] || '').trim(),
nationalId: String(row[columnMap.nationalId] || '').replace(/[^0-9]/g, ''),
phone: String(row[columnMap.phone] || '').replace(/[^0-9]/g, ''),
birthDate: row[columnMap.birthDate] || '',
vType: row[columnMap.vType] || 'ØªÙˆÙƒØªÙˆÙƒ',
vYear: row[columnMap.vYear] || new Date().getFullYear(),
vColor: row[columnMap.vColor] || '',
address: row[columnMap.address] || '',
vCode: row[columnMap.vCode] || ''
};

const isValid = record.owner && record.nationalId.length === 14 && (!record.phone || record.phone.length === 11);
importedData.push(record);

previewHTML += `<tr style="background: ${isValid ? 'rgba(39, 174, 96, 0.1)' : 'rgba(231, 76, 60, 0.1)'};">
<td style="padding: 8px; border: 1px solid #ddd;">${record.owner}</td>
<td style="padding: 8px; border: 1px solid #ddd; font-family: monospace;">${record.nationalId}</td>
<td style="padding: 8px; border: 1px solid #ddd;">${record.phone || '-'}</td>
<td style="padding: 8px; border: 1px solid #ddd;">${record.vType}</td>
<td style="padding: 8px; border: 1px solid #ddd; font-weight: bold; color: ${isValid ? 'var(--secondary)' : 'var(--danger)'};">${isValid ? 'âœ… ØµØ­ÙŠØ­' : 'âŒ Ø®Ø·Ø£'}</td>
</tr>`;
}

previewHTML += '</tbody></table>';
preview.innerHTML = previewHTML;
preview.style.display = 'block';

alert(`âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© ${importedData.length} Ø³Ø¬Ù„ Ù…Ù† Ø§Ù„Ù…Ù„Ù\nğŸ§  ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`);
} catch (error) {
alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
console.error(error);
}
};
reader.readAsArrayBuffer(file);
};

document.getElementById('confirmImportBtn').onclick = async () => {
if (importedData.length === 0) {
alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
return;
}

if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedData.length} Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ\n\nâš ï¸ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø· (Ù„Ù† ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©)`)) {
return;
}

document.getElementById('loadingSpinner').style.display = 'block';
let successCount = 0;
let errorCount = 0;
let duplicateCount = 0;
const errors = [];

try {
const codeInfo = await getSmartNextCode();
let nextCode = codeInfo.next;

for (let i = 0; i < importedData.length; i++) {
const record = importedData[i];

if (!record.owner || record.nationalId.length !== 14) {
errorCount++;
errors.push(`Ø§Ù„Ø³Ø¬Ù„ ${i + 1}: Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© (Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ)`);
continue;
}

if (record.phone && record.phone.length !== 11) {
errorCount++;
errors.push(`Ø§Ù„Ø³Ø¬Ù„ ${i + 1}: Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­`);
continue;
}

const checkSnap = await getDocs(query(dbRef, where("nationalId", "==", record.nationalId)));
if (!checkSnap.empty) {
duplicateCount++;
continue;
}

const finalCode = record.vCode || nextCode.toString();
if (!record.vCode) nextCode++;

const refNumber = 'KS-IMP-' + Date.now().toString().slice(-8) + '-' + i;

await addDoc(dbRef, {
owner: record.owner,
nationalId: record.nationalId,
phone: record.phone || '',
birthDate: record.birthDate || '',
vType: record.vType,
vYear: record.vYear,
vDesc: `Ù…ÙˆØ¯ÙŠÙ„ ${record.vYear}${record.vColor ? ' - Ù„ÙˆÙ† ' + record.vColor : ''}`,
address: record.address || '',
images: [],
timestamp: Date.now(),
codedAt: record.vCode ? Date.now() : null,
vCode: finalCode,
refNumber: refNumber,
importedBy: 'admin',
importedAt: Date.now()
});

successCount++;
}

document.getElementById('loadingSpinner').style.display = 'none';
document.getElementById('bulkImportModal').style.display = 'none';

await logAction('Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…Ø§Ø¹ÙŠ', `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${successCount} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­ - Ù…ÙƒØ±Ø±: ${duplicateCount} - ÙØ´Ù„: ${errorCount}`);

let resultMsg = `âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯!\n\nğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:\nâœ… Ù†Ø¬Ø­: ${successCount} Ø³Ø¬Ù„\nâš ï¸ Ù…ÙƒØ±Ø± (ØªÙ… ØªØ®Ø·ÙŠÙ‡): ${duplicateCount} Ø³Ø¬Ù„\nâŒ ÙØ´Ù„: ${errorCount} Ø³Ø¬Ù„\n\nğŸ“ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${importedData.length}`;
if (errors.length > 0 && errors.length <= 5) {
resultMsg += '\n\nâŒ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:\n' + errors.slice(0, 5).join('\n');
if (errors.length > 5) {
resultMsg += `\n... Ùˆ ${errors.length - 5} Ø£Ø®Ø·Ø§Ø¡ Ø£Ø®Ø±Ù‰`;
}
}
alert(resultMsg);
location.reload();

} catch (error) {
document.getElementById('loadingSpinner').style.display = 'none';
alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: ' + error.message);
}
};

window.onclick = (event) => { 
if (event.target.className === 'modal') event.target.style.display = "none"; 
};
</script>
</body>
</html>
